{"version":3,"file":"hax-body-behaviors.umd.js","sources":["lib/HAXWiring.js"],"sourcesContent":["/**\n * Copyright 2018 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport { dom } from \"@polymer/polymer/lib/legacy/polymer.dom.js\";\nimport \"@lrnwebcomponents/hax-body/lib/hax-upload-field.js\";\nimport \"@lrnwebcomponents/simple-picker/simple-picker.js\";\nimport \"@lrnwebcomponents/code-editor/code-editor.js\";\n/**\n * In order to use this, the user must supply a haxProperties object\n * which returns what settings are allowed as well as their format.\n * For example, the default of:\n *\n *  {\n *    'api': '1',\n *    'canScale': true,\n *    'canPosition': true,\n *    'canEditSource': true,\n *    'gizmo': {},\n *    'settings': {\n *      'quick': [],\n *      'configure': [],\n *      'advanced': [],\n *    },\n *    'saveOptions': {}\n *  }\n *\n * This tells hax-body's context menu for custom-elements that this element\n * can use the scaling widget and the positioning widget as well as have a traditional source editor view when in an advanced form.\n *\n * So now you're probably saying 'What's a gizmo???'. Well, gizmo is what we call widgets or custom-elements when an end user of HAX places them in the page. It's our playful way of explaining what's happening to an end user as well as ensuring when developers talk to each other then don't use words that have duplicate meanings. It's also just a fun word.\n * A gizmo helps describe the element to the HAX Gizmo manager so that a user can select the element they want to place in the page. Think of your custom-element as an app in an app store. Well, how would you describe your 'app' or Gizmo to a store of apps (in our case the Gizmo manager).\n *\n * This is an example of th gizmo object that is expressed in the lrn-table tag:\n * 'gizmo': {\n *    'title': 'CSV Table',\n *    'descrption': 'This can generate a table from a CSV file no matter where it is located.',\n *     'icon': 'editor:border-all',\n *     'color': 'green',\n *     'groups': ['Presentation', 'Table', 'Data'],\n *     'handles': [\n *       {\n *         'type': 'data',\n *         'url': 'csvFile'\n *       }\n *     ],\n *     'meta': {\n *       'author': 'LRNWebComponents'\n *     }\n *   },\n *\n * Groups is like a filter that someone could search amongst dozens of gizmos for the type of one they are looking for. So if you said your gizmo is for presenting video then you could tag it as Video and people looking for ways to present videos could filter by just Video gizmos.\n * handles has to do with hax-sources of gizmos (think remote app stores you are searching to bring in an app if that was even possible in cell phones);. This says that if a gizmo source claims to be able to supply 'data', that lrn-table is able to handle data and that the property to map to when producing a haxElement is called csvFile. If only 1 handler exists for a response type from a source then it'll auto select it, otherwise the user will have the option of which custom element / gizmo they want to use to render that source material.\n * meta is typical meta data, these things will be printed in a table in the event anyone wants to see them. Author is a logical one so people know who an element came from; like if you wanted to have a core gizmo's vs 3rd party gizmo's concept.\n *\n * Other settings can be expressed through beyond these simple layout modifiers.\n * This example illustrates how you can show forms in three different areas of HAX.\n * Items in the 'quick' key group means that it would show up in hax's in-place editor\n * on the context menu. Things keyed with 'configure' show up in a\n * form / preview display mode in a modal above the interface. Things in 'advanced' will\n * show up on a sub-set of the configure form for more advanced operations.\n * 'settings': {\n *   'quick': [\n *     {\n *       'property': 'responsive',\n *       'title': 'Responsive',\n *       'description': 'The video automatically fills the available area.',\n *       'inputMethod': 'boolean',\n *       'icon': 'video'\n *     }\n *   ],\n *   'configure': [\n *     {\n *       'property': 'citation',\n *       'title': 'Citation',\n *       'description': 'Proper MLA or other standard citation format for the image.',\n *       'inputMethod': 'textfield',\n *       'icon': 'text-format',\n *       'required': true\n *     },\n *     {\n *       'property': 'responsive',\n *       'title': 'Responsive',\n *       'description': 'The video automatically fills the available area.',\n *       'inputMethod': 'boolean',\n *       'icon': 'video'\n *     }\n *   ],\n *   'advanced': [\n *     {\n *       'slot': 'area1',\n *       'title': 'Section 1',\n *       'description': 'Content that goes in the fist area in the layout.',\n *       'inputMethod': 'textarea',\n *       'icon': 'layout'\n *     }\n *   ]\n * }\n * `saveOptions` is a more open ended object which can be used to help\n * support future flexibility / needs. The first major thing this supports\n * is the wipeSlot flag (default false). wipeSlot is used to inform HAX\n * that when it's going to save the current item to a backend (convert to html / text)\n * that it needs to first wipe out the contents of the element. This is not a common\n * operation but useful for things like tokens and other tags that leverage slot\n * in order to present information but should not be saving that information\n * to a backend. Elements that dynamically pull content from an end point are\n * the perfect example of when you'd want to wipe the slot. A content element\n * like a block-quote tag which uses slot to allow users to write whatever\n * they want inside the tag would NOT want to use this, otherwise the contents\n * would be lost.\n * Another used saveOption is `unsetAttributes`. `unsetAttributes` is an Array\n * which can be used to tell a hax-body save operation to NOT save certain\n * attributes. The form of these is in the html style, NOT the javascript\n * style of attribute definition. In this way, you can define non property\n * based values that you require not saving. For example, the following\n * would be a valid use of `unsetAttributes`:\n * 'saveOptions': {\n *   'unsetAttributes': [\n *     'displayed-answers',\n *     'data-some-value',\n *     'id',\n *     'colors'\n *   ]\n * },\n *\n * Specialized functions\n * `preProcessHaxNodeToContent` - If you define this function on your element\n * then it will run BEFORE the conversion to text. This can be used to do\n * specialized processing that may not be standard prior to conversion to content.\n *\n * `postProcesshaxNodeToContent` - If you define this function on your element\n * then it will run AFTER the node has been converted to Content and allows you\n * to act upon the content even further. This could be to clean up / regex against\n * the text certain patterns or to look for certain elements at the end of\n * the conversion routine.\n *\n * `preProcessHaxInsertContent` - If an element needs to ensure it cleans up data\n * during the conversion from preview to being inserted. This function passes in\n * the details object for creating an element from HAX schema. Examples could be\n * objects that contain focus which may cause issues when doing a pure clone as the\n * reference is being garbage collected on save (see grid-plate).\n */\n/**\n * Object to validate HAX schema. Can be used in and out of element contexts\n */\nexport class HAXWiring {\n  constructor() {\n    /**\n     * haxProperties\n     */\n    this.haxProperties = {\n      canScale: false,\n      canPosition: false,\n      canEditSource: false,\n      settings: {\n        quick: [],\n        configure: [],\n        advanced: []\n      },\n      wipeSlot: {}\n    };\n    /**\n     * Setter to bridge private haxProperties setter.\n     * This is to then be implemented by the ready state of whatever is supplying the\n     * properties in order to be able to bubble up the properties for a tag.\n     */\n    this.setup = (props, tag = \"\", context = this) => {\n      if (typeof this.tagName !== typeof undefined) {\n        tag = this.tagName.toLowerCase();\n      }\n      window.addEventListener(\n        \"hax-store-ready\",\n        this._haxStoreReady.bind(this)\n      );\n      if (\n        typeof window.HaxStore !== typeof undefined &&\n        window.HaxStore.instance != null &&\n        window.HaxStore.ready\n      ) {\n        return this.setHaxProperties(props, tag, context, true);\n      } else {\n        return this.setHaxProperties(props, tag, context, false);\n      }\n    };\n    /**\n     * HAX store is ready so now we can fire events\n     */\n    this._haxStoreReady = e => {\n      if (\n        e.detail &&\n        typeof this.tagName !== typeof undefined &&\n        typeof this.haxProperties !== typeof undefined\n      ) {\n        let tag = this.tagName;\n        let props = this.haxProperties;\n        let context = this;\n        if (tag != \"\" && typeof window.HaxStore === typeof undefined) {\n          const evt = new CustomEvent(\"hax-register-properties\", {\n            bubbles: true,\n            composed: true,\n            cancelable: true,\n            detail: {\n              tag: tag.toLowerCase(),\n              properties: props,\n              polymer: false\n            }\n          });\n          context.dispatchEvent(evt);\n        } else if (\n          tag != \"\" &&\n          typeof window.HaxStore.instance.elementList[tag.toLowerCase()] ===\n            typeof undefined\n        ) {\n          const evt = new CustomEvent(\"hax-register-properties\", {\n            bubbles: true,\n            composed: true,\n            cancelable: true,\n            detail: {\n              tag: tag.toLowerCase(),\n              properties: props\n            }\n          });\n          context.dispatchEvent(evt);\n        } else if (\n          typeof this.tagName !== typeof undefined &&\n          typeof window.HaxStore.instance.elementList[\n            this.tagName.toLowerCase()\n          ] === typeof undefined\n        ) {\n          const evt = new CustomEvent(\"hax-register-properties\", {\n            bubbles: true,\n            composed: true,\n            cancelable: true,\n            detail: {\n              tag: this.tagName.toLowerCase(),\n              properties: props\n            }\n          });\n          context.dispatchEvent(evt);\n        }\n      }\n    };\n    /**\n     * Setter to bridge private haxProperties setter.\n     * This is to then be implemented by the ready state of whatever is supplying the\n     * properties in order to be able to bubble up the properties for a tag.\n     */\n    this.setHaxProperties = (\n      props = {},\n      tag = \"\",\n      context = document,\n      isReady = false\n    ) => {\n      // these are a core piece of hax capabilities\n      // set them in the event this got called without anything\n      // so we at least won't bomb\n      if (typeof props.api === typeof undefined) {\n        props.api = \"1\";\n      }\n      // sets us up for future API versioning of property validation\n      // and clean up.\n      if (props.api == \"1\") {\n        if (typeof props.canPosition === typeof undefined) {\n          props.canPosition = true;\n        }\n        if (typeof props.canScale === typeof undefined) {\n          props.canScale = true;\n        }\n        if (typeof props.canEditSource === typeof undefined) {\n          props.canEditSource = false;\n        }\n        if (typeof props.gizmo === typeof undefined) {\n          props.gizmo = false;\n        }\n        // while not required, this is where all the raw power of this\n        // approach really lies since this wires properties/slots to HAX's\n        // ability to manipulate things via contextual menus\n        if (typeof props.settings !== typeof undefined) {\n          // loop through any potential settings in each of the three\n          // groupings of possible settings and validate that each setting is accurate\n          if (typeof props.settings.quick === typeof undefined) {\n            props.settings.quick = [];\n          }\n          for (let i = 0; i < props.settings.quick.length; i++) {\n            props.settings.quick[i] = this.validateSetting(\n              props.settings.quick[i]\n            );\n            // account for a bad property and remove it\n            if (!props.settings.quick[i]) {\n              props.settings.quick.splice(i, 1);\n            }\n          }\n          if (typeof props.settings.configure === typeof undefined) {\n            props.settings.configure = [];\n          }\n          for (let i = 0; i < props.settings.configure.length; i++) {\n            props.settings.configure[i] = this.validateSetting(\n              props.settings.configure[i]\n            );\n            if (!props.settings.configure[i]) {\n              props.settings.configure.splice(i, 1);\n            }\n          }\n          if (typeof props.settings.advanced === typeof undefined) {\n            props.settings.advanced = [];\n          }\n          for (let i = 0; i < props.settings.advanced.length; i++) {\n            props.settings.advanced[i] = this.validateSetting(\n              props.settings.advanced[i]\n            );\n            if (!props.settings.advanced[i]) {\n              props.settings.advanced.splice(i, 1);\n            }\n          }\n          // allow classes to be modified this way\n          props.settings.advanced.push({\n            attribute: \"class\",\n            title: \"Classes\",\n            description: \"CSS classes applied manually to the element\",\n            inputMethod: \"textfield\"\n          });\n          // allow styles to be modified this way\n          props.settings.advanced.push({\n            attribute: \"style\",\n            title: \"Styles\",\n            description: \"Custom CSS styles as applied to the element\",\n            inputMethod: \"textfield\"\n          });\n          // allow schema definitions\n          props.settings.advanced.push({\n            attribute: \"prefix\",\n            title: \"Schema: prefix\",\n            description: \"Schema prefixes\",\n            inputMethod: \"textfield\"\n          });\n          props.settings.advanced.push({\n            attribute: \"typeof\",\n            title: \"Schema: TypeOf\",\n            description: \"typeof definition for Schema usage\",\n            inputMethod: \"textfield\"\n          });\n          props.settings.advanced.push({\n            attribute: \"property\",\n            title: \"Schema: Property\",\n            description: \"typeof definition for Schema usage\",\n            inputMethod: \"textfield\"\n          });\n          props.settings.advanced.push({\n            attribute: \"resource\",\n            title: \"Schema: Resource ID\",\n            description: \"Schema resource identifier\",\n            inputMethod: \"textfield\"\n          });\n          // allow the id to be modified\n          props.settings.advanced.push({\n            attribute: \"id\",\n            title: \"ID\",\n            description: \"element ID, only set this if you know why\",\n            inputMethod: \"textfield\"\n          });\n          // we need to support slot in the UI but actually shift it around under the hood\n          // this is so that shadow roots don't get mad when previewing\n          props.settings.advanced.push({\n            attribute: \"data-hax-slot\",\n            title: \"slot\",\n            description: \"DOM slot area\",\n            inputMethod: \"textfield\"\n          });\n        }\n        // support for advanced save options\n        if (typeof props.saveOptions === typeof undefined) {\n          props.saveOptions = {\n            wipeSlot: false\n          };\n        }\n        // fire event so we know they have been set for the store to collect\n        // only fire if we haven't already so multiple elements don't keep bubbling\n\n        // if there's no global HaxStore then this means it is a custom\n        // implementation of the schema\n        if (isReady) {\n          if (tag != \"\" && typeof window.HaxStore === typeof undefined) {\n            const evt = new CustomEvent(\"hax-register-properties\", {\n              bubbles: true,\n              composed: true,\n              cancelable: true,\n              detail: {\n                tag: tag.toLowerCase(),\n                properties: props,\n                polymer: false\n              }\n            });\n            context.dispatchEvent(evt);\n          } else if (tag != \"\") {\n            const evt = new CustomEvent(\"hax-register-properties\", {\n              bubbles: true,\n              composed: true,\n              cancelable: true,\n              detail: {\n                tag: tag.toLowerCase(),\n                properties: props\n              }\n            });\n            context.dispatchEvent(evt);\n          } else if (typeof this.tagName !== typeof undefined) {\n            const evt = new CustomEvent(\"hax-register-properties\", {\n              bubbles: true,\n              composed: true,\n              cancelable: true,\n              detail: {\n                tag: this.tagName.toLowerCase(),\n                properties: props\n              }\n            });\n            context.dispatchEvent(evt);\n          } else {\n            console.warn(\n              `${tag} missed our checks and has an issue in implementation with HAX`\n            );\n          }\n        }\n        // only set these when tag hasn't been force fed\n        if (tag === \"\") {\n          if (typeof this._setHaxProperties === \"function\") {\n            this._setHaxProperties(props);\n          } else {\n            this.haxProperties = props;\n          }\n        }\n      } else {\n        // especially useful during development if we implement our own API\n        // incorrectly. Don't hard brick cause it'll still more or less work\n        // but would probably default to an iframe which is less then ideal\n        // but at least wouldn't brick the AX.\n        console.warn(\n          \"This is't a valid usage of hax API. See hax-body-behaviors/lib/HAXWiring.js for more details on how to implement the API. Most likely your hax item just was placed in an iframe as a fallback as opposed to a custom element.\"\n        );\n      }\n    };\n    /**\n     * Validate settings object.\n     */\n    this.validateSetting = setting => {\n      // we don't have a property or slot so it's not valid.\n      if (\n        typeof setting.property === typeof undefined &&\n        typeof setting.slot === typeof undefined &&\n        typeof setting.attribute === typeof undefined\n      ) {\n        return false;\n      }\n      // ensure there's a title\n      if (typeof setting.title === typeof undefined) {\n        if (typeof setting.attribute === typeof undefined) {\n          setting.title = setting.property;\n        } else {\n          setting.title = setting.attribute;\n        }\n      }\n      // ensure there's at least an empty description\n      if (typeof setting.description === typeof undefined) {\n        setting.description = \"\";\n      }\n      // ensure there's at least an input method\n      if (typeof setting.inputMethod === typeof undefined) {\n        setting.inputMethod = \"textfield\";\n      }\n      // ensure there's at least a type\n      if (typeof setting.type === typeof undefined) {\n        setting.type = \"settings\";\n      }\n      // ensure there's at least an icon\n      if (typeof setting.icon === typeof undefined) {\n        setting.icon = \"android\";\n      }\n      // ensure there's at least an empty options area\n      if (typeof setting.options === typeof undefined) {\n        setting.options = {};\n      }\n      // ensure there's required set\n      if (typeof setting.required === typeof undefined) {\n        setting.required = false;\n      }\n      // ensure there's required set\n      if (typeof setting.disabled === typeof undefined) {\n        setting.disabled = false;\n      }\n      // ensure there's validation or make it anything if none set\n      if (typeof setting.validation === typeof undefined) {\n        setting.validation = \".*\";\n      }\n      // ensure there's validation or make it anything if none set\n      if (typeof setting.validationType === typeof undefined) {\n        setting.validationType = \"\";\n      }\n      // slot can have a slot wrapper property\n      if (typeof setting.slot !== typeof undefined) {\n        if (typeof setting.slotWrapper === typeof undefined) {\n          setting.slotWrapper = \"span\";\n        }\n        if (typeof setting.slotAttributes === typeof undefined) {\n          setting.slotAttributes = {};\n        }\n      }\n      return setting;\n    };\n    /**\n     * Match convention for set.\n     */\n    this.getHaxProperties = () => {\n      return this.haxProperties;\n    };\n    /**\n     * Convert haxProperties structure to a simple json-schema.\n     * This allows for complex form building systems based on this data.\n     * type is configure or advanced\n     */\n    this.getHaxJSONSchema = (type, haxProperties, target = this) => {\n      if (typeof type === typeof undefined) {\n        type = \"configure\";\n      }\n      if (typeof haxProperties === typeof undefined) {\n        haxProperties = target.haxProperties;\n      }\n      let settings = haxProperties.settings[type];\n      var schema = {\n        $schema: \"http://json-schema.org/schema#\",\n        title: \"HAX \" + type + \" form schema\",\n        type: \"object\",\n        properties: {}\n      };\n      schema.properties = target._getHaxJSONSchemaProperty(settings, target);\n      // support post processing of schema in order to allow for really\n      // custom implementations that are highly dynamic in nature\n      schema = target.postProcessgetHaxJSONSchema(schema);\n      return schema;\n    };\n    /**\n     * Default postProcessgetHaxJSONSchema to be overridden.\n     */\n    this.postProcessgetHaxJSONSchema = schema => {\n      return schema;\n    };\n    /**\n     * Internal helper for getHaxJSONSchema to buiild the properties object\n     * correctly with support for recursive nesting thx to objects / arrays.\n     */\n    this._getHaxJSONSchemaProperty = (settings, target) => {\n      var props = {};\n      for (var value in settings) {\n        if (settings.hasOwnProperty(value)) {\n          if (typeof settings[value].property !== typeof undefined) {\n            props[settings[value].property] = {\n              title: settings[value].title,\n              type: target.getHaxJSONSchemaType(settings[value].inputMethod)\n            };\n            if (typeof target[settings[value].property] !== typeof undefined) {\n              props[settings[value].property].value =\n                target[settings[value].property];\n            }\n            if (settings[value].validationType == \"url\") {\n              props[settings[value].property].format = \"uri\";\n            }\n            if (settings[value].inputMethod == \"datepicker\") {\n              props[settings[value].property].format = \"date-time\";\n            }\n            if (settings[value].validation != \".*\") {\n              props[settings[value].property].pattern =\n                settings[value].validation;\n            }\n            switch (settings[value].inputMethod) {\n              case \"number\":\n                props[settings[value].property].component = {\n                  name: \"paper-input\",\n                  valueProperty: \"value\",\n                  properties: {\n                    required: settings[value].required,\n                    disabled: settings[value].disabled\n                  },\n                  attributes: {\n                    type: \"number\"\n                  }\n                };\n                break;\n              case \"select\":\n                let options = [];\n                for (var option in settings[value].options) {\n                  let item = [\n                    {\n                      alt: settings[value].options[option],\n                      value: option\n                    }\n                  ];\n                  options.push(item);\n                }\n                props[settings[value].property].component = {\n                  name: \"simple-picker\",\n                  valueProperty: \"value\",\n                  properties: {\n                    allowNull: settings[value].allowNull,\n                    blockLabel: true,\n                    required: settings[value].required,\n                    options: options,\n                    disabled: settings[value].disabled\n                  }\n                };\n                break;\n              case \"textarea\":\n                props[settings[value].property].component = {\n                  name: \"paper-textarea\",\n                  valueProperty: \"value\",\n                  properties: {\n                    required: settings[value].required,\n                    disabled: settings[value].disabled\n                  },\n                  attributes: {\n                    //\"auto-validate\": \"auto-validate\",\n                    \"char-counter\": \"char-counter\"\n                  }\n                };\n                break;\n              case \"code-editor\":\n                props[settings[value].property].component = {\n                  name: \"code-editor\",\n                  valueProperty: \"value\",\n                  properties: {\n                    editorValue: settings[value].value,\n                    title: settings[value].title,\n                    theme: \"vs\",\n                    mode: \"html\",\n                    className: \"hax-code-editor\"\n                  }\n                };\n                break;\n              case \"array\":\n                props[settings[value].property].items = {\n                  type: \"object\",\n                  properties: target._getHaxJSONSchemaProperty(\n                    settings[value].properties,\n                    target\n                  ),\n                  label: settings[value].itemLabel\n                };\n                break;\n              case \"tabs\":\n                props[settings[value].property].items = {\n                  type: \"object\",\n                  properties: target._getHaxJSONSchemaProperty(\n                    settings[value].properties,\n                    target\n                  )\n                };\n                break;\n              case \"textfield\":\n                props[settings[value].property].component = {\n                  name: \"paper-input\",\n                  valueProperty: \"value\",\n                  properties: {\n                    required: settings[value].required,\n                    disabled: settings[value].disabled\n                  },\n                  attributes: {\n                    \"auto-validate\": \"auto-validate\"\n                  }\n                };\n                break;\n              case \"alt\":\n                props[settings[value].property].component = {\n                  name: \"paper-input-flagged\",\n                  valueProperty: \"value\",\n                  properties: {\n                    required: settings[value].required,\n                    disabled: settings[value].disabled\n                  },\n                  attributes: {\n                    \"auto-validate\": \"auto-validate\"\n                  }\n                };\n                break;\n              case \"colorpicker\":\n                props[settings[value].property].component = {\n                  name: \"simple-colors-picker\",\n                  valueProperty: \"value\",\n                  properties: {\n                    allowNull: settings[value].allowNull,\n                    blockLabel: true,\n                    required: settings[value].required,\n                    label: settings[value].title,\n                    disabled: settings[value].disabled\n                  }\n                };\n                break;\n              case \"iconpicker\":\n                props[settings[value].property].component = {\n                  name: \"simple-icon-picker\",\n                  valueProperty: \"value\",\n                  properties: {\n                    allowNull: settings[value].allowNull,\n                    blockLabel: true,\n                    required: settings[value].required,\n                    hideOptionLabels: true,\n                    label: settings[value].title,\n                    disabled: settings[value].disabled\n                  }\n                };\n                // support options array of icons to pick from\n                let opts =\n                  settings[value].options !== undefined &&\n                  settings[value].options !== null\n                    ? settings[value].options\n                    : [];\n                props[\n                  settings[value].property\n                ].component.properties.icons = opts;\n                break;\n              case \"datepicker\":\n                props[settings[value].property].component = {\n                  name: \"paper-input\",\n                  valueProperty: \"date\",\n                  properties: {\n                    type: \"date\",\n                    required: settings[value].required,\n                    disabled: settings[value].disabled\n                  }\n                };\n                break;\n              case \"haxupload\":\n                props[settings[value].property].component = {\n                  name: \"hax-upload-field\",\n                  valueProperty: \"value\",\n                  properties: {\n                    formDataName: \"file-upload\",\n                    disabled: settings[value].disabled,\n                    required: settings[value].required\n                  }\n                };\n                break;\n            }\n            if (settings[value].hidden !== typeof undefined) {\n              props[settings[value].property].hidden = settings[value].hidden;\n            }\n            if (settings[value].description !== typeof undefined) {\n              props[settings[value].property].description =\n                settings[value].description;\n            }\n          } else if (typeof settings[value].attribute !== typeof undefined) {\n            props[settings[value].attribute] = {\n              title: settings[value].title,\n              type: target.getHaxJSONSchemaType(settings[value].inputMethod)\n            };\n            // special support for className\n            if (settings[value].attribute === \"class\") {\n              props[settings[value].attribute].value = target.className;\n            } else if (settings[value].attribute === \"style\") {\n              props[settings[value].attribute].value = target.style.cssText;\n            } else if (\n              typeof target.attributes[settings[value].attribute] !==\n              typeof undefined\n            ) {\n              props[settings[value].attribute].value = target.getAttribute(\n                settings[value].attribute\n              );\n            }\n            // special validation on uri based attributes\n            if (value == \"href\" || value == \"src\") {\n              props[settings[value].attribute].format = \"uri\";\n            }\n            if (settings[value].validationType == \"url\") {\n              props[settings[value].attribute].format = \"uri\";\n            }\n            if (settings[value].inputMethod == \"datepicker\") {\n              props[settings[value].attribute].format = \"date-time\";\n            }\n            if (settings[value].validation != \".*\") {\n              props[settings[value].attribute].pattern =\n                settings[value].validation;\n            }\n            switch (settings[value].inputMethod) {\n              case \"number\":\n                props[settings[value].attribute].component = {\n                  name: \"paper-input\",\n                  valueProperty: \"value\",\n                  properties: {\n                    required: settings[value].required,\n                    disabled: settings[value].disabled\n                  },\n                  attributes: {\n                    type: \"number\"\n                  }\n                };\n                break;\n              case \"select\":\n                let options = [];\n                for (var option in settings[value].options) {\n                  let item = [\n                    {\n                      alt: settings[value].options[option],\n                      value: option\n                    }\n                  ];\n                  options.push(item);\n                }\n                props[settings[value].attribute].component = {\n                  name: \"simple-picker\",\n                  valueProperty: \"value\",\n                  properties: {\n                    allowNull: settings[value].allowNull,\n                    blockLabel: true,\n                    required: settings[value].required,\n                    options: options,\n                    disabled: settings[value].disabled\n                  }\n                };\n                break;\n              case \"textarea\":\n                props[settings[value].attribute].component = {\n                  name: \"paper-textarea\",\n                  valueProperty: \"value\",\n                  properties: {\n                    required: settings[value].required,\n                    disabled: settings[value].disabled\n                  },\n                  attributes: {\n                    //\"auto-validate\": \"auto-validate\",\n                    \"char-counter\": \"char-counter\"\n                  }\n                };\n                break;\n              case \"code-editor\":\n                props[settings[value].attribute].component = {\n                  name: \"code-editor\",\n                  valueProperty: \"value\",\n                  properties: {\n                    editorValue: props[settings[value].attribute].value,\n                    title: settings[value].title,\n                    readOnly: false,\n                    theme: \"vs\",\n                    mode: \"html\",\n                    className: \"hax-code-editor\"\n                  }\n                };\n                break;\n              case \"textfield\":\n                props[settings[value].attribute].component = {\n                  name: \"paper-input\",\n                  valueProperty: \"value\",\n                  properties: {\n                    required: settings[value].required,\n                    disabled: settings[value].disabled\n                  },\n                  attributes: {\n                    \"auto-validate\": \"auto-validate\"\n                  }\n                };\n                break;\n              case \"alt\":\n                props[settings[value].attribute].component = {\n                  name: \"paper-input-flagged\",\n                  valueProperty: \"value\",\n                  properties: {\n                    required: settings[value].required,\n                    disabled: settings[value].disabled\n                  },\n                  attributes: {\n                    \"auto-validate\": \"auto-validate\"\n                  }\n                };\n                break;\n              case \"colorpicker\":\n                props[settings[value].attribute].component = {\n                  name: \"simple-colors-picker\",\n                  valueProperty: \"value\",\n                  properties: {\n                    required: settings[value].required,\n                    disabled: settings[value].disabled\n                  }\n                };\n                break;\n              case \"haxupload\":\n                props[settings[value].attribute].component = {\n                  name: \"hax-upload-field\",\n                  valueProperty: \"value\",\n                  properties: {\n                    formDataName: \"file-upload\",\n                    required: settings[value].required,\n                    disabled: settings[value].disabled\n                  }\n                };\n                break;\n            }\n            if (settings[value].description !== typeof undefined) {\n              props[settings[value].attribute].description =\n                settings[value].description;\n            }\n          } else {\n            // @todo slot should support other editor types... maybe\n            props[settings[value].slot] = {\n              title: settings[value].title,\n              type: target.getHaxJSONSchemaType(settings[value].inputMethod),\n              value: \"\",\n              component: {\n                name: \"code-editor\",\n                valueProperty: \"value\",\n                properties: {\n                  editorValue: settings[value].value,\n                  title: settings[value].title,\n                  theme: \"vs\",\n                  mode: \"html\",\n                  className: \"hax-code-editor\"\n                }\n              }\n            };\n            var slot = \"\";\n            // test for slotted content values names is tricky\n            for (var i in dom(target).childNodes) {\n              // this is crazy... you know that right\n              if (typeof dom(target).childNodes[i] !== typeof undefined) {\n                if (dom(target).childNodes[i].nodeType === 1) {\n                  // make sure slots that are named line up\n                  if (settings[value].slot === dom(target).childNodes[i].slot) {\n                    slot += dom(target).childNodes[i].innerHTML;\n                  }\n                } else if (\n                  dom(target).childNodes[i].nodeType !== 1 &&\n                  typeof dom(target).childNodes[i].textContent !==\n                    typeof undefined &&\n                  dom(target).childNodes[i].textContent !== \"\"\n                ) {\n                  slot += dom(target).childNodes[i].textContent;\n                }\n              }\n            }\n            // @todo verify this stuff actually works\n            props[\n              settings[value].slot\n            ].component.properties.editorValue = slot.trim();\n            if (settings[value].description !== typeof undefined) {\n              props[settings[value].slot].description =\n                settings[value].description;\n            }\n          }\n        }\n      }\n      return props;\n    };\n    /**\n     * Convert input method to schema type\n     */\n    this.getHaxJSONSchemaType = inputMethod => {\n      var methods = this.validHAXPropertyInputMethod();\n      if (methods.includes(inputMethod)) {\n        switch (inputMethod) {\n          case \"flipboolean\":\n          case \"boolean\":\n            return \"boolean\";\n            break;\n          case \"number\":\n            return \"number\";\n            break;\n          case \"select\":\n          case \"textarea\":\n          case \"colorpicker\":\n          case \"iconpicker\":\n          case \"datepicker\":\n          case \"haxupload\":\n          case \"textfield\":\n          case \"alt\":\n            return \"string\";\n            break;\n          case \"array\":\n            return \"array\";\n            break;\n          default:\n            return \"string\";\n            break;\n        }\n      }\n    };\n    /**\n     * List valid input methods.\n     */\n    this.validHAXPropertyInputMethod = () => {\n      var methods = [\n        \"flipboolean\",\n        \"boolean\",\n        \"select\",\n        \"textfield\",\n        \"textarea\",\n        \"datepicker\",\n        \"haxupload\",\n        \"colorpicker\",\n        \"iconpicker\",\n        \"alt\",\n        \"number\",\n        \"code-editor\",\n        \"array\"\n      ];\n      return methods;\n    };\n    /**\n     * Return a haxProperties prototype / example structure\n     */\n    this.prototypeHaxProperties = () => {\n      // example properties valid for HAX context menu.\n      let props = {\n        api: \"1\",\n        canScale: true,\n        canPosition: true,\n        canEditSource: false,\n        gizmo: {\n          title: \"Tag name\",\n          description: \"A description\",\n          icon: \"av:play-circle-filled\",\n          color: \"blue\",\n          groups: [\"Content\"],\n          handles: [\n            {\n              type: \"data\",\n              url: \"src\"\n            }\n          ],\n          meta: {\n            author: \"\"\n          }\n        },\n        settings: {\n          quick: [\n            {\n              property: \"title\",\n              title: \"Title\",\n              inputMethod: \"textfield\",\n              icon: \"android\"\n            },\n            {\n              property: \"primaryColor\",\n              title: \"Primary color\",\n              inputMethod: \"colorpicker\",\n              icon: \"color\"\n            }\n          ],\n          configure: [\n            {\n              slot: \"\",\n              title: \"Inner content\",\n              description: \"The slotted content that lives inside the tag\",\n              inputMethod: \"textfield\",\n              icon: \"android\",\n              required: true,\n              validationType: \"text\"\n            },\n            {\n              slot: \"button\",\n              title: \"Button content\",\n              description: \"The content that can override the button\",\n              inputMethod: \"textfield\",\n              icon: \"android\",\n              required: true,\n              validationType: \"text\"\n            },\n            {\n              property: \"title\",\n              title: \"Title\",\n              description: \"\",\n              inputMethod: \"textfield\",\n              icon: \"android\",\n              required: true,\n              validationType: \"text\"\n            },\n            {\n              property: \"primaryColor\",\n              title: \"Title\",\n              description: \"\",\n              inputMethod: \"textfield\",\n              icon: \"android\",\n              required: false,\n              validation: \".*\",\n              validationType: \"text\"\n            }\n          ],\n          advanced: [\n            {\n              property: \"secondaryColor\",\n              title: \"Secondary color\",\n              description:\n                \"An optional secondary color used in certain edge cases.\",\n              inputMethod: \"colorpicker\",\n              icon: \"color\"\n            },\n            {\n              property: \"endPoint\",\n              title: \"API endpoint\",\n              description:\n                \"An optional endpoint to hit and load in more data dymaically.\",\n              inputMethod: \"textfield\",\n              icon: \"android\",\n              validation: \"[a-z0-9]\",\n              validationType: \"url\"\n            }\n          ]\n        },\n        saveOptions: {\n          wipeSlot: false,\n          unsetAttributes: [\"end-point\", \"secondary-color\"]\n        }\n      };\n      return props;\n    };\n  }\n}\n/**\n * Super class element partial. This mixes the HAXWiring capabilities into the element itself.\n * Use this in instances where you want direct access to all the functions in the element itself\n */\nexport const HAXElement = function(SuperClass) {\n  return class extends SuperClass {\n    constructor() {\n      super();\n      this.HAXWiring = new HAXWiring();\n    }\n    static get properties() {\n      let props = {\n        /**\n         * haxProperties\n         */\n        haxProperties: window.HAXWiring.haxProperties\n      };\n      if (super.properties) {\n        props = Object.assign(props, super.properties);\n      }\n      return props;\n    }\n    /**\n     * Setter to bridge private haxProperties setter.\n     * This is to then be implemented by the ready state of whatever is supplying the\n     * properties in order to be able to bubble up the properties for a tag.\n     */\n    setHaxProperties(props, tag = \"\", context = this) {\n      if (tag == \"\" && typeof this.tagName !== typeof undefined) {\n        tag = this.tagName.toLowerCase();\n      }\n      window.addEventListener(\n        \"hax-store-ready\",\n        this._haxStoreReady.bind(this)\n      );\n      if (\n        typeof window.HaxStore !== typeof undefined &&\n        window.HaxStore.instance != null &&\n        window.HaxStore.ready\n      ) {\n        return this.HAXWiring.setHaxProperties(props, tag, context, true);\n      } else {\n        return this.HAXWiring.setHaxProperties(props, tag, context, false);\n      }\n    }\n    /**\n     * Setter to bridge private haxProperties setter.\n     * This is to then be implemented by the ready state of whatever is supplying the\n     * properties in order to be able to bubble up the properties for a tag.\n     */\n    setup(props, tag = \"\", context = this) {\n      return this.HAXWiring.setup(props, (tag = \"\"), (context = this));\n    }\n    /**\n     * Private function to fire off props when ready\n     */\n    _haxStoreReady(e) {\n      return this.HAXWiring._haxStoreReady(e);\n    }\n    /**\n     * Validate settings object.\n     */\n    validateSetting(setting) {\n      return this.HAXWiring.validateSetting(setting);\n    }\n    /**\n     * Match convention for set.\n     */\n    getHaxProperties() {\n      return this.haxProperties;\n    }\n    /**\n     * Convert haxProperties structure to a simple json-schema.\n     * This allows for complex form building systems based on this data.\n     * type is configure or advanced\n     */\n    getHaxJSONSchema(type, haxProperties, target = this) {\n      return this.HAXWiring.getHaxJSONSchema(type, haxProperties, target);\n    }\n    /**\n     * Default postProcessgetHaxJSONSchema to be overridden.\n     */\n    postProcessgetHaxJSONSchema(schema) {\n      return this.HAXWiring.postProcessgetHaxJSONSchema(schema);\n    }\n    /**\n     * Internal helper for getHaxJSONSchema to buiild the properties object\n     * correctly with support for recursive nesting thx to objects / arrays.\n     */\n    _getHaxJSONSchemaProperty(settings, target) {\n      return this.HAXWiring._getHaxJSONSchemaProperty(settings, target);\n    }\n    /**\n     * Convert input method to schedma type\n     */\n    getHaxJSONSchemaType(inputMethod) {\n      return this.HAXWiring.getHaxJSONSchemaType(inputMethod);\n    }\n    /**\n     * List valid input methods.\n     */\n    validHAXPropertyInputMethod() {\n      return this.HAXWiring.validHAXPropertyInputMethod();\n    }\n    /**\n     * Return a haxProperties prototype / example structure\n     */\n    prototypeHaxProperties() {\n      return this.HAXWiring.prototypeHaxProperties();\n    }\n  };\n};\n\n// LEGACY. This is a Polymer 1.x syntax element \"behavior\"\n// This has been replaced with HAXElement, a super class which can be used to wrap classes\n// invoke an instance so we can support behaviors as well\nwindow.HAXWiring = new HAXWiring();\n// ensure HAXPropertiesBehaviors exists\nwindow.HAXBehaviors = window.HAXBehaviors || {};\nwindow.HAXBehaviors.PropertiesBehaviors = {\n  properties: {\n    /**\n     * haxProperties\n     */\n    haxProperties: window.HAXWiring.haxProperties\n  },\n  /**\n   * Setter to bridge private haxProperties setter.\n   * This is to then be implemented by the ready state of whatever is supplying the\n   * properties in order to be able to bubble up the properties for a tag.\n   */\n  setHaxProperties: function(props, tag = \"\", context = this) {\n    if (tag == \"\" && typeof this.tagName !== typeof undefined) {\n      tag = this.tagName.toLowerCase();\n    }\n    window.addEventListener(\"hax-store-ready\", this._haxStoreReady.bind(this));\n    if (\n      typeof window.HaxStore !== typeof undefined &&\n      window.HaxStore.instance != null &&\n      window.HaxStore.ready\n    ) {\n      return window.HAXWiring.setHaxProperties(props, tag, context, true);\n    } else {\n      return window.HAXWiring.setHaxProperties(props, tag, context, false);\n    }\n  },\n  /**\n   * Private function to fire off props when ready\n   */\n  _haxStoreReady: function(e) {\n    return window.HAXWiring._haxStoreReady(e);\n  },\n  /**\n   * Validate settings object.\n   */\n  validateSetting: function(setting) {\n    return window.HAXWiring.validateSetting(setting);\n  },\n  /**\n   * Match convention for set.\n   */\n  getHaxProperties: function() {\n    return this.haxProperties;\n  },\n  /**\n   * Convert haxProperties structure to a simple json-schema.\n   * This allows for complex form building systems based on this data.\n   * type is configure or advanced\n   */\n  getHaxJSONSchema: function(type, haxProperties, target = this) {\n    return window.HAXWiring.getHaxJSONSchema(type, haxProperties, target);\n  },\n  /**\n   * Default postProcessgetHaxJSONSchema to be overridden.\n   */\n  postProcessgetHaxJSONSchema: function(schema) {\n    return window.HAXWiring.postProcessgetHaxJSONSchema(schema);\n  },\n  /**\n   * Internal helper for getHaxJSONSchema to buiild the properties object\n   * correctly with support for recursive nesting thx to objects / arrays.\n   */\n  _getHaxJSONSchemaProperty: function(settings, target) {\n    return window.HAXWiring._getHaxJSONSchemaProperty(settings, target);\n  },\n  /**\n   * Convert input method to schedma type\n   */\n  getHaxJSONSchemaType: function(inputMethod) {\n    return window.HAXWiring.getHaxJSONSchemaType(inputMethod);\n  },\n  /**\n   * List valid input methods.\n   */\n  validHAXPropertyInputMethod: function() {\n    return window.HAXWiring.validHAXPropertyInputMethod();\n  },\n  /**\n   * Return a haxProperties prototype / example structure\n   */\n  prototypeHaxProperties: function() {\n    return window.HAXWiring.prototypeHaxProperties();\n  }\n};\n"],"names":["HAXWiring","haxProperties","canScale","canPosition","canEditSource","settings","quick","configure","advanced","wipeSlot","setup","props","tag","context","_this","_typeof","tagName","toLowerCase","window","addEventListener","_haxStoreReady","bind","HaxStore","instance","ready","setHaxProperties","e","detail","evt","CustomEvent","bubbles","composed","cancelable","properties","polymer","dispatchEvent","elementList","document","isReady","api","gizmo","i","length","validateSetting","splice","push","attribute","title","description","inputMethod","saveOptions","console","warn","_setHaxProperties","setting","property","slot","type","icon","options","required","disabled","validation","validationType","slotWrapper","slotAttributes","getHaxProperties","getHaxJSONSchema","target","schema","$schema","_getHaxJSONSchemaProperty","postProcessgetHaxJSONSchema","value","hasOwnProperty","getHaxJSONSchemaType","format","pattern","component","name","valueProperty","attributes","option","item","alt","allowNull","blockLabel","editorValue","theme","mode","className","items","label","itemLabel","hideOptionLabels","opts","undefined","icons","formDataName","hidden","style","cssText","getAttribute","readOnly","dom","childNodes","nodeType","innerHTML","textContent","trim","validHAXPropertyInputMethod","includes","prototypeHaxProperties","color","groups","handles","url","meta","author","unsetAttributes","HAXBehaviors","PropertiesBehaviors","this","SuperClass","Object","assign"],"mappings":"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"}