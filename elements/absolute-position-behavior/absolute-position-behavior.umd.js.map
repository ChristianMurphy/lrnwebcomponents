{"version":3,"file":"absolute-position-behavior.umd.js","sources":["lib/absolute-position-state-manager.js","absolute-position-behavior.umd.js"],"sourcesContent":["/**\n * Copyright 2018 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport { html, PolymerElement } from \"@polymer/polymer/polymer-element.js\";\nimport \"@polymer/iron-resizable-behavior/iron-resizable-behavior.js\";\n\n// register globally so we can make sure there is only one\nwindow.AbsolutePositionStateManager = window.AbsolutePositionStateManager || {};\n// request if this exists. This helps invoke the element existing in the dom\n// as well as that there is only one of them. That way we can ensure everything\n// is rendered through the same modal\nwindow.AbsolutePositionStateManager.requestAvailability = () => {\n  if (!window.AbsolutePositionStateManager.instance) {\n    window.AbsolutePositionStateManager.instance = document.createElement(\n      \"absolute-position-state-manager\"\n    );\n    document.body.appendChild(window.AbsolutePositionStateManager.instance);\n  }\n  return window.AbsolutePositionStateManager.instance;\n};\n/**\n * `absolute-position-state-manager`\n * `A utility that manages the state of multiple a11y-media-players on a single page.`\n *\n * @microcopy - language worth noting:\n *  -\n *\n * @customElement\n * @polymer\n */\nclass AbsolutePositionStateManager extends PolymerElement {\n  /* REQUIRED FOR TOOLING DO NOT TOUCH */\n\n  /**\n   * Store the tag name to make it easier to obtain directly.\n   * @notice function name must be here for tooling to operate correctly\n   */\n  static get tag() {\n    return \"absolute-position-state-manager\";\n  }\n\n  // properties available to the custom element for data binding\n  static get properties() {\n    return {\n      /**\n       * Stores an array of all the players on the page.\n       */\n      elements: {\n        type: Array,\n        value: []\n      }\n    };\n  }\n\n  /**\n   * Makes sure there is a utility ready and listening for elements.\n   */\n  constructor() {\n    super();\n    let root = this;\n\n    // sets the instance to the current instance\n    if (!window.AbsolutePositionStateManager.instance) {\n      window.AbsolutePositionStateManager.instance = this;\n      return this;\n    }\n  }\n\n  /**\n   * life cycle, element is afixed to the DOM\n   * Makes sure there is a utility ready and listening for elements.\n   */\n  connectedCallback() {\n    super.connectedCallback();\n  }\n\n  /**\n   * Loads element into array\n   */\n  loadElement(el) {\n    let root = this;\n    root.__on = root.__on !== undefined ? root.__on : false;\n    root.elements.push(el);\n    root.updatePosition(el);\n    if (!root.__on) root.addEventListeners();\n    root.__on = true;\n  }\n\n  /**\n   * Unloads element from array\n   */\n  unloadElement(el) {\n    let root = this;\n    root.elements.filter(element => element === el);\n    root.__on = root.elements > 0;\n    if (!root.__on) root.removeEventListeners();\n  }\n\n  /**\n   * Adds event listeners\n   */\n  addEventListeners() {\n    let root = this;\n    root.__timeout = false;\n    root.updateElements();\n    document.addEventListener(\"load\", root.updateElements());\n    window.addEventListener(\"resize\", function() {\n      clearTimeout(root.__timeout);\n      root.__timeout = setTimeout(root.updateElements(), 250);\n    });\n    root.__observer = new MutationObserver(function(mutations) {\n      root.updateElements();\n    });\n    root.__observer.observe(document, {\n      attributes: true,\n      childList: true,\n      subtree: true,\n      characterData: true\n    });\n  }\n\n  /**\n   * Returns the target element that this tooltip is anchored to. It is\n   * either the element given by the `for` attribute, or the immediate parent\n   * of the tooltip.\n   *\n   * @type {Node}\n   */\n  findTarget(el) {\n    let target;\n    let parentNode = this.parentNode;\n    if (el.target) {\n      target = el.target;\n    } else if (el.for) {\n      target = parentNode.querySelector(\"#\" + el.for);\n    } else {\n      let ownerRoot = el.shadowRoot;\n      target =\n        parentNode.nodeType == Node.DOCUMENT_FRAGMENT_NODE\n          ? ownerRoot.host\n          : parentNode;\n    }\n    return target;\n  }\n\n  /**\n   * Removes event listeners\n   */\n  removeEventListeners() {\n    let root = this;\n    document.removeEventListener(\"load\", root.updateElements());\n    window.removeEventListener(\"resize\", function() {\n      clearTimeout(root.__timeout);\n      root.__timeout = setTimeout(root.updateElements(), 250);\n    });\n    if (root.__observer) {\n      root.__observer.disconnect();\n    }\n  }\n\n  /**\n   * stops all other players on the page\n   */\n  updateElements() {\n    let root = this;\n    root.elements.forEach(element => {\n      root.updatePosition(element);\n    });\n  }\n\n  /**\n   * @return {void}\n   */\n  updatePosition(element) {\n    let target = this.findTarget(element);\n    if (!target || !element.offsetParent) return;\n    var offset = element.offset;\n    var parentRect = element.offsetParent.getBoundingClientRect();\n    var targetRect = target.getBoundingClientRect();\n    var elementRect = element.getBoundingClientRect();\n    var horizontalCenterOffset = (targetRect.width - elementRect.width) / 2;\n    var verticalCenterOffset = (targetRect.height - elementRect.height) / 2;\n    //var targetLeft = targetRect.left - parentRect.left;\n    //var targetTop = targetRect.top - parentRect.top;\n    var tooltipLeft, tooltipTop;\n    switch (element.position) {\n      case \"top\":\n        tooltipLeft = targetRect.left + horizontalCenterOffset;\n        tooltipTop = targetRect.top - elementRect.height - offset;\n        break;\n      case \"bottom\":\n        tooltipLeft = targetRect.left + horizontalCenterOffset;\n        tooltipTop = targetRect.top + targetRect.height + offset;\n        break;\n      case \"left\":\n        tooltipLeft = targetRect.left - elementRect.width - offset;\n        tooltipTop = targetRect.top + verticalCenterOffset;\n        break;\n      case \"right\":\n        tooltipLeft = targetRect.left + targetRect.width + offset;\n        tooltipTop = targetRect.top + verticalCenterOffset;\n        break;\n    }\n    element.style.position = \"absolute\";\n    // TODO(noms): This should use IronFitBehavior if possible.\n    if (element.fitToVisibleBounds) {\n      // Clip the left/right side\n      if (\n        parentRect.left + tooltipLeft + elementRect.width >\n        window.innerWidth\n      ) {\n        element.style.right = \"0px\";\n        element.style.left = \"auto\";\n      } else {\n        element.style.left = Math.max(0, tooltipLeft) + \"px\";\n        element.style.right = \"auto\";\n      }\n      // Clip the top/bottom side.\n      if (\n        parentRect.top + tooltipTop + elementRect.height >\n        window.innerHeight\n      ) {\n        element.style.bottom =\n          parentRect.height - targetRect.top + offset + \"px\";\n        element.style.top = \"auto\";\n      } else {\n        element.style.top = Math.max(-parentRect.top, tooltipTop) + \"px\";\n        element.style.bottom = \"auto\";\n      }\n    } else {\n      element.style.left = tooltipLeft + \"px\";\n      element.style.top = tooltipTop + \"px\";\n    }\n  }\n\n  /**\n   * life cycle, element is removed from the DOM\n   */\n  disconnectedCallback() {\n    this.removeEventListeners();\n    super.disconnectedCallback();\n  }\n}\nwindow.customElements.define(\n  AbsolutePositionStateManager.tag,\n  AbsolutePositionStateManager\n);\nexport { AbsolutePositionStateManager };\n","/**\n * Copyright 2019 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport { html, PolymerElement } from \"@polymer/polymer/polymer-element.js\";\nimport \"./lib/absolute-position-state-manager\";\n\n/**\n * `absolute-position-behavior`\n * `Abstracting the positioning behavior from paper-tooltip to be resusable in other elements`\n *\n * @microcopy - language worth noting:\n *  -\n *\n * @customElement\n * @polymer\n * @demo demo/index.html\n */\nclass AbsolutePositionBehavior extends PolymerElement {\n  \n  // render function\n  static get template() {\n    return html`\n<style>:host {\n  display: block;\n}\n\n:host([hidden]) {\n  display: none;\n}\n</style>\n<slot></slot>`;\n  }\n\n  // properties available to the custom element for data binding\n  static get properties() {\n    return {\n  /**\n   * Element is positioned from connected to disconnected?\n   * Otherwise setPosition and unsetPosition must be called manually.\n   */\n  \"auto\": {\n    \"type\": Boolean,\n    \"value\": false\n  },\n  /**\n   * If true, no parts of the tooltip will ever be shown offscreen.\n   */\n  \"fitToVisibleBounds\": {\n    \"type\": Boolean,\n    \"value\": false,\n    \"observer\": \"updatePosition\"\n  },\n  /**\n   * The id of the element that the tooltip is anchored to. This element\n   * must be a sibling of the tooltip. If this property is not set,\n   * then the tooltip will be centered to the parent node containing it.\n   */\n  \"for\": {\n    \"type\": String,\n    \"observer\": \"updatePosition\"\n  },\n  /**\n   * The spacing between the top of the tooltip and the element it is\n   * anchored to.\n   */\n  \"offset\": {\n    \"type\": Number,\n    \"value\": 0\n  },\n  /**\n   * Positions the tooltip to the top, right, bottom, left of its content.\n   */\n  \"position\": {\n    \"type\": String,\n    \"value\": \"bottom\",\n    \"observer\": \"updatePosition\",\n    \"reflectToAttribute\": true\n  },\n  /**\n   * The actual target element\n   */\n  \"target\": {\n    \"type\": Object,\n    \"observer\": \"updatePosition\"\n  }\n}\n;\n  }\n\n  /**\n   * Store the tag name to make it easier to obtain directly.\n   * @notice function name must be here for tooling to operate correctly\n   */\n  static get tag() {\n    return \"absolute-position-behavior\";\n  }\n\n  /**\n   * life cycle, element is afixed to the DOM\n   */\n  connectedCallback() {\n    super.connectedCallback();\n  }\n\n  /**\n   * life cycle, element is ready\n   */\n  ready() {\n    super.ready();\n    let root = this;\n    root.__observe = false;\n    root.__manager = window.AbsolutePositionStateManager.requestAvailability();\n    if (root.auto === true) {\n      root.setPosition();\n    }\n  }\n\n  setPosition() {\n    let root = this;\n    root.__observe = true;\n    root.__manager.loadElement(root);\n  }\n\n  unsetPosition() {\n    let root = this;\n    root.__observe = false;\n    root.__manager.unloadElement(root);\n  }\n\n  updatePosition() {\n    let root = this;\n    if (root.__observe === true) {\n      root.__manager.updatePosition(root);\n    }\n  }\n  /**\n   * life cycle, element is removed from the DOM\n   */\n  disconnectedCallback() {\n    this.unsetPosition();\n    super.disconnectedCallback();\n  }\n}\nwindow.customElements.define(\n  AbsolutePositionBehavior.tag,\n  AbsolutePositionBehavior\n);\nexport { AbsolutePositionBehavior };\n"],"names":["window","AbsolutePositionStateManager","requestAvailability","instance","document","createElement","body","appendChild","PolymerElement","elements","type","Array","value","el","this","__on","undefined","push","updatePosition","addEventListeners","filter","element","removeEventListeners","root","__timeout","updateElements","addEventListener","clearTimeout","setTimeout","__observer","MutationObserver","mutations","observe","attributes","childList","subtree","characterData","target","parentNode","querySelector","ownerRoot","shadowRoot","nodeType","Node","DOCUMENT_FRAGMENT_NODE","host","removeEventListener","disconnect","forEach","findTarget","offsetParent","tooltipLeft","tooltipTop","offset","parentRect","getBoundingClientRect","targetRect","elementRect","horizontalCenterOffset","width","verticalCenterOffset","height","position","left","top","style","fitToVisibleBounds","innerWidth","right","Math","max","innerHeight","bottom","customElements","define","tag","AbsolutePositionBehavior","__observe","__manager","auto","setPosition","loadElement","unloadElement","unsetPosition","html","Boolean","String","Number","Object"],"mappings":"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"}