{"version":3,"file":"h5p-element.umd.js","sources":["h5p-element.umd.js"],"sourcesContent":["/**\n * Copyright 2019 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport { LitElement, html, css } from \"lit-element/lit-element.js\";\nimport \"@lrnwebcomponents/es-global-bridge/es-global-bridge.js\";\nwindow.__H5PBridgeTimeOut = function() {\n  setTimeout(function() {\n    window.H5P.init();\n  }, 500);\n};\n/**\n * `h5p-element`\n * `h5p wrapper for loading and presenting .h5p files`\n *\n * @microcopy - language worth noting:\n *  - h5p is it's own eco system, we're just trying to wrap it a bit\n *\n * @customElement\n * @lit-element\n * @demo demo/index.html\n */\nclass H5PElement extends LitElement {\n  \n  //styles function\n  static get styles() {\n    return  [\n      css`\n:host {\n  display: block;\n}\n      `\n    ];\n  }\n  // render function\n  render() {\n    return html`\n\n<div class=\"h5p-container\" data-content-id=\"wrapper-${this.contentId}\"></div>`;\n  }\n\n  // haxProperty definition\n  static get haxProperties() {\n    return {\n  \"canScale\": true,\n  \"canPosition\": true,\n  \"canEditSource\": false,\n  \"gizmo\": {\n    \"title\": \"H5P element\",\n    \"description\": \"h5p wrapper for loading and presenting .h5p files\",\n    \"icon\": \"icons:android\",\n    \"color\": \"green\",\n    \"groups\": [\"Interactive\"],\n    \"meta\": {\n      \"author\": \"btopro\",\n      \"owner\": \"The Pennsylvania State University\"\n    }\n  },\n  \"settings\": {\n    \"quick\": [],\n    \"configure\": [\n      {\n        \"attribute\": \"source\",\n        \"description\": \"Location the H5P file was unpacked to\",\n        \"inputMethod\": \"textfield\",\n        \"required\": true,\n        \"icon\": \"icons:link\"\n      }\n    ],\n    \"advanced\": []\n  },\n  \"saveOptions\": {\n    \"wipeSlot\": true,\n    \"unsetAttributes\": [\"content-id\"]\n  }\n}\n;\n  }\n  // properties available to the custom element for data binding\n  static get properties() {\n    let props = {\n  /**\n   * Source of the .h5p file\n   */\n  \"source\": {\n    \"name\": \"source\",\n    \"type\": String\n  }\n}\n;\n    if (super.properties) {\n      props = Object.assign(props, super.properties);\n    }\n    return props;\n  }\n\n  /**\n   * Store the tag name to make it easier to obtain directly.\n   * @notice function name must be here for tooling to operate correctly\n   */\n  static get tag() {\n    return \"h5p-element\";\n  }\n\n  // life cycle\n  constructor() {\n    super();\n    // make a random ID for the targeting\n    this.contentId = this.generateUUID();\n    // should kick off all dependencies to start loading on window\n    this.H5PDepsLoader();\n  }\n  /**\n   * This breaks shadowRoot in LitElement\n   */\n  createRenderRoot() {\n    return this;\n  }\n  // simple path from a url modifier\n  pathFromUrl(url) {\n    return url.substring(0, url.lastIndexOf(\"/\") + 1);\n  }\n  /**\n   * load dependencies that need to be global in scope\n   */\n  async H5PDepsLoader() {\n    window.ESGlobalBridge.requestAvailability();\n    const basePath =\n      this.pathFromUrl(decodeURIComponent(import.meta.url)) + \"lib/h5p/\";\n    this.h5pJSDeps = [\n      basePath + \"js/jquery.js\",\n      basePath + \"js/h5p.js\",\n      basePath + \"js/h5p-event-dispatcher.js\",\n      basePath + \"js/h5p-content-type.js\",\n      basePath + \"js/h5p-action-bar.js\",\n      basePath + \"js/h5p-confirmation-dialog.js\",\n      basePath + \"js/h5p-x-api-event.js\",\n      basePath + \"js/h5p-x-api.js\"\n    ];\n    this.__h5pDepsLength = this.h5pJSDeps.length - 1;\n    await window.ESGlobalBridge.instance.load(\n      \"h5p-jquery\",\n      basePath + \"js/jquery.js\"\n    );\n    window.addEventListener(\n      \"es-bridge-h5p-jquery-loaded\",\n      this.h5pJqueryReady.bind(this)\n    );\n    window.addEventListener(\n      \"es-bridge-h5p-\" + this.__h5pDepsLength + \"-loaded\",\n      this.h5pReadyCallback.bind(this)\n    );\n  }\n  generateUUID() {\n    return \"item-sss-ss-ss\".replace(/s/g, this._uuidPart);\n  }\n  _uuidPart() {\n    return Math.floor((1 + Math.random()) * 0x10000)\n      .toString(16)\n      .substring(1);\n  }\n  /**\n   * life cycle, element is afixed to the DOM\n   */\n  firstUpdated() {\n    if (\n      window.ESGlobalBridge.imports[\"h5p-\" + this.__h5pDepsLength] &&\n      this.contentId\n    ) {\n      this.setupH5P(this.contentId);\n    }\n  }\n  async h5pJqueryReady(e) {\n    for (var i in this.h5pJSDeps) {\n      await window.ESGlobalBridge.instance.load(\"h5p-\" + i, this.h5pJSDeps[i]);\n    }\n  }\n  h5pReadyCallback(e) {\n    if (this.contentId) {\n      this.setupH5P(this.contentId);\n    }\n  }\n  /**\n   * This does the heavy lifting to kick it off\n   */\n  async setupH5P(id = 1, displayOptions = {}) {\n    displayOptions = Object.assign(displayOptions, {\n      frame: (displayOptions.frame = false),\n      copyright: (displayOptions.copyright = false),\n      embed: (displayOptions.embed = false),\n      download: (displayOptions.download = false),\n      icon: (displayOptions.icon = false),\n      export: (displayOptions.export = false)\n    });\n    const basePath =\n      this.pathFromUrl(decodeURIComponent(import.meta.url)) + \"lib/h5p/\";\n\n    H5PIntegration.core = {\n      styles: [\n        basePath + \"styles/h5p.css\",\n        basePath + \"styles/h5p-confirmation-dialog.css\",\n        basePath + \"styles/h5p-core-button.css\"\n      ],\n      scripts: this.h5pJSDeps\n    };\n    let frag = document.createRange().createContextualFragment(`\n    <div class=\"h5p-iframe-wrapper\" style=\"background-color:#DDD;\">\n      <iframe id=\"h5p-iframe-${id}\" class=\"h5p-iframe\" data-content-id=\"${id}\" style=\"width: 100%; height: 100%; border: none; display: block;\" src=\"about:blank\" frameBorder=\"0\"></iframe>\n    </div>\n    `);\n    this.querySelector(\n      '[data-content-id=\"wrapper-' + this.contentId + '\"'\n    ).appendChild(frag);\n\n    if (this.source) {\n      let stand = new H5PStandalone(id, this.source, displayOptions);\n      await stand.init();\n      // clear previous calls to this exact thing\n      // this accounts for multiples on the DOM and the exccess\n      // file parsing required per each in order to use this thing\n      if (window.__H5PBridgeTimeOut) {\n        clearTimeout(window.__H5PBridgeTimeOut);\n        window.__H5PBridgeTimeOut();\n      }\n    }\n    return true;\n  }\n  /**\n   * life cycle, element removed from DOM\n   */\n  disconnectedCallback() {\n    window.removeEventListener(\n      \"es-bridge-h5p-\" + this.__h5pDepsLength + \"-loaded\",\n      this.h5pReadyCallback.bind(this)\n    );\n    window.removeEventListener(\n      \"es-bridge-h5p-jquery-loaded\",\n      this.h5pJqueryReady.bind(this)\n    );\n    super.disconnectedCallback();\n  }\n  updated(changedProperties) {\n    changedProperties.forEach((oldValue, propName) => {});\n  }\n}\ncustomElements.define(\"h5p-element\", H5PElement);\nwindow.H5P = window.H5P || {};\n\nwindow.H5PIntegration = window.H5PIntegration || {};\n\nH5PIntegration.l10n = {\n  H5P: {\n    advancedHelp:\n      \"Include this script on your website if you want dynamic sizing of the embedded content:\",\n    author: \"Author\",\n    by: \"by\",\n    close: \"Close\",\n    contentChanged: \"This content has changed since you last used it.\",\n    copyrightInformation: \"Rights of use\",\n    copyrights: \"Rights of use\",\n    copyrightsDescription: \"View copyright information for this content.\",\n    disableFullscreen: \"Disable fullscreen\",\n    download: \"Download\",\n    downloadDescription: \"Download this content as a H5P file.\",\n    embed: \"Embed\",\n    embedDescription: \"View the embed code for this content.\",\n    fullscreen: \"Fullscreen\",\n    h5pDescription: \"Visit H5P.org to check out more cool content.\",\n    hideAdvanced: \"Hide advanced\",\n    license: \"License\",\n    noCopyrights: \"No copyright information available for this content.\",\n    showAdvanced: \"Show advanced\",\n    showLess: \"Show less\",\n    showMore: \"Show more\",\n    size: \"Size\",\n    source: \"Source\",\n    startingOver: \"You'll be starting over.\",\n    subLevel: \"Sublevel\",\n    thumbnail: \"Thumbnail\",\n    title: \"Title\",\n    year: \"Year\"\n  }\n};\n\nclass H5PStandalone {\n  constructor(id = 1, pathToContent, displayOptions) {\n    this.id = id;\n    this.path = pathToContent;\n    this.displayOptions = displayOptions;\n    return true;\n  }\n  getJSONPromise(url) {\n    return fetch(url).then(function(response) {\n      return response.json();\n    });\n  }\n  /**\n   * Initialize the H5P\n   */\n  async init() {\n    this.h5p = await this.getJSONPromise(`${this.path}/h5p.json`);\n    this.content = JSON.stringify(\n      await this.getJSONPromise(`${this.path}/content/content.json`)\n    );\n    window.H5PIntegration.pathIncludesVersion = this.pathIncludesVersion = await this.checkIfPathIncludesVersion();\n\n    this.mainLibrary = await this.findMainLibrary();\n\n    const dependencies = await this.findAllDependencies();\n\n    const { styles, scripts } = await this.sortDependencies(dependencies);\n\n    H5PIntegration.url = this.path;\n    H5PIntegration.contents = H5PIntegration.contents\n      ? H5PIntegration.contents\n      : {};\n    H5PIntegration.contents[\"cid-\" + this.id] = {\n      library: `${this.mainLibrary.machineName} ${\n        this.mainLibrary.majorVersion\n      }.${this.mainLibrary.minorVersion}`,\n      jsonContent: this.content,\n      styles: styles,\n      scripts: scripts,\n      displayOptions: this.displayOptions\n    };\n    return true;\n  }\n\n  /**\n   * Check if the library folder include the version or not\n   * This was changed at some point in H5P and we need to be backwards compatible\n   *\n   * @return {boolean}\n   */\n  async checkIfPathIncludesVersion() {\n    let dependency = this.h5p.preloadedDependencies[0];\n    let machinePath =\n      dependency.machineName +\n      \"-\" +\n      dependency.majorVersion +\n      \".\" +\n      dependency.minorVersion;\n\n    let pathIncludesVersion;\n\n    try {\n      await this.getJSONPromise(`${this.path}/${machinePath}/library.json`);\n      pathIncludesVersion = true;\n    } catch (e) {\n      pathIncludesVersion = false;\n    }\n    return pathIncludesVersion;\n  }\n\n  /**\n   * return the path to a library\n   * @param {object} library\n   * @return {string}\n   */\n  libraryPath(library) {\n    return (\n      library.machineName +\n      (this.pathIncludesVersion\n        ? \"-\" + library.majorVersion + \".\" + library.minorVersion\n        : \"\")\n    );\n  }\n\n  /**\n   * FInd the main library for this H5P\n   * @return {Promise}\n   */\n  findMainLibrary() {\n    const mainLibraryInfo = this.h5p.preloadedDependencies.find(\n      dep => dep.machineName === this.h5p.mainLibrary\n    );\n\n    this.mainLibraryPath =\n      this.h5p.mainLibrary +\n      (this.pathIncludesVersion\n        ? \"-\" +\n          mainLibraryInfo.majorVersion +\n          \".\" +\n          mainLibraryInfo.minorVersion\n        : \"\");\n    return this.getJSONPromise(\n      `${this.path}/${this.mainLibraryPath}/library.json`\n    );\n  }\n\n  /**\n   * find all the libraries used in this H5P\n   * @return {Promise}\n   */\n  findAllDependencies() {\n    const directDependencyNames = this.h5p.preloadedDependencies.map(\n      dependency => this.libraryPath(dependency)\n    );\n\n    return this.loadDependencies(directDependencyNames, []);\n  }\n\n  /**\n   * searches through all supplied libraries for dependencies, this is recursive and repeats until all deep dependencies have been found\n   * @param {string[]} toFind list of libraries to find the dependencies of\n   * @param {string[]} alreadyFound the dependencies that have already been found\n   */\n  async loadDependencies(toFind, alreadyFound) {\n    // dependencyDepth++;\n    let dependencies = alreadyFound;\n    let findNext = [];\n    let newDependencies = await Promise.all(\n      toFind.map(libraryName => this.findLibraryDependencies(libraryName))\n    );\n    // loop over newly found libraries\n    newDependencies.forEach(library => {\n      // push into found list\n      dependencies.push(library);\n      // check if any dependencies haven't been found yet\n      library.dependencies.forEach(dependency => {\n        if (\n          !dependencies.find(\n            foundLibrary => foundLibrary.libraryPath === dependency\n          ) &&\n          !newDependencies.find(\n            foundLibrary => foundLibrary.libraryPath === dependency\n          )\n        ) {\n          findNext.push(dependency);\n        }\n      });\n    });\n\n    if (findNext.length > 0) {\n      return this.loadDependencies(findNext, dependencies);\n    }\n    return dependencies;\n  }\n\n  /**\n   * Loads a dependencies library.json and finds the libraries it dependson as well ass the JS and CSS it needs\n   * @param {string} libraryName\n   */\n  async findLibraryDependencies(libraryName) {\n    const library = await this.getJSONPromise(\n      `${this.path}/${libraryName}/library.json`\n    );\n    const libraryPath = this.libraryPath(library);\n\n    let dependencies = [];\n    if (library.preloadedDependencies) {\n      dependencies = library.preloadedDependencies.map(dependency =>\n        this.libraryPath(dependency)\n      );\n    }\n\n    return {\n      libraryPath,\n      dependencies,\n      preloadedCss: library.preloadedCss,\n      preloadedJs: library.preloadedJs\n    };\n  }\n\n  /**\n   * Resolves the library dependency tree and sorts the JS and CSS files into order\n   * @param {object[]} dependencies\n   * @return {object}\n   */\n  async sortDependencies(dependencies) {\n    const dependencySorter = new Toposort();\n    let CSSDependencies = {};\n    let JSDependencies = {};\n\n    dependencies.forEach(dependency => {\n      dependencySorter.add(dependency.libraryPath, dependency.dependencies);\n\n      if (dependency.preloadedCss) {\n        CSSDependencies[dependency.libraryPath] = CSSDependencies[\n          dependency.libraryPath\n        ]\n          ? CSSDependencies[dependency.libraryPath]\n          : [];\n        dependency.preloadedCss.forEach(style => {\n          CSSDependencies[dependency.libraryPath].push(\n            `${this.path}/${dependency.libraryPath}/${style.path}`\n          );\n        });\n      }\n\n      if (dependency.preloadedJs) {\n        JSDependencies[dependency.libraryPath] = JSDependencies[\n          dependency.libraryPath\n        ]\n          ? JSDependencies[dependency.libraryPath]\n          : [];\n        dependency.preloadedJs.forEach(script => {\n          JSDependencies[dependency.libraryPath].push(\n            `${this.path}/${dependency.libraryPath}/${script.path}`\n          );\n        });\n      }\n    });\n\n    let styles = [];\n    let scripts = [];\n\n    dependencySorter\n      .sort()\n      .reverse()\n      .forEach(function(dependencyName) {\n        Array.prototype.push.apply(styles, CSSDependencies[dependencyName]);\n        Array.prototype.push.apply(scripts, JSDependencies[dependencyName]);\n      });\n\n    Array.prototype.push.apply(\n      styles,\n      this.mainLibrary.preloadedCss.map(\n        style => `${this.path}/${this.mainLibraryPath}/${style.path}`\n      )\n    );\n    Array.prototype.push.apply(\n      scripts,\n      this.mainLibrary.preloadedJs.map(\n        script => `${this.path}/${this.mainLibraryPath}/${script.path}`\n      )\n    );\n\n    return { styles, scripts };\n  }\n}\n\nclass Toposort {\n  constructor() {\n    this.edges = [];\n  }\n  /**\n   * Adds dependency edges.\n   *\n   * @since   0.1.0\n   * @param   {String} item               An dependent name. Must be an string and not empty\n   * @param   {String[]|String} [deps]    An dependency or array of dependencies\n   * @returns {Toposort}                  The Toposort instance\n   */\n  add(item, deps) {\n    if (typeof item !== \"string\" || !item) {\n      throw new TypeError(\"Dependent name must be given as a not empty string\");\n    }\n\n    deps = Array.isArray(deps) ? deps : [deps];\n\n    if (deps.length > 0) {\n      for (let dep of deps) {\n        if (typeof dep !== \"string\" || !dep) {\n          throw new TypeError(\n            \"Dependency name must be given as a not empty string\"\n          );\n        }\n\n        this.edges.push([item, dep]);\n      }\n    } else {\n      this.edges.push([item]);\n    }\n\n    return this;\n  }\n\n  /**\n   * Runs the toposorting and return an ordered array of strings\n   *\n   * @since   0.1.0\n   * @returns {String[]}  The list of items topologically sorted.\n   */\n  sort() {\n    let nodes = [];\n\n    //accumulate unique nodes into a large list\n    for (let edge of this.edges) {\n      for (let node of edge) {\n        if (nodes.indexOf(node) === -1) {\n          nodes.push(node);\n        }\n      }\n    }\n\n    //initialize the placement of nodes into the sorted array at the end\n    let place = nodes.length;\n\n    //initialize the sorted array with the same length as the unique nodes array\n    let sorted = new Array(nodes.length);\n\n    //define a visitor function that recursively traverses dependencies.\n    var visit = (node, predecessors) => {\n      //check if a node is dependent of itself\n      if (predecessors.length !== 0 && predecessors.indexOf(node) !== -1) {\n        throw new Error(\n          `Cyclic dependency found. ${node} is dependent of itself.\\nDependency chain: ${predecessors.join(\n            \" -> \"\n          )} => ${node}`\n        );\n      }\n\n      let index = nodes.indexOf(node);\n\n      //if the node still exists, traverse its dependencies\n      if (index !== -1) {\n        let copy = false;\n\n        //mark the node as false to exclude it from future iterations\n        nodes[index] = false;\n\n        //loop through all edges and follow dependencies of the current node\n        for (let edge of this.edges) {\n          if (edge[0] === node) {\n            //lazily create a copy of predecessors with the current node concatenated onto it\n            copy = copy || predecessors.concat([node]);\n\n            //recurse to node dependencies\n            visit(edge[1], copy);\n          }\n        }\n\n        //add the node to the next place in the sorted array\n        sorted[--place] = node;\n      }\n    };\n\n    for (let i = 0; i < nodes.length; i++) {\n      let node = nodes[i];\n\n      //ignore nodes that have been excluded\n      if (node !== false) {\n        //mark the node as false to exclude it from future iterations\n        nodes[i] = false;\n\n        //loop through all edges and follow dependencies of the current node\n        for (let edge of this.edges) {\n          if (edge[0] === node) {\n            //recurse to node dependencies\n            visit(edge[1], [node]);\n          }\n        }\n\n        //add the node to the next place in the sorted array\n        sorted[--place] = node;\n      }\n    }\n\n    return sorted;\n  }\n\n  /**\n   * Clears edges\n   *\n   * @since   0.4.0\n   * @returns {Toposort}                  The Toposort instance\n   */\n  clear() {\n    this.edges = [];\n\n    return this;\n  }\n}\n\nexport { H5PElement, H5PStandalone, Toposort };\n"],"names":["window","__H5PBridgeTimeOut","setTimeout","H5P","init","H5PElement","contentId","_this","generateUUID","H5PDepsLoader","LitElement","html","this","css","props","String","Object","assign","url","substring","lastIndexOf","ESGlobalBridge","requestAvailability","basePath","pathFromUrl","decodeURIComponent","h5pJSDeps","__h5pDepsLength","length","instance","load","addEventListener","h5pJqueryReady","bind","h5pReadyCallback","replace","_uuidPart","Math","floor","random","toString","imports","setupH5P","e","i","id","displayOptions","frame","copyright","embed","download","icon","H5PIntegration","core","styles","scripts","frag","document","createRange","createContextualFragment","querySelector","appendChild","source","stand","H5PStandalone","clearTimeout","removeEventListener","changedProperties","forEach","oldValue","propName","customElements","define","l10n","advancedHelp","author","by","close","contentChanged","copyrightInformation","copyrights","copyrightsDescription","disableFullscreen","downloadDescription","embedDescription","fullscreen","h5pDescription","hideAdvanced","license","noCopyrights","showAdvanced","showLess","showMore","size","startingOver","subLevel","thumbnail","title","year","pathToContent","path","fetch","then","response","json","getJSONPromise","h5p","JSON","content","stringify","checkIfPathIncludesVersion","pathIncludesVersion","findMainLibrary","mainLibrary","findAllDependencies","dependencies","sortDependencies","contents","library","machineName","majorVersion","minorVersion","jsonContent","dependency","preloadedDependencies","machinePath","mainLibraryInfo","find","dep","_this2","mainLibraryPath","directDependencyNames","map","_this3","libraryPath","loadDependencies","toFind","alreadyFound","findNext","Promise","all","libraryName","_this4","findLibraryDependencies","newDependencies","push","foundLibrary","_this5","preloadedCss","preloadedJs","dependencySorter","Toposort","CSSDependencies","JSDependencies","add","style","_this6","script","sort","reverse","dependencyName","Array","prototype","apply","edges","item","deps","TypeError","isArray","nodes","edge","node","indexOf","place","sorted","visit","predecessors","Error","join","index","copy","_this7","concat"],"mappings":"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"}