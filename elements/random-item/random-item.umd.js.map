{"version":3,"file":"random-item.umd.js","sources":["random-item.umd.js"],"sourcesContent":["/**\n * Copyright 2019 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport { HAXWiring } from \"@lrnwebcomponents/hax-body-behaviors/lib/HAXWiring.js\";\n/**\n * `random-item`\n * `show a random item from a list of items`\n *\n * @microcopy - language worth noting:\n *  -\n *\n * @customElement\n * @demo demo/index.html\n */\nclass RandomItem extends HTMLElement {\n  \n  // render function\n  get html() {\n    return `\n<style>:host {\n  display: block;\n}\n\n:host([hidden]) {\n  display: none;\n}\n</style>\n${this.dataPoint}`;\n  }\n\n  // haxProperty definition\n  static get haxProperties() {\n    return {\n  \"canScale\": true,\n  \"canPosition\": true,\n  \"canEditSource\": false,\n  \"gizmo\": {\n    \"title\": \"Random item\",\n    \"description\": \"Show a random item from a list of items\",\n    \"icon\": \"communication:rss-feed\",\n    \"color\": \"red\",\n    \"groups\": [\"Item\"],\n    \"handles\": [],\n    \"meta\": {\n      \"author\": \"btopro\",\n      \"owner\": \"The Pennsylvania State University\"\n    }\n  },\n  \"settings\": {\n    \"quick\": [],\n    \"configure\": [\n      {\n        \"property\": \"field\",\n        \"title\": \"Field\",\n        \"description\": \"Field in the file to show\",\n        \"inputMethod\": \"textfield\",\n        \"required\": false\n      },\n      {\n        \"property\": \"source\",\n        \"title\": \"Source\",\n        \"description\": \"URL pointing to a CSV file\",\n        \"inputMethod\": \"haxupload\",\n        \"required\": true\n      }\n    ],\n    \"advanced\": []\n  }\n}\n;\n  }\n  // properties available to the custom element for data binding\n  static get properties() {\n    let props = {\n  \"source\": {\n    \"name\": \"source\",\n    \"type\": \"String\"\n  },\n  \"field\": {\n    \"name\": \"field\",\n    \"type\": \"String\"\n  }\n}\n;\n    if (super.properties) {\n      props = Object.assign(props, super.properties);\n    }\n    return props;\n  }\n\n  /**\n   * Store the tag name to make it easier to obtain directly.\n   * @notice function name must be here for tooling to operate correctly\n   */\n  static get tag() {\n    return \"random-item\";\n  }\n  /**\n   * life cycle\n   */\n  constructor(delayRender = false) {\n    super();\n\n    // set tag for later use\n    this.tag = RandomItem.tag;\n    this.template = document.createElement(\"template\");\n\n    this.attachShadow({ mode: \"open\" });\n\n    if (!delayRender) {\n      this.render();\n    }\n  }\n  /**\n   * life cycle, element is afixed to the DOM\n   */\n  connectedCallback() {\n    if (window.ShadyCSS) {\n      window.ShadyCSS.styleElement(this);\n    }\n\n    this.HAXWiring = new HAXWiring();\n    this.HAXWiring.setup(RandomItem.haxProperties, RandomItem.tag, this);\n  }\n\n  render() {\n    this.shadowRoot.innerHTML = null;\n    this.template.innerHTML = this.html;\n\n    if (window.ShadyCSS) {\n      window.ShadyCSS.prepareTemplate(this.template, this.tag);\n    }\n    this.shadowRoot.appendChild(this.template.content.cloneNode(true));\n  }\n\n  static get observedAttributes() {\n    return [\"source\", \"field\"];\n  }\n  // disconnectedCallback() {}\n  attributeChangedCallback(attr, oldValue, newValue) {\n    if (attr === \"source\" && newValue) {\n      this.source = newValue;\n      this.sourceChanged(newValue);\n    } else if (attr === \"field\" && newValue) {\n      this.field = newValue;\n      if (this.source) {\n        this.setDataWithRandom();\n      }\n    }\n  }\n  /**\n   * source changed\n   */\n  async sourceChanged(value) {\n    let data = await fetch(value).then(function(response) {\n      return response.text();\n    });\n    this.items = this.CSVtoArray(data);\n    var heading = this.items.shift();\n    this.qKey = heading;\n    this.entryPoint = 0;\n    this.setDataWithRandom();\n  }\n  /**\n   * Set data with a random value\n   */\n  setDataWithRandom() {\n    for (let key in this.qKey) {\n      if (this.qKey[key] === this.field) {\n        this.entryPoint = Number(key);\n      }\n    }\n    var qKey = Math.floor(Math.random() * this.items.length);\n    this.dataPoint = this.items[qKey][this.entryPoint];\n    this.render();\n  }\n  /**\n   * Mix of solutions from https://stackoverflow.com/questions/8493195/how-can-i-parse-a-csv-string-with-javascript-which-contains-comma-in-data\n   */\n  CSVtoArray(text) {\n    let p = \"\",\n      row = [\"\"],\n      ret = [row],\n      i = 0,\n      r = 0,\n      s = !0,\n      l;\n    for (l in text) {\n      l = text[l];\n      if ('\"' === l) {\n        if (s && l === p) row[i] += l;\n        s = !s;\n      } else if (\",\" === l && s) l = row[++i] = \"\";\n      else if (\"\\n\" === l && s) {\n        if (\"\\r\" === p) row[i] = row[i].slice(0, -1);\n        row = ret[++r] = [(l = \"\")];\n        i = 0;\n      } else row[i] += l;\n      p = l;\n    }\n    return ret;\n  }\n}\nwindow.customElements.define(RandomItem.tag, RandomItem);\nexport { RandomItem };\n"],"names":["RandomItem","delayRender","tag","template","document","createElement","attachShadow","mode","render","HTMLElement","this","dataPoint","props","Object","assign","window","ShadyCSS","styleElement","HAXWiring","setup","haxProperties","shadowRoot","innerHTML","html","prepareTemplate","appendChild","content","cloneNode","attr","oldValue","newValue","source","sourceChanged","field","setDataWithRandom","value","fetch","then","response","text","data","items","CSVtoArray","heading","shift","qKey","entryPoint","key","Number","Math","floor","random","length","l","p","row","ret","i","r","s","slice","customElements","define"],"mappings":"qxEAeMA,iCAsFQC,kMAILC,IAAMF,EAAWE,MACjBC,SAAWC,SAASC,cAAc,cAElCC,aAAa,CAAEC,KAAM,SAErBN,KACEO,yPAhGcC,0JAavBC,KAAKC,yDAKI,WACG,eACG,iBACE,QACR,OACE,0BACM,+CACP,+BACC,aACC,CAAC,gBACA,QACH,QACI,eACD,+CAGD,OACD,aACI,CACX,UACc,cACH,oBACM,wCACA,sBACH,GAEd,UACc,eACH,qBACM,yCACA,sBACH,aAGJ,4CAORC,EAAQ,QACJ,MACA,cACA,gBAED,MACC,aACA,8CAKNA,EAAQC,OAAOC,OAAOF,8BAEjBA,oCAQA,iEAsBHG,OAAOC,UACTD,OAAOC,SAASC,aAAaP,WAG1BQ,UAAY,IAAIA,iBAChBA,UAAUC,MAAMnB,EAAWoB,cAAepB,EAAWE,IAAKQ,4CAI1DW,WAAWC,UAAY,UACvBnB,SAASmB,UAAYZ,KAAKa,KAE3BR,OAAOC,UACTD,OAAOC,SAASQ,gBAAgBd,KAAKP,SAAUO,KAAKR,UAEjDmB,WAAWI,YAAYf,KAAKP,SAASuB,QAAQC,WAAU,qDAOrCC,EAAMC,EAAUC,GAC1B,WAATF,GAAqBE,QAClBC,OAASD,OACTE,cAAcF,IACD,UAATF,GAAoBE,SACxBG,MAAQH,EACTpB,KAAKqB,aACFG,2GAOSC,0GACDC,MAAMD,GAAOE,KAAK,SAASC,UACnCA,EAASC,gBADdC,cAGCC,MAAQ/B,KAAKgC,WAAWF,GACzBG,EAAUjC,KAAK+B,MAAMG,aACpBC,KAAOF,OACPG,WAAa,OACbZ,mVAMA,IAAIa,KAAOrC,KAAKmC,KACfnC,KAAKmC,KAAKE,KAASrC,KAAKuB,aACrBa,WAAaE,OAAOD,QAGzBF,EAAOI,KAAKC,MAAMD,KAAKE,SAAWzC,KAAK+B,MAAMW,aAC5CzC,UAAYD,KAAK+B,MAAMI,GAAMnC,KAAKoC,iBAClCtC,4CAKI+B,OAOPc,EANEC,EAAI,GACNC,EAAM,CAAC,IACPC,EAAM,CAACD,GACPE,EAAI,EACJC,EAAI,EACJC,GAAI,MAEDN,KAAKd,EAEJ,OADJc,EAAId,EAAKc,KAEHM,GAAKN,IAAMC,IAAGC,EAAIE,IAAMJ,GAC5BM,GAAKA,GACI,MAAQN,GAAKM,EAAGN,EAAIE,IAAME,GAAK,GACjC,OAASJ,GAAKM,GACjB,OAASL,IAAGC,EAAIE,GAAKF,EAAIE,GAAGG,MAAM,GAAI,IAC1CL,EAAMC,IAAME,GAAK,CAAEL,EAAI,IACvBI,EAAI,GACCF,EAAIE,IAAMJ,EACjBC,EAAID,SAECG,qDAhEA,CAAC,SAAU,kBAmEtBzC,OAAO8C,eAAeC,OAAO9D,EAAWE,IAAKF"}