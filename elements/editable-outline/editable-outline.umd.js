!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@polymer/polymer/polymer-element.js"),require("@polymer/iron-a11y-keys/iron-a11y-keys.js"),require("@polymer/iron-icon/iron-icon.js"),require("@polymer/iron-icons/iron-icons.js"),require("@polymer/iron-icons/editor-icons.js"),require("@lrnwebcomponents/json-outline-schema/json-outline-schema.js")):"function"==typeof define&&define.amd?define(["exports","@polymer/polymer/polymer-element.js","@polymer/iron-a11y-keys/iron-a11y-keys.js","@polymer/iron-icon/iron-icon.js","@polymer/iron-icons/iron-icons.js","@polymer/iron-icons/editor-icons.js","@lrnwebcomponents/json-outline-schema/json-outline-schema.js"],n):n((e=e||self).EditableOutline={},e.polymerElement_js)}(this,function(e,n){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,n,t){return n&&i(e.prototype,n),t&&i(e,t),e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,n){return(r=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,n,t){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,n,t){var i=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=l(e)););return e}(e,n);if(i){var o=Object.getOwnPropertyDescriptor(i,n);return o.get?o.get.call(t):o.value}})(e,n,t||e)}var d=[Node.ELEMENT_NODE,Node.TEXT_NODE,Node.DOCUMENT_FRAGMENT_NODE];function c(e,n,t){var i,o=n.childNodes||n.children;if(!o)return n;for(var l=0;l<o.length;++l){var r=o[t?l:o.length-1-l];if((i=r,d.includes(i.nodeType))&&e.containsNode(r,!0))return e.containsNode(r,!1)?r:c(e,r,t)}return n}var u=function(){if(document.createElement("div").attachShadow({mode:"open"}).getSelection)return document.addEventListener("selectionchange",function(e){document.dispatchEvent(new CustomEvent("-shadow-selectionchange"))}),function(){};var e=!1,n=[];return document.addEventListener("selectionchange",function(t){e||(document.dispatchEvent(new CustomEvent("-shadow-selectionchange")),e=!0,window.setTimeout(function(){e=!1},0),n.forEach(function(e){return e(t)}))}),function(e){return n.push(e)}}(),p=!1,b=null;function g(e,n,t){for(var i=n;(n=f(n,t))&&n.contains(i););return!!n&&(n instanceof Element&&e.containsNode(n,!0))}function f(e,n){if(!n)return e.previousSibling||e.parentNode||null;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null}function m(e){return e.nodeType!==Node.TEXT_NODE?0:/^\s*/.exec(e.textContent)[0].length}u(function(e){"Caret"===window.getSelection().type?p=!0:p&&!b&&(b=Promise.resolve(!0).then(function(){p=!1,b=null}))});var v=new Map;function h(e){if(e.getSelection){var n=e.getSelection();return n.rangeCount?n.getRangeAt(0):null}var t=v.get(e);if(t)return t;var i=window.getSelection().toString(),o=function(e){var n=document.createRange(),t=window.getSelection();if(!t.containsNode(e.host,!0))return{range:null,mode:"none"};e.insertBefore(y,e.childNodes[0]);var i=t.containsNode(y);if(y.remove(),i)return{range:null,mode:"outside-before"};e.appendChild(y);var o=t.containsNode(y);if(y.remove(),o)return{range:null,mode:"outside-after"};var l=function(){return t.toString().length};t.toString();if("Caret"!==t.type&&"Range"!==t.type)throw new TypeError("unexpected type: "+t.type);t.type;var r,a=c(t,e,!0),s=void 0;"Range"===t.type&&(r=c(t,e,!1),s=function(e,n,t){if("Range"===e.type){var i,o=function(){return e.toString().length},l=o();return 1===l&&p&&n===t?(e.extend(n,0),void e.collapseToEnd()):(e.modify("extend","forward","character"),(i=o())>l||g(e,t,!0)?(e.modify("extend","backward","character"),!0):i<l||!e.containsNode(n)?(e.modify("extend","backward","character"),!1):(e.modify("extend","backward","character"),(i=o())>l||g(e,n,!1)?(e.modify("extend","forward","character"),!1):i<l||!e.containsNode(t)?(e.modify("extend","forward","character"),!0):void 0))}}(t,a,r));if("Caret"===t.type){t.extend(a,0);var d=l();return t.collapseToEnd(),n.setStart(a,d),n.setEnd(a,d),{range:n,mode:"caret"}}if(void 0===s){if("Range"!==t.type)throw new TypeError("unexpected type: "+t.type);return n.setStart(a,0),n.setEnd(r,r.length),{range:n,mode:"all"}}var u,b,f=l(),v=r.length-function(e){if(e.nodeType!==Node.TEXT_NODE)return 0;var n=/\s*$/.exec(e.textContent)[0].length;return n?n-1:0}(r);s?(t.extend(a,0),u=l()+m(a),t.extend(r,v),b=v-(l()-f),t.extend(r,b)):(t.extend(r,v),b=v-l(),t.extend(a,0),u=l()-f+m(a),t.extend(a,u));return n.setStart(a,u),n.setEnd(r,b),{mode:s?"right":"left",range:n}}(e),l=o.range&&o.range.toString()||null;return null!==l&&l!==i&&l.replace(/\s/g,"")!==i.replace(/\s/g,"")&&(console.warn("invalid range, initial text:",i),console.warn("vs",l,o.mode,o.range)),v.set(e,o.range),window.setTimeout(function(){v.delete(e)},0),o.range}var y=document.createTextNode("");function S(){var e,n,t=(e=['\n<style>:host {\n  display: block;\n  font-family: \'Noto Serif\', serif;\n}\n\n:host([hidden]) {\n  display: none;\n}\n\n.button-wrapper {\n  height: 50px;\n  line-height: 50px;\n  margin-top: 10px;\n  position: -webkit-sticky;\n  position: sticky;\n  top: 0px;\n  background-color: white;\n  display: block;\n  justify-content: space-evenly;\n  @apply --editable-outline-button-wrapper;\n}\n@media (max-width: 1000px) {\n  .button-wrapper {\n    @apply --editable-outline-button-wrapper-mobile;\n  }\n  button span {\n    opacity: 0;\n    visibility: hidden;\n    position: absolute;\n    left: -9999px;\n  }\n}\nbutton {\n  height: 32px;\n  font-size: 10px;\n  margin: 0;\n  padding: 0 8px;\n}\n\nbutton span {\n  padding-left: 4px;\n  pointer-events: none;\n}\n\n#outline {\n  margin: 0;\n}\nul {\n  font-size: 16px;\n  line-height: 32px;\n  padding-left: 32px;\n  visibility: visible;\n  opacity: 1;\n  overflow: hidden;\n  height: auto;\n  transition: .2s ease-in-out all;\n  @apply --editable-outline-button-list;\n}\nli {\n  font-size: 16px;\n  line-height: 32px;\n  padding: 4px;\n  transition: .2s linear all;\n  @apply --editable-outline-button-list-item;\n}\nul:hover {\n  outline: 1px solid #EEEEEE;\n}\nli.collapsed-title {\n  background-color: #dddddd;\n}\nli.collapsed-title:after {\n  content:"    ( Double-click to expand )";\n}\nli:after {\n  transition: .4s ease-in-out all;\n  opacity: 0;\n  font-size: 11px;\n  visibility: hidden;\n}\nli.collapsed-title:hover:after {\n  font-style: italic;\n  opacity: 1;\n  visibility: visible;\n}\nul.collapsed-content {\n  visibility: hidden;\n  opacity: 0;\n  height: 0;\n}\nli:focus,\nli:active,\nli:hover {\n  background-color: #EEEEEE;\n  outline: 1px solid #CCCCCC;\n  @apply --editable-outline-button-list-item-active;\n}\n\niron-icon {\n  pointer-events: none;\n}</style>\n<iron-a11y-keys target="[[__outlineNode]]" keys="shift+tab" on-keys-pressed="_tabBackKeyPressed"\n  stop-keyboard-event-propagation></iron-a11y-keys>\n<iron-a11y-keys target="[[__outlineNode]]" keys="tab" on-keys-pressed="_tabKeyPressed"\n  stop-keyboard-event-propagation></iron-a11y-keys>\n<iron-a11y-keys target="[[__outlineNode]]" keys="enter" on-keys-pressed="_enterPressed"\n  stop-keyboard-event-propagation></iron-a11y-keys>\n<iron-a11y-keys target="[[__outlineNode]]" keys="up" on-keys-pressed="_upPressed"\n  stop-keyboard-event-propagation></iron-a11y-keys>\n<iron-a11y-keys target="[[__outlineNode]]" keys="down" on-keys-pressed="_downPressed"\n  stop-keyboard-event-propagation></iron-a11y-keys>\n<div class="button-wrapper">\n<button on-click="buttonEvents" id="add" title="Add a new node">\n  <iron-icon icon="icons:add"></iron-icon><span>Add</span>\n</button>\n<button on-click="buttonEvents" id="collapse" title="Toggle active node collapsed status">\n  <iron-icon icon="icons:swap-vert"></iron-icon><span>Toggle active</span>\n</button>\n<button on-click="buttonEvents" id="collapseall" title="Collapse all nodes">\n  <iron-icon icon="icons:swap-vert"></iron-icon><span>Collapse all</span>\n</button>\n<button on-click="buttonEvents" id="expandall" title="Expand all nodes">\n  <iron-icon icon="icons:swap-vert"></iron-icon><span>Expand all</span>\n</button>\n<button on-click="buttonEvents" id="down" title="Move active node down">\n  <iron-icon icon="icons:arrow-downward"></iron-icon><span>Move down</span>\n</button>\n<button on-click="buttonEvents" id="up" title="Move active node up">\n  <iron-icon icon="icons:arrow-upward"></iron-icon><span>Move up</span>\n</button>\n<button on-click="buttonEvents" id="outdent" title="Outdent active node">\n  <iron-icon icon="editor:format-indent-decrease"></iron-icon><span>Outdent</span>\n</button>\n<button on-click="buttonEvents" id="indent" title="Indent active node">\n  <iron-icon icon="editor:format-indent-increase"></iron-icon><span>Indent</span>\n</button>\n<button on-click="buttonEvents" id="duplicate" title="Duplicate active node tree">\n  <iron-icon icon="icons:content-copy"></iron-icon><span>Duplicate</span>\n</button>\n<button on-click="buttonEvents" id="delete" title="Delete active node">\n  <iron-icon icon="icons:delete"></iron-icon><span>Delete</span>\n</button>\n</div>\n<ul id="outline"></ul>'],n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}})));return S=function(){return t},t}var N=function(e){function i(){var e,n,t;return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,i),n=this,(e=!(t=l(i).call(this))||"object"!=typeof t&&"function"!=typeof t?a(n):t).jos=window.JSONOutlineSchema.requestAvailability(),e.addEventListener("dblclick",e._collapseClickHandler.bind(a(e))),e}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&r(e,n)}(i,n.PolymerElement),o(i,null,[{key:"template",get:function(){return n.html(S())}},{key:"properties",get:function(){var e={items:{name:"items",type:Array,value:[],notify:!0},editMode:{name:"editMode",type:Boolean,notify:!0,observer:"_editModeChanged"},__outlineNode:{name:"__outlineNode",type:Object}};return s(l(i),"properties",this)&&(e=Object.assign(e,s(l(i),"properties",this))),e}}]),o(i,[{key:"_collapse",value:function(e){var n=this.getSelectionNode();n&&"LI"===n.tagName&&n.nextElementSibling&&"UL"===n.nextElementSibling.tagName&&(n.classList.toggle("collapsed-title"),n.nextElementSibling.classList.toggle("collapsed-content"))}},{key:"_expandall",value:function(e){this.shadowRoot.querySelectorAll("li").forEach(function(e){e.classList.remove("collapsed-title")}),this.shadowRoot.querySelectorAll("ul").forEach(function(e){e.classList.remove("collapsed-content")})}},{key:"_collapseall",value:function(e){this.shadowRoot.querySelectorAll("li").forEach(function(e){e.nextElementSibling&&"UL"===e.nextElementSibling.tagName&&(e.classList.add("collapsed-title"),e.nextElementSibling.classList.add("collapsed-content"))})}},{key:"_collapseClickHandler",value:function(e){for(var n,t=0,i=!0;i&&e.path.length>t+1;)"LI"===(n=e.path[t]).tagName&&n.nextElementSibling&&"UL"===n.nextElementSibling.tagName&&(n.classList.toggle("collapsed-title"),n.nextElementSibling.classList.toggle("collapsed-content"),i=!1),t++}},{key:"_delete",value:function(e){var n=this.getSelectionNode();if(n){var t=n.parentNode;n.remove(),0===t.children.length&&t.remove()}}},{key:"connectedCallback",value:function(){s(l(i.prototype),"connectedCallback",this).call(this),this.__outlineNode=this.shadowRoot.querySelector("#outline"),this._observer=new MutationObserver(this._observer.bind(this)),this._observer.observe(this.__outlineNode,{childList:!0,subtree:!0})}},{key:"_observer",value:function(e){var n=this;for(var t in e){var i=e[t];if(i.addedNodes.length>0)for(var o in i.addedNodes)i.addedNodes[o].tagName&&("LI"===i.addedNodes[o].tagName?this.__blockScrub?i.addedNodes[o].setAttribute("contenteditable","true"):(this.jos.scrubElementJOSData(i.addedNodes[o]),i.addedNodes[o].setAttribute("contenteditable","true")):"UL"===i.addedNodes[o].tagName&&(this.__blockScrub||this.jos.scrubElementJOSData(i.addedNodes[o])))}setTimeout(function(){n.__blockScrub=!1},100)}},{key:"disconnectedCallback",value:function(){s(l(i.prototype),"disconnectedCallback",this).call(this)}},{key:"_editModeChanged",value:function(e,n){t(e)}},{key:"buttonEvents",value:function(e){switch(e.target.id){case"add":this._add(e);break;case"collapse":this._collapse(e);break;case"collapseall":this._collapseall(e);break;case"expandall":this._expandall(e);break;case"indent":this._indent();break;case"outdent":this._outdent();break;case"up":this._move("up");break;case"down":this._move("down");break;case"duplicate":this._duplicate();break;case"delete":this._delete()}}},{key:"_duplicate",value:function(){try{this.__blockScrub=!1;var e=this.getSelectionNode();if(e&&"LI"===e.tagName)if(null!==e.nextElementSibling&&"UL"===e.nextElementSibling.tagName){var n=e.nextElementSibling.cloneNode(!0);e.parentNode.insertBefore(n,e.nextElementSibling.nextElementSibling);var t=e.cloneNode(!0);e.parentNode.insertBefore(t,e.nextElementSibling.nextElementSibling)}else{var i=e.cloneNode(!0);e.parentNode.insertBefore(i,e.nextElementSibling)}}catch(e){console.log(e)}}},{key:"_move",value:function(e){try{var n=this.getSelectionNode(),t=n,i=!1;if(null==n)return!1;for(;!i&&t.parentNode;)"outline"===t.id&&(i=!0),t=t.parentNode;i&&n&&"LI"===n.tagName&&("up"===e?null!==n.previousElementSibling&&(n.nextElementSibling&&"UL"===n.nextElementSibling.tagName?("UL"===n.previousElementSibling.tagName&&(this.__blockScrub=!0,n.parentNode.insertBefore(n.previousElementSibling,n.nextElementSibling.nextElementSibling)),this.__blockScrub=!0,n.parentNode.insertBefore(n.previousElementSibling,n.nextElementSibling.nextElementSibling),n.focus()):("UL"===n.previousElementSibling.tagName&&(this.__blockScrub=!0,n.parentNode.insertBefore(n.previousElementSibling,n.nextElementSibling)),this.__blockScrub=!0,n.parentNode.insertBefore(n.previousElementSibling,n.nextElementSibling),n.focus())):"down"===e&&null!==n.nextElementSibling&&(n.nextElementSibling&&"UL"===n.nextElementSibling.tagName&&null!==n.nextElementSibling.nextElementSibling?("LI"===n.nextElementSibling.nextElementSibling.tagName&&null!==n.nextElementSibling.nextElementSibling.nextElementSibling&&"UL"===n.nextElementSibling.nextElementSibling.nextElementSibling.tagName&&(this.__blockScrub=!0,n.parentNode.insertBefore(n.nextElementSibling.nextElementSibling,n)),this.__blockScrub=!0,n.parentNode.insertBefore(n.nextElementSibling.nextElementSibling,n),n.focus()):"LI"===n.nextElementSibling.tagName&&(null!==n.nextElementSibling.nextElementSibling&&"UL"===n.nextElementSibling.nextElementSibling.tagName&&(this.__blockScrub=!0,n.parentNode.insertBefore(n.nextElementSibling,n)),this.__blockScrub=!0,n.parentNode.insertBefore(n.nextElementSibling,n),n.focus())))}catch(e){console.log(e)}}},{key:"importJsonOutlineSchemaItems",value:function(){for(this.__blockScrub=!0;null!==this.__outlineNode.firstChild;)this.__outlineNode.removeChild(this.__outlineNode.firstChild);0===this.items.length&&this.set("items",this.jos.items);for(var e=this.jos.itemsToNodes(this.items);null!==e.firstChild;)this.__blockScrub=!0,this.__outlineNode.appendChild(e.firstChild);return this.shadowRoot.querySelectorAll("li").forEach(function(e){e.setAttribute("contenteditable","true")}),e}},{key:"exportJsonOutlineSchemaItems",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.jos.nodesToItems(this.__outlineNode,e)}},{key:"_upPressed",value:function(e){var n=this.getSelectionNode();n&&n.previousSibling&&"LI"===n.previousSibling.tagName?n.previousSibling.focus():n&&n.previousSibling&&"UL"===n.previousSibling.tagName&&n.previousSibling.firstChild&&"LI"===n.previousSibling.firstChild.tagName?n.previousSibling.firstChild.focus():n&&null==n.previousSibling&&"UL"===n.parentNode.tagName&&n.parentNode.previousSibling&&"LI"===n.parentNode.previousSibling.tagName&&n.parentNode.previousSibling.focus()}},{key:"_downPressed",value:function(e){var n=this.getSelectionNode();n&&n.nextSibling&&"LI"===n.nextSibling.tagName?n.nextSibling.focus():n&&n.nextSibling&&"UL"===n.nextSibling.tagName&&n.nextSibling.firstChild&&"LI"===n.nextSibling.firstChild.tagName?n.nextSibling.firstChild.focus():n&&null==n.nextSibling&&"UL"===n.parentNode.tagName&&n.parentNode.nextSibling&&"LI"===n.parentNode.nextSibling.tagName&&n.parentNode.nextSibling.focus()}},{key:"_tabKeyPressed",value:function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.detail.keyboardEvent&&(e.detail.keyboardEvent.preventDefault(),e.detail.keyboardEvent.stopPropagation(),e.detail.keyboardEvent.stopImmediatePropagation());try{this._indent()}catch(e){}}},{key:"_tabBackKeyPressed",value:function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.detail.keyboardEvent&&(e.detail.keyboardEvent.preventDefault(),e.detail.keyboardEvent.stopPropagation(),e.detail.keyboardEvent.stopImmediatePropagation());try{this._outdent()}catch(e){}}},{key:"_enterPressed",value:function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.detail.keyboardEvent&&(e.detail.keyboardEvent.preventDefault(),e.detail.keyboardEvent.stopPropagation(),e.detail.keyboardEvent.stopImmediatePropagation()),this._add()}},{key:"_add",value:function(){var e=document.createElement("li");e.setAttribute("contenteditable","true");var n=this.getSelectionNode();if(null==this.__outlineNode.querySelector("li")||!n||n.tagName&&"UL"!=n.tagName&&"LI"!=n.tagName)this.__outlineNode.appendChild(e);else{null!=n.tagName&&"LI"==n.tagName||!n.parentNode||(n=n.parentNode),null==n.nextSibling?n.parentNode.appendChild(e):n.parentNode.insertBefore(e,n.nextSibling);try{e.focus()}catch(e){}}}},{key:"_outdent",value:function(){this.__blockScrub=!0;try{var e=this.getSelectionNode();if(null==e)return!1;var n=e.parentNode;e.parentNode&&e.parentNode!=this.__outlineNode&&null!=e.parentNode.nextSibling?(e.parentNode.parentNode.insertBefore(e,e.parentNode.nextSibling),0==n.children.length&&n.remove()):e.parentNode&&e.parentNode!=this.__outlineNode&&null==e.parentNode.nextSibling&&(e.parentNode.parentNode.appendChild(e),0==n.children.length&&n.remove()),e.focus()}catch(e){console.warn(e)}}},{key:"_indent",value:function(){this.__blockScrub=!0;try{var e,n=this.getSelectionNode();if(null==n)return!1;if(null!=n.previousSibling&&"LI"===n.previousSibling.tagName)n.nextSibling&&"UL"===n.nextSibling.tagName?e=n.nextSibling:(e=document.createElement("ul"),n.parentNode.insertBefore(e,n)),e.appendChild(n),n.focus();else null!=n.previousSibling&&"UL"===n.previousSibling.tagName&&(n.previousSibling.appendChild(n),n.focus())}catch(e){console.warn(e)}}},{key:"getSelectionNode",value:function(){var e=this.getDeepSelection().anchorNode;return e&&(null==e.tagName||"LI"!=e.tagName)&&e.parentNode&&(e=e.parentNode),e}},{key:"getDeepSelection",value:function(){return this.shadowRoot.getSelection?this.shadowRoot.getSelection():h(this.__outlineNode.parentNode)?h(this.__outlineNode.parentNode):window.getSelection()}},{key:"getDeepRange",value:function(){var e=this.getDeepSelection();return e.getRangeAt&&e.rangeCount?e.getRangeAt(0):e||void 0}}],[{key:"tag",get:function(){return"editable-outline"}}]),i}();window.customElements.define(N.tag,N),e.EditableOutline=N,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=editable-outline.umd.js.map
