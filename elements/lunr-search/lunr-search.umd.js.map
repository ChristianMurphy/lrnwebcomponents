{"version":3,"file":"lunr-search.umd.js","sources":["lunr-search.umd.js"],"sourcesContent":["/**\n * Inspired by https://github.com/olivernn/lunr.js\n * Copyright 2019 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport { LitElement, html, css } from \"lit-element/lit-element.js\";\nimport \"@lrnwebcomponents/es-global-bridge/es-global-bridge.js\";\nimport \"@polymer/iron-ajax/iron-ajax.js\";\n/**\n * `lunr-search`\n * `LunrJS search element`\n * @demo demo/index.html\n * @customElement lunr-search\n */\nclass LunrSearch extends LitElement {\n  \n  //styles function\n  static get styles() {\n    return  [\n      \n      css`\n:host {\n  display: block;\n}\n\n:host([hidden]) {\n  display: none;\n}\n      `\n    ];\n  }\n  // render function\n  render() {\n    return html`\n\n<iron-ajax\n  auto\n  url=\"${this.dataSource}\"\n  method=\"${this.method}\"\n  handle-as=\"json\"\n  @response=\"${this._dataResponse}\"\n></iron-ajax>`;\n  }\n\n  // properties available to the custom element for data binding\n    static get properties() {\n    return {\n  \n  ...super.properties,\n  \n  \"dataSource\": {\n    \"type\": String,\n    \"attribute\": \"data-source\"\n  },\n  \"data\": {\n    \"type\": Array\n  },\n  \"method\": {\n    \"type\": String\n  },\n  \"search\": {\n    \"type\": String\n  },\n  \"results\": {\n    \"type\": Array\n  },\n  \"noStopWords\": {\n    \"type\": Boolean,\n    \"attribute\": \"no-stop-words\"\n  },\n  \"fields\": {\n    \"type\": Array\n  },\n  \"indexNoStopWords\": {\n    \"type\": Object\n  },\n  \"index\": {\n    \"type\": Object\n  },\n  \"__lunrLoaded\": {\n    \"type\": Boolean\n  },\n  \"limit\": {\n    \"type\": Number\n  },\n  \"minScore\": {\n    \"type\": Number\n  },\n  \"log\": {\n    \"type\": Boolean\n  }\n}\n;\n  }\n  constructor() {\n    super();\n    this.method = \"GET\";\n    this.noStopWords = false;\n    this.fields = [];\n    this.limit = 500;\n    this.minScore = 0;\n    this.log = false;\n    const basePath = this.pathFromUrl(import.meta.url);\n    const location = `${basePath}../../lunr/lunr.js`;\n    window.addEventListener(\n      \"es-bridge-lunr-loaded\",\n      this._lunrLoaded.bind(this)\n    );\n    window.ESGlobalBridge.requestAvailability();\n    window.ESGlobalBridge.instance.load(\"lunr\", location);\n    if (\n      window.ESGlobalBridge.imports &&\n      window.ESGlobalBridge.imports[\"lunr\"]\n    ) {\n      this.__lunrLoaded = true;\n    }\n  }\n  updated(changedProperties) {\n    changedProperties.forEach((oldValue, propName) => {\n      let notifiedProps = [\"data\", \"search\", \"results\", \"noStopWords\"];\n      if (notifiedProps.includes(propName)) {\n        // notify\n        let eventName = `${propName\n          .replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g, \"$1-$2\")\n          .toLowerCase()}-changed`;\n        this.dispatchEvent(\n          new CustomEvent(eventName, {\n            detail: {\n              value: this[propName]\n            }\n          })\n        );\n      }\n      if ([\"data\", \"search\", \"index\", \"minScore\", \"limit\"].includes(propName)) {\n        this.results = this.searched(\n          this.data,\n          this.search,\n          this.index,\n          this.minScore,\n          this.limit\n        );\n      }\n      if (\n        [\"data\", \"fields\", \"noStopWords\", \"__lunrLoaded\"].includes(propName)\n      ) {\n        this.index = this._createIndex(\n          this.data,\n          this.fields,\n          this.noStopWords,\n          this.__lunrLoaded\n        );\n      }\n    });\n  }\n  // simple path from a url modifier\n  pathFromUrl(url) {\n    return url.substring(0, url.lastIndexOf(\"/\") + 1);\n  }\n  disconnectedCallback() {\n    window.removeEventListener(\n      \"es-bridge-lunr-loaded\",\n      this._lunrLoaded.bind(this)\n    );\n    super.disconnectedCallback();\n  }\n  _lunrLoaded(e) {\n    // callback when loaded\n    this.__lunrLoaded = true;\n  }\n  /**\n   * Store the tag name to make it easier to obtain directly.\n   * @notice function name must be here for tooling to operate correctly\n   */\n  static get tag() {\n    return \"lunr-search\";\n  }\n  _dataResponse(e) {\n    this.data = [...e.detail.response];\n  }\n  /**\n    Filters your input data\n    \n    @param {Array} data Array of Objects with common properties.\n    @param {String} search The search term that filters results.\n    @param {Object} index The lunr Index..\n    @param {Number} minScore The minimum score of your results.\n    @param {Number} limit The maximum number of results you'd like your results.\n    \n    @return {Array} The filtered data.\n   */\n  searched(data, search, index, minScore, limit) {\n    if (data && index && search) {\n      var results = [];\n      if (\"\" + search !== \"\") {\n        var searched = index.search(search);\n        for (var i = 0; i < searched.length; i++) {\n          if (i === limit || searched[i].score < minScore) {\n            break;\n          }\n          // match on the id within the array of options\n          let tmpItem = data.find(j => j.id == searched[i].ref);\n          results.push(tmpItem);\n        }\n      }\n      if (results.length === 0 && !this.noStopWords && \"\" + search !== \"\") {\n        if (!this.indexNoStopWords) {\n          this.indexNoStopWords = this._createIndex(\n            data,\n            this.fields,\n            true,\n            index\n          );\n        }\n        searched = this.indexNoStopWords.search(search);\n        var results = [];\n        for (var i = 0; i < searched.length; i++) {\n          if (i === limit || searched[i].score < minScore) {\n            break;\n          }\n          let tmpItem = data.find(j => j.id == searched[i].ref);\n          results.push(tmpItem);\n        }\n      }\n      return results;\n    }\n  }\n  _createIndex(data, fields, noStopWords, ready) {\n    if (ready) {\n      let root = this;\n      if (Array.isArray(data) && data.length > 0) {\n        if (Array.isArray(fields) && fields.length > 0) {\n          return lunr(function() {\n            for (var i = 0; i < fields.length; i++) {\n              if (fields[i].charAt(0) === fields[i].charAt(0).toUpperCase()) {\n                this.field(fields[i], { boost: 10 });\n              } else {\n                this.field(fields[i]);\n              }\n            }\n            for (var i = 0; i < data.length; i++) {\n              var toIndex = { id: i };\n              for (var f = 0; f < fields.length; f++) {\n                if (\n                  data[i].hasOwnProperty(fields[f]) &&\n                  data[i][fields[f]] !== null &&\n                  typeof data[i][fields[f]].toString == \"function\" &&\n                  (data[i][fields[f]].toString().split(\" \").length > 2 ||\n                    data[i][fields[f]].toString().length < 30)\n                ) {\n                  //indicate that they might be words in it\n                  toIndex[fields[f]] = data[i][fields[f]].toString();\n                } else {\n                  toIndex[fields[f]] = \"\";\n                }\n              }\n              this.add(toIndex);\n            }\n            if (noStopWords) {\n              this.pipeline.remove(lunr.stopWordFilter);\n            }\n          });\n        } else {\n          // find fields\n          // TODO only word best fields.\n          var fields = [];\n          var ddup = {};\n          return lunr(function() {\n            for (\n              var indexOfData = 0;\n              indexOfData < data.length;\n              indexOfData++\n            ) {\n              for (var prop in data[indexOfData]) {\n                if (\n                  prop.charAt(0) !== \"_\" &&\n                  !ddup.hasOwnProperty(prop) &&\n                  (prop.toString().split(\" \").length > 2 ||\n                    prop.toString().length < 30)\n                ) {\n                  fields.push(prop);\n                  if (prop.charAt(0) === prop.charAt(0).toUpperCase()) {\n                    this.field(prop, { boost: 10 });\n                  } else {\n                    this.field(prop);\n                  }\n                  ddup[prop] = 1;\n                }\n              }\n            }\n            if (fields.length > 0) {\n              root.fields = fields;\n            }\n            for (var i = 0; i < data.length; i++) {\n              var toIndex = { id: i };\n              for (var f = 0; f < fields.length; f++) {\n                if (\n                  data[i].hasOwnProperty(fields[f]) &&\n                  data[i][fields[f]] !== null &&\n                  typeof data[i][fields[f]].toString == \"function\" &&\n                  (data[i][fields[f]].toString().split(\" \").length > 2 ||\n                    data[i][fields[f]].toString().length < 30)\n                ) {\n                  //indicate that they might be words in it\n                  toIndex[fields[f]] = data[i][fields[f]].toString();\n                } else {\n                  toIndex[fields[f]] = \"\";\n                }\n              }\n              this.add(toIndex);\n            }\n            if (noStopWords) {\n              this.pipeline.remove(lunr.stopWordFilter);\n            }\n          });\n        }\n      }\n    }\n  }\n}\nwindow.customElements.define(LunrSearch.tag, LunrSearch);\nexport { LunrSearch };\n"],"names":["LunrSearch","method","noStopWords","fields","limit","minScore","log","basePath","_this","pathFromUrl","location","window","addEventListener","_lunrLoaded","bind","ESGlobalBridge","requestAvailability","instance","load","imports","__lunrLoaded","LitElement","html","this","dataSource","_dataResponse","css","String","Array","Boolean","Object","Number","changedProperties","forEach","oldValue","propName","includes","eventName","replace","toLowerCase","_this2","dispatchEvent","CustomEvent","detail","value","results","searched","data","search","index","_createIndex","url","substring","lastIndexOf","removeEventListener","e","response","i","length","score","tmpItem","find","j","id","ref","push","indexNoStopWords","ready","root","isArray","lunr","charAt","toUpperCase","field","boost","toIndex","f","hasOwnProperty","toString","split","add","pipeline","remove","stopWordFilter","ddup","indexOfData","prop","customElements","define","tag"],"mappings":"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"}