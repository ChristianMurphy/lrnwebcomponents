!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@lrnwebcomponents/grid-plate/grid-plate.js"),require("@lrnwebcomponents/hax-body/lib/hax-context-item.js"),require("@lrnwebcomponents/hax-body/lib/hax-context-item-menu.js"),require("@polymer/paper-item/paper-item.js"),require("@lrnwebcomponents/utils/utils.js"),require("@lrnwebcomponents/hax-body/lib/hax-toolbar.js"),require("lit-element/lit-element.js"),require("@lrnwebcomponents/hax-body/lib/hax-context-item-textop.js"),require("@polymer/iron-icon/iron-icon.js"),require("@lrnwebcomponents/simple-colors/simple-colors.js"),require("@lrnwebcomponents/undo-manager/undo-manager.js")):"function"==typeof define&&define.amd?define(["exports","@lrnwebcomponents/grid-plate/grid-plate.js","@lrnwebcomponents/hax-body/lib/hax-context-item.js","@lrnwebcomponents/hax-body/lib/hax-context-item-menu.js","@polymer/paper-item/paper-item.js","@lrnwebcomponents/utils/utils.js","@lrnwebcomponents/hax-body/lib/hax-toolbar.js","lit-element/lit-element.js","@lrnwebcomponents/hax-body/lib/hax-context-item-textop.js","@polymer/iron-icon/iron-icon.js","@lrnwebcomponents/simple-colors/simple-colors.js","@lrnwebcomponents/undo-manager/undo-manager.js"],t):t((e=e||self).HaxBody={},null,null,null,null,e.utils_js,null,e.litElement_js,null,null,e.simpleColors_js,e.undoManager_js)}(this,function(e,t,n,o,i,a,r,s,c,d,l,u){"use strict";function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t,n,o,i,a,r){try{var s=e[a](r),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(o,i)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function x(e,t,n){return t&&v(e.prototype,t),n&&v(e,n),e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach(function(t){f(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,o,i,a=w(e);if(t){var r=w(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return o=this,!(i=n)||"object"!=typeof i&&"function"!=typeof i?S(o):i}}function k(e,t,n){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function C(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function H(e){return function(e){if(Array.isArray(e))return E(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var L=function(e){y(n,a.winEventsElement(HTMLElement));var t=_(n);function n(){var e,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return p(this,n),(e=t.call(this)).__winEvents={"hax-store-property-updated":"_haxStorePropertyUpdated"},e.tag=n.tag,e.template=document.createElement("template"),e.attachShadow({mode:"open"}),o||e.render(),setTimeout(function(){},0),e}return x(n,[{key:"_haxStorePropertyUpdated",value:function(e){var t=this;setTimeout(function(){e.detail&&"undefined"!==h(e.detail.value)&&e.detail.property&&null!=t.getAttribute("on-screen")&&["activeNode","activeContainerNode"].includes(e.detail.property)&&t.__updatePlatePosition()},10)}},{key:"__updatePlatePosition",value:function(){var e=this;setTimeout(function(){var t=window.HaxStore.instance.activeNode,n=e.shadowRoot.querySelector("#right"),o=e.shadowRoot.querySelector("#rightremove");window.HaxStore.instance.activeContainerNode&&(t=window.HaxStore.instance.activeContainerNode),n.disabled=!1,o.disabled=!1,t&&"GRID-PLATE"==t.tagName?"1-1-1-1-1-1"==t.layout&&(n.disabled=!0):o.disabled=!0},100)}},{key:"render",value:function(){this.shadowRoot.innerHTML=null,this.template.innerHTML=this.html,window.ShadyCSS&&window.ShadyCSS.prepareTemplate(this.template,this.tag),this.shadowRoot.appendChild(this.template.content.cloneNode(!0))}},{key:"connectedCallback",value:function(){var e=this;k(w(n.prototype),"connectedCallback",this).call(this),setTimeout(function(){e.shadowRoot.querySelector("#drag").addEventListener("dragstart",e._dragStart),e.shadowRoot.querySelector("#drag").addEventListener("dragend",e._dragEnd)},0)}},{key:"disconnectedCallback",value:function(){this.shadowRoot.querySelector("#drag").removeEventListener("dragstart",this._dragStart),this.shadowRoot.querySelector("#drag").removeEventListener("dragend",this._dragEnd),k(w(n.prototype),"disconnectedCallback",this).call(this)}},{key:"_dragEnd",value:function(e){window.HaxStore.instance._lockContextPosition=!1;var t=window.HaxStore.instance.activeHaxBody.children;for(var n in t)"undefined"!==h(t[n].classList)&&t[n].classList.remove("hax-mover","hax-hovered","hax-moving","grid-plate-active-item")}},{key:"_dragStart",value:function(e){var t=window.HaxStore.instance.activeNode;window.HaxStore.instance.__dragTarget=t,window.HaxStore.instance._lockContextPosition=!0,t.classList.add("hax-moving"),e.dataTransfer&&(e.dataTransfer.dropEffect="move",e.dataTransfer.setDragImage(t,-20,-20)),e.stopPropagation(),e.stopImmediatePropagation(),setTimeout(function(){if(!window.HaxStore.instance.activeHaxBody.openDrawer&&window.HaxStore.instance.editMode){var e=window.HaxStore.instance.activeHaxBody.children;for(var n in e)e[n].classList&&t!==e[n]&&e[n].classList.add("hax-mover")}},10)}},{key:"html",get:function(){return'\n    <style>\n    :host {\n      display: block;\n      margin-top: -2px;\n      background-color:white;\n      --hax-contextual-action-color: var(\n        --simple-colors-default-theme-cyan-8,\n        #007999\n      );\n    }\n    hax-context-item {\n      display: block;\n    }\n    hax-context-item[large] {\n      display: inline-block;\n      margin:0;\n      padding:0;\n    }\n    hax-context-item-menu {\n      --hax-context-item-menu-height: 28px;\n    }\n    .area {\n      display: flex;\n      visibility: visible;\n      opacity: .8;\n      transition: .2s all ease-in-out;\n    }\n    .area:hover {\n      opacity: 1;\n    }\n    paper-item {\n      background-color: var(--hax-contextual-action-color);\n      -webkit-justify-content: flex-start;\n      justify-content: flex-start;\n      height: 24px;\n      padding: 0 4px;\n      min-height: 24px;\n      font-size: 10px;\n      color: white;\n    }\n    #drag hax-context-item:hover,\n    paper-item:hover {\n      cursor: pointer;\n      color: black;\n    }\n    iron-icon {\n      padding: 0 2px;\n      width: 16px;\n      height: 16px;\n    }\n    :host(.hax-context-pin-top) .area {\n      position: fixed;\n      top: 40px;\n      margin-left: -30px;\n      flex-direction: column;\n    }\n    </style>\n    <div class="area" id="area">\n      <hax-context-item-menu\n        mini\n        id="drag"\n        action\n        icon="hax:arrow-all"\n        label="Drag"\n        draggable="true"\n        selected-value="0"\n        reset-on-select>\n      <paper-item hidden value=""></paper-item>\n      <hax-context-item\n        action\n        mini\n        icon="hardware:keyboard-arrow-up"\n        label="Move up"\n        event-name="hax-plate-up"\n        direction="left"\n        ></hax-context-item>\n      <hax-context-item\n        action\n        mini\n        icon="hardware:keyboard-arrow-down"\n        label="Move down"\n        event-name="hax-plate-down"\n        direction="left"\n        ></hax-context-item>\n    </hax-context-item-menu>\n      <hax-context-item\n      mini\n      action\n      id="right"\n      class="paddle"\n      icon="hax:table-column-remove"\n      label="Add column"\n      event-name="hax-plate-create-right"\n    ></hax-context-item>\n    <hax-context-item\n      mini\n      action\n      class="paddle"\n      icon="hax:table-column-plus-after"\n      label="Remove column"\n      event-name="hax-plate-remove-right"\n      id="rightremove"\n    ></hax-context-item>\n  <hax-context-item\n    mini\n    action\n    label="Duplicate"\n    icon="icons:content-copy"\n    event-name="hax-plate-duplicate"\n    ></hax-context-item>\n  <hax-context-item\n    mini\n    action\n    icon="delete"\n    label="Remove"\n    event-name="hax-plate-delete"\n  ></hax-context-item>\n  </div>\n  '}}],[{key:"tag",get:function(){return"hax-plate-context"}}]),n}();function T(){var e=C(['\n      <hax-toolbar hide-more>\n        <hax-context-item\n          mini\n          action\n          more\n          slot="prefix"\n          icon="','"\n          label="',', click to change"\n          ?disabled="','"\n          event-name="hax-transform-node"\n        ></hax-context-item>\n        <slot slot="primary"></slot>\n      </hax-toolbar>\n    ']);return T=function(){return e},e}function A(){var e=C(["\n        :host *[hidden] {\n          display: none;\n        }\n        :host {\n          display: block;\n        }\n        hax-context-item {\n          margin: 0;\n        }\n        :host(.hax-context-pin-top) hax-toolbar {\n          position: fixed;\n          top: 40px;\n          flex-direction: column;\n        }\n      "]);return A=function(){return e},e}window.customElements.define(L.tag,L);var R=function(e){y(n,a.winEventsElement(s.LitElement));var t=_(n);function n(){var e;return p(this,n),(e=t.call(this)).__winEvents={"hax-store-property-updated":"_haxStorePropertyUpdated"},e.haxProperties={},setTimeout(function(){},0),e}return x(n,null,[{key:"styles",get:function(){return[s.css(A())]}}]),x(n,[{key:"_haxStorePropertyUpdated",value:function(e){var t=this;e.detail&&"undefined"!==h(e.detail.value)&&e.detail.property&&("activeNode"!==e.detail.property&&"activeContainerNode"!==e.detail.property||setTimeout(function(){t._computeValues()},0))}},{key:"render",value:function(){return s.html(T(),this.activeTagIcon,this.activeTagName,this.disableTransform)}},{key:"_computeValues",value:function(){var e=window.HaxStore.instance;null!=e.activeNode?e.isTextElement(e.activeNode)||("GRID-PLATE"==e.activeNode.tagName?(this.disableTransform=!0,this.activeTagName="Grid",this.activeTagIcon="hax:3/3/3/3"):(this.disableTransform=!e.activeHaxBody.canTansformNode(e.activeNode),e.activeGizmo&&(this.activeTagName=e.activeGizmo.title,this.activeTagIcon=e.activeGizmo.icon))):(this.activeTagName="",this.activeTagIcon="")}}],[{key:"tag",get:function(){return"hax-ce-context"}},{key:"properties",get:function(){return{disableTransform:{type:Boolean},activeTagIcon:{type:String},activeTagName:{type:String}}}}]),n}();function P(){var e=C(['\n      <hax-toolbar\n        .selected="','"\n        ?hide-more="','"\n        id="toolbar"\n      >\n        <hax-context-item-menu\n          action\n          mini\n          slot="primary"\n          .selected-value="','"\n          @selected-value-changed="','"\n          id="formatsize"\n          icon="','"\n          label="Text format"\n          event-name="text-tag"\n        >\n          <paper-item hidden value=""></paper-item>\n          <paper-item value="p"\n            ><iron-icon icon="hax:paragraph"></iron-icon>Paragraph</paper-item\n          >\n          <paper-item value="ul"\n            ><iron-icon icon="editor:format-list-bulleted"></iron-icon>Bulleted\n            list</paper-item\n          >\n          <paper-item value="ol"\n            ><iron-icon icon="editor:format-list-numbered"></iron-icon>Numbered\n            list</paper-item\n          >\n          <paper-item value="h2"\n            ><iron-icon icon="hax:h2"></iron-icon>Title\n          </paper-item>\n          <paper-item value="h3"\n            ><iron-icon icon="hax:h3"></iron-icon>Content heading\n          </paper-item>\n          <paper-item value="h4"\n            ><iron-icon icon="hax:h4"></iron-icon>Subheading\n          </paper-item>\n          <paper-item value="h5"\n            ><iron-icon icon="hax:h5"></iron-icon>Deep subheading\n          </paper-item>\n          <paper-item value="blockquote"\n            ><iron-icon icon="editor:format-quote"></iron-icon>Blockquote\n          </paper-item>\n          <paper-item value="code"\n            ><iron-icon icon="icons:code"></iron-icon>Code\n          </paper-item>\n        </hax-context-item-menu>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:format-list-bulleted"\n          event-name="text-tag-ul"\n          label="Bulleted list"\n          .hidden="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:format-list-numbered"\n          label="Numbered list"\n          event-name="text-tag-ol"\n          .hidden="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:format-indent-decrease"\n          label="Outdent"\n          event-name="text-outdent"\n          .hidden="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:format-indent-increase"\n          label="Indent"\n          event-name="text-indent"\n          .hidden="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:format-bold"\n          label="Bold"\n          class="selected-buttons"\n          event-name="text-bold"\n          ?disabled="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:format-italic"\n          label="Italic"\n          class="selected-buttons"\n          event-name="text-italic"\n          ?disabled="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:insert-link"\n          label="Link"\n          class="selected-buttons"\n          event-name="text-link"\n          ?disabled="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="mdextra:unlink"\n          label="Remove link"\n          class="selected-buttons"\n          event-name="text-unlink"\n          ?disabled="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:format-clear"\n          label="Remove format"\n          class="selected-buttons"\n          event-name="text-remove-format"\n          ?disabled="','"\n        ></hax-context-item-textop>\n        <hax-context-item\n          mini\n          action\n          slot="primary"\n          icon="hax:add-brick"\n          label="Add element to selection"\n          class="selected-buttons"\n          event-name="insert-inline-gizmo"\n          ?hidden="','"\n        ></hax-context-item>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="hax:add-brick"\n          label="Add element to selection"\n          class="selected-buttons"\n          event-name="insert-inline-gizmo"\n          ?hidden="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          action\n          menu\n          slot="more"\n          icon="mdextra:subscript"\n          event-name="text-subscript"\n          >Subscript</hax-context-item-textop\n        >\n        <hax-context-item-textop\n          action\n          menu\n          slot="more"\n          icon="mdextra:superscript"\n          event-name="text-superscript"\n          >Superscript</hax-context-item-textop\n        >\n        <hax-context-item-textop\n          action\n          menu\n          slot="more"\n          icon="editor:format-underlined"\n          event-name="text-underline"\n          >Underline</hax-context-item-textop\n        >\n        <hax-context-item-textop\n          action\n          menu\n          slot="more"\n          icon="editor:format-strikethrough"\n          event-name="text-strikethrough"\n          >Cross out</hax-context-item-textop\n        >\n      </hax-toolbar>\n    ']);return P=function(){return e},e}function M(){var e=C(["\n        :host {\n          display: block;\n          pointer-events: none;\n          --hax-contextual-action-color: var(\n            --simple-colors-default-theme-cyan-8,\n            #007999\n          );\n        }\n        hax-context-item-textop:not(:defined),\n        hax-context-item-menu:not(:defined),\n        hax-context-item:not(:defined),\n        hax-toolbar:not(:defined),\n        paper-item:not(:defined),\n        iron-icon:not(:defined) {\n          display: none;\n        }\n        :host [hidden] {\n          display: none;\n        }\n        .selected-buttons {\n          transition: 0.1s all ease-in-out;\n          width: 0;\n        }\n        :host([has-selected-text]) .selected-buttons {\n          width: 100%;\n        }\n        #toolbar {\n          overflow: hidden;\n        }\n        paper-item {\n          color: white;\n          background-color: var(--hax-contextual-action-color);\n          -webkit-justify-content: flex-start;\n          justify-content: flex-start;\n          font-size: 11px;\n          line-height: 24px;\n          margin: 0;\n          padding: 0 4px;\n          min-height: 24px;\n        }\n        paper-item:hover {\n          cursor: pointer;\n          color: black;\n        }\n        iron-icon {\n          width: 20px;\n          height: 20px;\n          padding: 4px;\n        }\n        paper-item strong {\n          padding: 4px;\n        }\n        hax-context-item-textop,\n        hax-context-item {\n          transition: all 0.2s linear;\n          visibility: visible;\n          opacity: 1;\n        }\n        hax-context-item-textop[hidden],\n        hax-context-item[hidden] {\n          visibility: hidden;\n          opacity: 0;\n        }\n        :host(.hax-context-pin-top) hax-toolbar {\n          position: fixed;\n          top: 40px;\n          flex-direction: column;\n        }\n      "]);return M=function(){return e},e}window.customElements.define(R.tag,R);var q=function(e){y(n,a.winEventsElement(s.LitElement));var t=_(n);function n(){var e;return p(this,n),(e=t.call(this)).__winEvents={"hax-store-property-updated":"_haxStorePropertyUpdated"},setTimeout(function(){e.addEventListener("hax-context-item-selected",e._haxContextOperation.bind(S(e)))},0),e.realSelectedValue="p",e.selection=!1,e.formatIcon="hax:format-textblock",e.isSafari=e._isSafari(),e}return x(n,null,[{key:"styles",get:function(){return[s.css(M())]}}]),x(n,[{key:"_haxStorePropertyUpdated",value:function(e){e.detail&&"undefined"!==h(e.detail.value)&&e.detail.property&&(this[e.detail.property]=e.detail.value)}},{key:"render",value:function(){return s.html(P(),this.selection,!this.hasSelectedText,this.selectedValue,this.selectedValueChanged,this.formatIcon,!this._showLists,!this._showLists,!this._showIndent,!this._showIndent,!this.hasSelectedText,!this.hasSelectedText,!this.hasSelectedText,!this.hasSelectedText,!this.hasSelectedText,this.isSafari||!this.hasSelectedText,!this.isSafari||!this.hasSelectedText)}},{key:"selectedValueChanged",value:function(e){this.selectedValue=e.detail}},{key:"updated",value:function(e){var t=this;e.forEach(function(e,n){if(t.realSelectedValue&&"realSelectedValue"==n&&t.shadowRoot)for(var o in t._showIndent=t._computeShowIndent(t.realSelectedValue),t._showIndent||"p"==t.realSelectedValue?t._showLists=!0:t._showLists=!1,t.shadowRoot.querySelector("#formatsize").children)t.shadowRoot.querySelector("#formatsize").children[o]&&t.shadowRoot.querySelector("#formatsize").children[o].getAttribute&&t.shadowRoot.querySelector("#formatsize").children[o].getAttribute("value")==t.realSelectedValue&&(t.selectedValue=o);"haxSelectedText"==n&&(t.hasSelectedText=t[n].length>0),"selectedValue"==n&&""!=t.selectedValue&&(t.realSelectedValue=t.shadowRoot.querySelector("#formatsize").children[t.selectedValue].getAttribute("value"),t.formatIcon=t.shadowRoot.querySelector("#formatsize").children[t[n]].querySelector("iron-icon").icon,t.dispatchEvent(new CustomEvent("selected-value-changed",{detail:t[n]})))})}},{key:"_computeShowIndent",value:function(e){return!(!window.HaxStore.instance.computePolyfillSafe()||"ol"!=e&&"ul"!=e)}},{key:"_haxContextOperation",value:function(e){var t=this,n=e.detail,o=window.HaxStore.getSelection(),i=!1;switch(n.eventName){case"close-menu":setTimeout(function(){t.shadowRoot.querySelector("#formatsize").shadowRoot.querySelector("#menu").hideMenu()},200);break;case"insert-inline-gizmo":if(window.HaxStore._tmpSelection&&window.HaxStore.instance.editMode)try{"HAX-BODY"!==window.HaxStore._tmpRange.startContainer.parentNode.parentNode.tagName&&"HAX-BODY"!==window.HaxStore._tmpRange.startContainer.parentNode.parentNode.parentNode.tagName||(window.HaxStore.instance.activePlaceHolder=window.HaxStore._tmpRange,window.HaxStore.write("activePlaceHolder",window.HaxStore._tmpRange,this))}catch(e){}if(null!=window.HaxStore.instance.activePlaceHolder){var a={text:window.HaxStore.instance.activePlaceHolder.toString()},r=window.HaxStore.guessGizmo("inline",a);r.length>0&&window.HaxStore.instance.haxAppPicker.presentOptions(r,"inline","Transform selected text to..","gizmo")}break;case"text-bold":document.execCommand("bold"),i=!0;break;case"text-italic":document.execCommand("italic"),i=!0;break;case"text-underline":document.execCommand("underline"),i=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-subscript":document.execCommand("subscript"),i=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-superscript":document.execCommand("superscript"),i=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-remove-format":document.execCommand("removeFormat"),i=!0;break;case"text-strikethrough":document.execCommand("strikeThrough"),i=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-link":var s="";o&&o.focusNode&&o.focusNode.parentNode&&"undefined"!==h(o.focusNode.parentNode.href)&&(s=o.focusNode.parentNode.href);var c=prompt("Enter a URL:",s);c&&(document.execCommand("createLink",!1,c),o.focusNode.parentNode&&(o.focusNode.parentNode.setAttribute("contenteditable",!0),o.focusNode.parentNode.setAttribute("data-editable",!0),o.focusNode.parentNode.removeEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),o.focusNode.parentNode.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()})),i=!0);break;case"text-unlink":document.execCommand("unlink"),i=!0;break;case"text-indent":document.execCommand("indent"),i=!0;break;case"text-outdent":document.execCommand("outdent"),i=!0}i&&(e.preventDefault(),e.stopPropagation())}},{key:"_isSafari",value:function(){var e=navigator.userAgent.toLowerCase();return!(-1==e.indexOf("safari")||e.indexOf("chrome")>-1)}}],[{key:"tag",get:function(){return"hax-text-context"}},{key:"properties",get:function(){return{_showIndent:{type:Boolean},_showLists:{type:Boolean},realSelectedValue:{type:String},hasSelectedText:{type:Boolean,attribute:"has-selected-text",reflect:!0},haxSelectedText:{type:String},selectedValue:{type:Number,attribute:"selected-value"},selection:{type:Boolean},formatIcon:{type:String,attribute:"format-icon"},isSafari:{type:Boolean,attribute:"is-safari"}}}}]),n}();function O(){var e=C(['\n      <div id="bodycontainer" class="ignore-activation">\n        <slot id="body"></slot>\n      </div>\n      <hax-text-context\n        id="textcontextmenu"\n        class="hax-context-menu ignore-activation"\n      ></hax-text-context>\n      <hax-ce-context\n        id="cecontextmenu"\n        class="hax-context-menu ignore-activation"\n      ></hax-ce-context>\n      <hax-plate-context\n        id="platecontextmenu"\n        class="hax-context-menu ignore-activation"\n      ></hax-plate-context>\n    ']);return O=function(){return e},e}function D(){var e=C(['\n        :host([edit-mode]),\n        :host([edit-mode]) * ::slotted(*) {\n          line-height: 1.8;\n        }\n        :host([edit-mode]) ul,\n        :host([edit-mode]) ol {\n          padding-left: 20px;\n          margin-left: 20px;\n        }\n        :host([edit-mode]) ul {\n          list-style-type: disc;\n        }\n        :host([edit-mode]) li {\n          margin-bottom: 6px;\n        }\n        :host {\n          display: block;\n          position: relative;\n          min-height: 32px;\n          min-width: 32px;\n          outline: none;\n          --hax-contextual-action-text-color: var(\n            --simple-colors-default-theme-grey-1,\n            #fff\n          );\n          --hax-contextual-action-hover-color: var(\n            --simple-colors-default-theme-cyan-7,\n            #009dc7\n          );\n          --hax-contextual-action-color: var(\n            --simple-colors-default-theme-cyan-8,\n            #007999\n          );\n          --hax-body-editable-outline: 1px solid\n            var(--simple-colors-default-theme-deep-orange, #ff8a64);\n          --hax-body-active-outline-hover: 1px solid\n            var(\n              --hax-contextual-action-hover-color,\n              var(--simple-colors-default-theme-cyan-7, #009dc7)\n            );\n          --hax-body-active-outline: 3px solid\n            var(\n              --hax-contextual-action-hover-color,\n              var(--simple-colors-default-theme-cyan-7, #009dc7)\n            );\n          --hax-body-target-background-color: var(\n            --simple-colors-default-theme-cyan-2,\n            #9beaff\n          );\n          --hax-body-possible-target-background-color: var(\n            --simple-colors-default-theme-grey-2,\n            #dddddd;\n          );\n        }\n        .hax-context-menu {\n          padding: 0;\n          margin-left: -5000px;\n          position: fixed;\n          visibility: hidden;\n          opacity: 0;\n          z-index: 1000;\n          float: left;\n          display: block;\n          pointer-events: none;\n          transition: 0.2s top ease-in-out, 0.2s left ease-in-out,\n            0.2s visibility ease-in-out, 0.2s opacity ease-in-out;\n        }\n        #textcontextmenu.hax-context-menu {\n          z-index: 1000;\n        }\n        .hax-context-visible {\n          position: absolute;\n          visibility: visible;\n          pointer-events: all;\n          opacity: 1;\n        }\n        .hax-context-visible.hax-active-hover {\n          margin-left: unset;\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(p) {\n          min-height: var(--hax-base-styles-p-min-height, 1rem);\n          font-size: var(--hax-base-styles-p-font-size);\n          line-height: var(--hax-base-styles-p-line-height);\n          letter-spacing: var(--hax-base-styles-p-letter-spacing);\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(a) {\n          color: var(--hax-base-styles-a-color);\n          font-size: var(\n            --hax-base-styles-a-font-size,\n            var(--hax-base-styles-p-font-size)\n          );\n          font-weight: var(--hax-base-styles-a-font-weight);\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(a:visited) {\n          color: var(--hax-base-styles-a-color-visited);\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(a:active),\n        :host([edit-mode]) #bodycontainer ::slotted(a:focus),\n        :host([edit-mode]) #bodycontainer ::slotted(a:hover) {\n          color: var(--hax-base-styles-a-color-active);\n          font-weight: var(--hax-base-styles-a-font-weight-active);\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(ol),\n        :host([edit-mode]) #bodycontainer ::slotted(ul),\n        :host([edit-mode]) #bodycontainer ::slotted(li) {\n          padding-bottom: var(--hax-base-styles-list-padding-bottom);\n          line-height: var(\n            --hax-base-styles-list-line-height,\n            var(--hax-base-styles-p-line-height)\n          );\n          font-size: var(\n            --hax-base-styles-list-font-size,\n            var(--hax-base-styles-p-font-size)\n          );\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(ol > li:last-child),\n        :host([edit-mode]) #bodycontainer ::slotted(ul > li:last-child) {\n          padding-bottom: var(--hax-base-styles-list-last-child-padding-bottom);\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(img[data-editable]) {\n          max-width: 100%;\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]) {\n          outline: none;\n          transition: 0.8s ease-in-out outline;\n          caret-color: var(--hax-color-text);\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(*.blinkfocus) {\n          outline: 8px solid var(--hax-contextual-action-hover-color);\n        }\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*:not(grid-plate)[data-editable]:hover) {\n          outline: var(--hax-body-active-outline-hover);\n          caret-color: #000000;\n        }\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*.hax-active[data-editable]:hover) {\n          cursor: text !important;\n          outline: var(--hax-body-active-outline-hover);\n        }\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*:not(grid-plate)[data-editable] .hax-active:hover) {\n          cursor: text !important;\n          outline: var(--hax-body-active-outline-hover);\n        }\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(code.hax-active[data-editable]) {\n          display: block;\n        }\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*.hax-active[data-editable]) {\n          outline: var(--hax-body-active-outline) !important;\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(hr[data-editable]) {\n          height: 2px;\n          background-color: #eeeeee;\n          padding-top: 4px;\n          padding-bottom: 4px;\n        }\n        /** Fix to support safari as it defaults to none */\n        :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]) {\n          -webkit-user-select: text;\n          cursor: pointer;\n        }\n\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*[data-editable]::-moz-selection),\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*[data-editable] *::-moz-selection) {\n          background-color: var(--hax-body-highlight, --paper-yellow-300);\n          color: black;\n        }\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*[data-editable]::selection),\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*[data-editable] *::selection) {\n          background-color: var(--hax-body-highlight, --paper-yellow-300);\n          color: black;\n        }\n        #bodycontainer {\n          -webkit-user-select: text;\n          user-select: text;\n        }\n        :host([edit-mode][hax-ray-mode])\n          #bodycontainer\n          ::slotted(*[data-editable]):before {\n          content: attr(data-hax-ray) " " attr(resource) " " attr(typeof) " "\n            attr(property) " " attr(content);\n          font-size: 12px;\n          line-height: 12px;\n          left: unset;\n          right: unset;\n          top: unset;\n          background-color: var(--simple-colors-default-theme-cyan-7, #3b97e3);\n          color: #ffffff;\n          bottom: unset;\n          width: auto;\n          padding: 6px;\n          margin: -2px;\n          z-index: 1;\n          margin: 0;\n          float: right;\n        }\n        .hax-context-menu:not(:defined) {\n          display: none;\n        }\n        /* drag and drop */\n        :host([edit-mode]) #bodycontainer ::slotted(*.hax-moving) {\n          outline: var(--hax-body-active-outline);\n          background-color: #eeeeee;\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(*.hax-mover):before {\n          outline: var(--hax-body-editable-outline);\n          background-color: var(--hax-body-possible-target-background-color);\n          content: " ";\n          width: 100%;\n          display: block;\n          position: relative;\n          margin: -30px 0 0 0;\n          z-index: 2;\n          height: 30px;\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(*.hax-hovered):before {\n          background-color: var(--hax-body-target-background-color) !important;\n          outline: var(--hax-body-active-outline);\n        }\n        @media screen and (min-color-index: 0) and(-webkit-min-device-pixel-ratio:0) {\n          /*\n            Define here the CSS styles applied only to Safari browsers\n            (any version and any device) via https://solvit.io/bcf61b6\n          */\n          :host([edit-mode]) #bodycontainer ::slotted(*.hax-mover) {\n            outline: var(--hax-body-editable-outline);\n            background-color: var(--hax-body-possible-target-background-color);\n          }\n          :host([edit-mode]) #bodycontainer ::slotted(*.hax-hovered) {\n            background-color: var(\n              --hax-body-target-background-color\n            ) !important;\n            outline: var(--hax-body-active-outline);\n          }\n        }\n      ']);return D=function(){return e},e}window.customElements.define(q.tag,q);var j=null,I=25,B=100,z=function(e){y(n,u.UndoManagerBehaviors(l.SimpleColors));var t=_(n);function n(){var e;return p(this,n),(e=t.call(this)).__mouseMoving=!1,e.___moveLock=!1,e.editMode=!1,e.globalPreferences={},e.haxRayMode=!1,e.activeNode=null,e.haxSelectedText="",e.activeContainerNode=null,setTimeout(function(){e.polyfillSafe=window.HaxStore.instance.computePolyfillSafe(),e.addEventListener("hax-context-item-selected",e._haxContextOperation.bind(S(e))),e.addEventListener("place-holder-replace",e.replacePlaceholder.bind(S(e))),e.addEventListener("focusin",e._focusIn.bind(S(e))),e.addEventListener("mousedown",e._mouseDown.bind(S(e))),e.addEventListener("mouseup",e._mouseUp.bind(S(e))),e.addEventListener("dragenter",e.dragEnterBody.bind(S(e))),e.addEventListener("drop",e.dropEvent.bind(S(e))),e.addEventListener("click",e.clickEvent.bind(S(e)))},0),e}return x(n,null,[{key:"styles",get:function(){return[].concat(H(k(w(n),"styles",this)),[s.css(D())])}}]),x(n,[{key:"_mouseDown",value:function(e){this.__mouseDown=!0,this.__focusLogic(e.target)&&(e.stopPropagation(),e.stopImmediatePropagation())}},{key:"_mouseUp",value:function(e){var t=this;setTimeout(function(){t.__mouseDown=!1},0),clearTimeout(j),this.__manageFakeEndCap(!1)}},{key:"clickEvent",value:function(e){clearTimeout(j)}},{key:"__manageFakeEndCap",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e&&!this.__fakeEndCap){var t=document.createElement("fake-hax-body-end");t.style.width="100%",t.style.height="20px",t.style.display="block",t.classList.add("hax-move"),this.__fakeEndCap=t,this.appendChild(this.__fakeEndCap)}else!e&&this.__fakeEndCap&&(this.__fakeEndCap.remove(),this.__fakeEndCap=null)}},{key:"dragEnterBody",value:function(e){var t=this.childNodes;for(var n in this.__manageFakeEndCap(!0),t)t[n].classList&&t[n]!==this.activeItem&&t[n].classList.add("hax-mover")}},{key:"render",value:function(){return s.html(O())}},{key:"firstUpdated",value:function(e){var t=this;this.dispatchEvent(new CustomEvent("hax-register-body",{bubbles:!0,cancelable:!0,composed:!0,detail:this}));try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("defaultParagraphSeparator",!1,"p")}catch(e){console.warn(e)}this.shadowRoot.querySelector("slot").addEventListener("mousemove",this.hoverEvent.bind(this)),this.shadowRoot.querySelector("slot").addEventListener("mouseup",function(e){!t.openDrawer&&t.editMode&&setTimeout(function(){var e=window.HaxStore.getSelection();window.HaxStore._tmpSelection=e,window.HaxStore.write("haxSelectedText",e.toString(),t);try{var n=window.HaxStore.getRange();n.cloneRange&&(window.HaxStore._tmpRange=n.cloneRange())}catch(e){console.warn(e)}},10)}),this.editMode=window.HaxStore.instance.editMode,this.__tabTrap=!1,this.__ready=!0,k(w(n.prototype),"firstUpdated",this)&&k(w(n.prototype),"firstUpdated",this).call(this,e)}},{key:"updated",value:function(e){var t=this;e.forEach(function(e,n){"editMode"==n&&t._editModeChanged(t[n],e),"globalPreferences"==n&&t._globalPreferencesUpdated(t[n],e),"activeNode"==n&&t.__ready&&(t._activeNodeChanged(t[n],e),t.dispatchEvent(new CustomEvent("active-node-changed",{detail:{value:t[n]}}))),"activeContainerNode"==n&&t.__ready&&(t._activeContainerNodeChanged(t[n],e),t.dispatchEvent(new CustomEvent("active-container-node-changed",{detail:{value:t[n]}})))}),k(w(n.prototype),"updated",this)&&k(w(n.prototype),"updated",this).call(this,e)}},{key:"connectedCallback",value:function(){var e=this;k(w(n.prototype),"connectedCallback",this).call(this),this._observer=new MutationObserver(function(t){var n=!1;e.__mouseMoving||e.undoStackIgnore||e.__fakeEndCap?e.undoStackIgnore&&t.forEach(function(t){t.addedNodes.length>0&&t.addedNodes.forEach(function(t){e._validElementTest(t)&&setTimeout(function(){e.__applyNodeEditableState(t,e.editMode)},0)})}):t.forEach(function(t){t.addedNodes.length>0&&t.addedNodes.forEach(function(t){e._validElementTest(t)&&(!e.editMode||"true"!=t.getAttribute("contenteditable")&&!0!==t.getAttribute("contenteditable")&&"contenteditable"!=t.getAttribute("contenteditable")||e.__applyNodeEditableState(t,!e.editMode),e.__applyNodeEditableState(t,e.editMode),e.dispatchEvent(new CustomEvent("hax-body-tag-added",{bubbles:!0,cancelable:!0,composed:!0,detail:{node:t}})),["H1","H2","H3","H4","H5","H6"].includes(t.tagName)&&null==t.getAttribute("id")&&t.setAttribute("id",a.generateResourceID("header-")),e.___moveLock||n?e.___moveLock=!1:(n=!0,e.activeNode=t,window.HaxStore.write("activeNode",t,e)))}),t.removedNodes.length>0&&t.removedNodes.forEach(function(t){e._validElementTest(t)&&!t.classList.contains("hax-active")&&e.dispatchEvent(new CustomEvent("hax-body-tag-removed",{bubbles:!0,cancelable:!0,composed:!0,detail:{node:t}}))})})}),this._observer.observe(this,{childList:!0}),setTimeout(function(){window.addEventListener("keydown",e._onKeyDown.bind(e)),window.addEventListener("keypress",e._onKeyPress.bind(e)),document.body.addEventListener("hax-store-property-updated",e._haxStorePropertyUpdated.bind(e)),window.addEventListener("scroll",e._keepContextVisible.bind(e)),window.addEventListener("resize",e._keepContextVisible.bind(e))},0)}},{key:"disconnectedCallback",value:function(){window.removeEventListener("keydown",this._onKeyDown.bind(this)),window.removeEventListener("keypress",this._onKeyPress.bind(this)),document.body.removeEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),window.removeEventListener("scroll",this._keepContextVisible.bind(this)),window.removeEventListener("resize",this._keepContextVisible.bind(this)),this._observer.disconnect(),k(w(n.prototype),"disconnectedCallback",this).call(this)}},{key:"_keepContextVisible",value:function(){var e=this;!this.openDrawer&&this.editMode&&(clearTimeout(this.__contextVisibleLock),this.__contextVisibleLock=setTimeout(function(){var t=!1;e.shadowRoot.querySelector("#textcontextmenu").classList.contains("hax-context-visible")?t=e.shadowRoot.querySelector("#textcontextmenu"):e.shadowRoot.querySelector("#cecontextmenu").classList.contains("hax-context-visible")&&(t=e.shadowRoot.querySelector("#cecontextmenu")),t&&(e.elementMidViewport()?(t.classList.add("hax-context-pin-top"),e.shadowRoot.querySelector("#platecontextmenu").classList.add("hax-context-pin-top")):(t.classList.remove("hax-context-pin-top"),e.shadowRoot.querySelector("#platecontextmenu").classList.remove("hax-context-pin-top")),e.positionContextMenus())},50))}},{key:"_onKeyDown",value:function(e){var t=this;if(!this.openDrawer&&this.editMode&&this.getAttribute("contenteditable")&&null!=window.HaxStore.getSelection().anchorNode){switch(e.key){case"Tab":window.HaxStore.instance.isTextElement(this.activeNode)&&(e.detail.keyboardEvent&&(e.detail.keyboardEvent.preventDefault(),e.detail.keyboardEvent.stopPropagation(),e.detail.keyboardEvent.stopImmediatePropagation()),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.shiftKey?this._tabBackKeyPressed():this._tabKeyPressed());break;case"Enter":this.setAttribute("contenteditable",!0);case"Backspace":case"Delete":case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":setTimeout(function(){var e=window.HaxStore.getSelection();window.HaxStore._tmpSelection=e,window.HaxStore.write("haxSelectedText",e.toString(),t);var n=window.HaxStore.getRange();n.commonAncestorContainer&&t.activeNode!==n.commonAncestorContainer&&"function"==typeof n.commonAncestorContainer.focus?"HAX-BODY"!==n.commonAncestorContainer.tagName&&(window.HaxStore.instance.isTextElement(n.commonAncestorContainer)?t.setAttribute("contenteditable",!0):t.removeAttribute("contenteditable"),n.commonAncestorContainer.focus(),t.__focusLogic(n.commonAncestorContainer)):n.commonAncestorContainer&&n.commonAncestorContainer.parentNode&&t.activeNode!==n.commonAncestorContainer.parentNode&&"function"==typeof n.commonAncestorContainer.parentNode.focus&&("HAX-BODY"!==n.commonAncestorContainer.parentNode.tagName?(window.HaxStore.instance.isTextElement(n.commonAncestorContainer.parentNode)?t.setAttribute("contenteditable",!0):t.removeAttribute("contenteditable"),n.commonAncestorContainer.parentNode.focus(),t.__focusLogic(n.commonAncestorContainer.parentNode)):(t.activeNode=n.commonAncestorContainer,t.activeContainerNode=t.activeNode,window.HaxStore.write("activeNode",n.commonAncestorContainer,t),window.HaxStore.write("activeContainerNode",n.commonAncestorContainer,t),setTimeout(function(){t.positionContextMenus()},0)))},50)}this.shadowRoot.querySelector("#platecontextmenu").classList.contains("hax-active-hover")&&this.__dropActiveHover()}}},{key:"_onKeyPress",value:function(e){var t=this;clearTimeout(this.__keyPress),this.__keyPress=setTimeout(function(){!t.openDrawer&&t.editMode&&t.shadowRoot.querySelector("#textcontextmenu").classList.contains("hax-active-hover")&&t.activeNode&&window.HaxStore.instance.isTextElement(t.activeNode)?t.__dropActiveHover():!t.openDrawer&&t.editMode&&t.activeNode&&window.HaxStore.instance.isTextElement(t.activeNode)&&(clearTimeout(t.__positionContextTimer),t.__positionContextTimer=setTimeout(function(){t.positionContextMenus()},1500))},50)}},{key:"hoverEvent",value:function(e){if(!this.openDrawer&&this.editMode&&(e.target&&null!=e.target.getAttribute("data-hax-ray")?this.__activeHover=e.target:e.target&&e.target.parentNode&&null!=e.target.parentNode.getAttribute("data-hax-ray")&&(this.__activeHover=e.target.parentNode),!this.shadowRoot.querySelector("#platecontextmenu").classList.contains("hax-active-hover"))){var t=e.target;e.target===this.shadowRoot.querySelector("#cecontextmenu")||e.target===this.shadowRoot.querySelector("#textcontextmenu")||e.target===this.shadowRoot.querySelector("#platecontextmenu")||t===this.activeNode||t===this.activeContainerNode||e.target===this.activeNode||e.target===this.activeContainerNode||t.parentNode===this.activeContainerNode||t.parentNode.parentNode===this.activeContainerNode||t.parentNode.parentNode.parentNode===this.activeContainerNode?(this.positionContextMenus(),this.__addActiveHover(),this.__typeLock=!1):this.__dropActiveHover()}}},{key:"__addActiveHover",value:function(){this.shadowRoot.querySelector("#cecontextmenu").classList.add("hax-active-hover"),this.shadowRoot.querySelector("#textcontextmenu").classList.add("hax-active-hover"),this.shadowRoot.querySelector("#platecontextmenu").classList.add("hax-active-hover")}},{key:"__dropActiveHover",value:function(){this.shadowRoot.querySelector("#cecontextmenu").classList.remove("hax-active-hover"),this.shadowRoot.querySelector("#textcontextmenu").classList.remove("hax-active-hover"),this.shadowRoot.querySelector("#platecontextmenu").classList.remove("hax-active-hover")}},{key:"elementMidViewport",value:function(){var e=this.activeNode.getBoundingClientRect().y;return e<0&&e>-1*this.activeNode.offsetHeight+140}},{key:"replacePlaceholder",value:function(e){var t=this;if("text"===e.detail){var n=document.createElement("p");n.innerHTML="<br/>",this.haxReplaceNode(this.activeNode,n),setTimeout(function(){t.activeNode=n,window.HaxStore.write("activeNode",n,t),t.activeContainerNode.setAttribute("contenteditable",!0),n.focus(),t.__focusLogic(n)},210)}else this.replaceElementWorkflow()}},{key:"canTansformNode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.replaceElementWorkflow(e,!0).length>0}},{key:"replaceElementWorkflow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];null==e&&(e=this.activeNode);var n=a.nodeToHaxElement(e,null),o="*",i=!1;"place-holder"===n.tag&&"undefined"!==h(n.properties.type)&&(o=n.properties.type,i=!0);var r={};if("undefined"!==h(window.HaxStore.instance.elementList[n.tag])&&!1!==window.HaxStore.instance.elementList[n.tag].gizmo&&"undefined"!==h(window.HaxStore.instance.elementList[n.tag].gizmo.handles)&&window.HaxStore.instance.elementList[n.tag].gizmo.handles.length>0)for(var s=window.HaxStore.instance.elementList[n.tag].gizmo,c=0;c<s.handles.length;c++)for(var d in s.handles[c])"type"!==d&&"undefined"!==h(n.properties[s.handles[c][d]])&&(r[d]=n.properties[s.handles[c][d]]);var l=window.HaxStore.guessGizmo(o,r,i);if(l.length>0){var u=e.tagName.toLowerCase(),m=u.replace("-"," ");"undefined"!==h(window.HaxStore.instance.elementList[u])&&!1!==window.HaxStore.instance.elementList[u].gizmo&&(m=window.HaxStore.instance.elementList[u].gizmo.title),t||(window.HaxStore.instance.activePlaceHolder=this.activeNode,window.HaxStore.instance.haxAppPicker.presentOptions(l,"__convert","Transform ".concat(m," to.."),"gizmo"))}else t||window.HaxStore.toast("Sorry, this can not be transformed!",5e3);return l}},{key:"_globalPreferencesUpdated",value:function(e,t){"undefined"!==h(e)&&null!=e&&(this.haxRayMode=e.haxRayMode)}},{key:"_haxStorePropertyUpdated",value:function(e){e.detail&&"undefined"!==h(e.detail.value)&&e.detail.property&&(this[e.detail.property]=e.detail.value)}},{key:"haxClearBody",value:function(){var e=!0;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(e=prompt("Are you sure you want to delete all content?")),e&&a.wipeSlot(this)}},{key:"haxInsert",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.__activeHover=null;var i=document.createElement(e);i.innerHTML=t;var a=i.cloneNode(!0);for(var r in o){var s=window.HaxStore.camelToDash(r);o.hasOwnProperty(r)&&(!0===o[r]?a.setAttribute(s,s):!1===o[r]?a.removeAttribute(s):null!=o[r]&&o[r].constructor===Array?a.properties&&a.properties[r].readOnly||(a.set?a.set(s,o[r]):a[s]=o[r]):null!=o[r]&&o[r].constructor===Object?a.properties&&a.properties[r].readOnly||(a.set?a.set(s,o[r]):a[s]=o[r]):a.setAttribute(s,o[r]))}return null!==window.HaxStore.instance.activePlaceHolder&&"undefined"!==h(window.HaxStore.instance.activePlaceHolder.style)?(a.style.width=window.HaxStore.instance.activePlaceHolder.style.width,a.style.float=window.HaxStore.instance.activePlaceHolder.style.float,a.style.margin=window.HaxStore.instance.activePlaceHolder.style.margin,a.style.display=window.HaxStore.instance.activePlaceHolder.style.display,this.haxReplaceNode(window.HaxStore.instance.activePlaceHolder,a),window.HaxStore.instance.activePlaceHolder=null):null!=this.activeContainerNode?"GRID-PLATE"===this.activeContainerNode.tagName&&this.activeContainerNode!==this.activeNode?(null!=this.activeNode.getAttribute("slot")&&a.setAttribute("slot",this.activeNode.getAttribute("slot")),this.activeNode.parentNode==this.activeContainerNode?this.activeContainerNode.insertBefore(a,this.activeNode):this.activeContainerNode.appendChild(a)):this.activeContainerNode&&this.activeContainerNode.nextElementSibling?this.activeContainerNode.nextElementSibling.parentNode.insertBefore(a,this.activeContainerNode.nextElementSibling):this.activeNode.parentNode?this.activeNode.parentNode.insertBefore(a,this.activeNode):this.appendChild(a):this.appendChild(a),this.shadowRoot.querySelector("#textcontextmenu").highlightOps=!1,this.activeContainerNode=a.parentNode,this.activeNode=a,window.HaxStore.write("activeContainerNode",a.parentNode,this),window.HaxStore.write("activeNode",a,this),setTimeout(function(){n.scrollHere(a),n.positionContextMenus()},10),!0}},{key:"haxToContent",value:function(){this.hideContextMenus();var e=this.activeNode;this.activeNode=null,this.activeContainerNode=null,window.HaxStore.write("activeNode",null,this),window.HaxStore.write("activeContainerNode",null,this);for(var t="slot"===this.shadowRoot.querySelector("#body").localName?this.shadowRoot.querySelector("#body").assignedNodes({flatten:!0}):[],n="",o=0,i=t.length;o<i;o++)this._validElementTest(t[o])?(t[o].removeAttribute("data-editable"),t[o].removeAttribute("data-hax-ray"),t[o].classList.remove("hax-mover","hax-moving","hax-hovered","grid-plate-active-item"),t[o].contentEditable=!1,n+=window.HaxStore.nodeToContent(t[o]),"grid-plate"===t[o].tagName.toLowerCase()&&this._applyContentEditable(this.editMode,t[o])):8===t[o].nodeType?n+="\x3c!-- "+t[o].textContent+" --\x3e":1!==t[o].nodeType&&"undefined"!==h(t[o].textContent)&&"undefined"!==t[o].textContent&&(n+=t[o].textContent);if(n=(n=(n=(n=(n=(n=(n=(n=n.replace(/\scontenteditable=\"false\"/g,"")).replace(/\sdata-editable=\"true\"/g,"")).replace(/\sdata-editable=\"false\"/g,"")).replace(/\sdata-editable=\""/g,"")).replace(/\sdata-editable/g,"")).replace(/\scontenteditable/g,"")).replace(/\sdraggable/g,"")).replace(/\sdata-hax-ray=\".*?\"/g,""),this.parentNode.tagName){var r=this.parentNode.tagName.toLowerCase(),s="style-scope "+r+" x-scope",c=new RegExp(s,"g");n=n.replace(c,""),s="style-scope "+r,c=new RegExp(s,"g"),n=n.replace(c,""),s="x-scope "+r+"-0",c=new RegExp(s,"g"),n=n.replace(c,"");var d=window.HaxStore.instance.validTagList;for(var o in d)s="style-scope "+d[o],c=new RegExp(s,"g"),n=n.replace(c,""),s="x-scope "+d[o]+"-0 ",c=new RegExp(s,"g"),n=n.replace(c,""),s="x-scope "+d[o]+"-0",c=new RegExp(s,"g"),n=n.replace(c,"")}return n=(n=n.replace(/\sclass=\"\"/g,"")).replace(/\sclass=\"\s\"/g,""),this._applyContentEditable(this.editMode),window.HaxStore.write("activeNode",e,this),window.HaxStore.write("activeContainerNode",e,this),n=a.encapScript(n)}},{key:"haxDuplicateNode",value:function(e){var t=this;this.hideContextMenus(!1);var n=e.parentNode,o=a.nodeToHaxElement(e,null),i=window.HaxStore.instance.elementList[e.tagName.toLowerCase()];if("undefined"!==h(i)&&"undefined"!==h(i.saveOptions.unsetAttributes))for(var r in i.saveOptions.unsetAttributes)o.properties[i.saveOptions.unsetAttributes[r]]&&delete o.properties[i.saveOptions.unsetAttributes[r]];"undefined"!==h(e.preProcessHaxInsertContent)&&(o=e.preProcessHaxInsertContent(o)),o.content==o.properties.innerHTML&&delete o.properties.innerHTML;var s=a.haxElementToNode({tag:o.tag,content:o.content,properties:o.properties});return"webview"===s.tagName.toLowerCase()&&window.HaxStore.instance._isSandboxed&&"undefined"!==h(s.guestinstance)&&delete s.guestinstance,null!==e?n.insertBefore(s,e.nextSibling):n.appendChild(s),setTimeout(function(){n===t&&window.HaxStore.write("activeContainerNode",s,t),window.HaxStore.write("activeNode",s,t)},100),!0}},{key:"hideContextMenus",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];clearTimeout(j),clearTimeout(this.__keyPress),clearTimeout(this.__contextVisibleLock),clearTimeout(this.__positionContextTimer),this._hideContextMenu(this.shadowRoot.querySelector("#textcontextmenu")),this._hideContextMenu(this.shadowRoot.querySelector("#cecontextmenu")),e&&this._hideContextMenu(this.shadowRoot.querySelector("#platecontextmenu")),this.shadowRoot.querySelector("#textcontextmenu").highlightOps=!1}},{key:"positionContextMenus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.activeNode,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.activeNode;clearTimeout(this.__positionContextTimer),this.__positionContextTimer=setTimeout(function(){if(t&&!window.HaxStore.instance._lockContextPosition&&e.__ready){var o=140,i=t.tagName.toLowerCase();window.HaxStore.instance._isSandboxed&&"webview"===i&&(i="iframe");var a=window.HaxStore.instance.elementList[i];if("undefined"===h(a)||window.HaxStore.instance.isTextElement(t))e._hideContextMenu(e.shadowRoot.querySelector("#cecontextmenu")),e._positionContextMenu(e.shadowRoot.querySelector("#textcontextmenu"),n,-1,-30),o+=e.shadowRoot.querySelector("#textcontextmenu").getBoundingClientRect().width;else e._hideContextMenu(e.shadowRoot.querySelector("#textcontextmenu")),a.element=t,e._positionContextMenu(e.shadowRoot.querySelector("#cecontextmenu"),n,-1,-30),o+=28;if(n){var r=n.getBoundingClientRect();Math.round(o)>=Math.round(r.width)?e._positionContextMenu(e.shadowRoot.querySelector("#platecontextmenu"),n,-1,-58):e._positionContextMenu(e.shadowRoot.querySelector("#platecontextmenu"),n,r.width-e.shadowRoot.querySelector("#platecontextmenu").getBoundingClientRect().width+2,-28)}n&&!window.HaxStore.instance.isTextElement(t)&&t!==n?n.removeAttribute("contenteditable"):n&&n.setAttribute("contenteditable",!0)}},10)}},{key:"haxMoveGridPlate",value:function(e,t,n){var o=this;switch(this.___moveLock=!0,e){case"first":null!==n.previousElementSibling&&this.insertBefore(n,this.firstChild);break;case"up":null!==n.previousElementSibling&&this.insertBefore(n,n.previousElementSibling);break;case"down":null!==n.nextElementSibling&&this.insertBefore(n.nextElementSibling,n);break;case"last":null!==n.nextElementSibling&&this.appendChild(n)}return setTimeout(function(){o.scrollHere(t),o.positionContextMenus(t,t)},10),!0}},{key:"haxGridPlateOps",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(t,n){var o,i,a,r,s,c,d,l,u=this,h=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=!(h.length>2&&void 0!==h[2])||h[2],i=!1,"GRID-PLATE"!==t.tagName){e.next=51;break}if(!o){e.next=24;break}e.t0=t.layout,e.next="1"===e.t0?7:"1-1"===e.t0?10:"1-1-1"===e.t0?13:"1-1-1-1"===e.t0?16:"1-1-1-1-1"===e.t0?19:22;break;case 7:return t.layout="1-1",i=!0,e.abrupt("break",22);case 10:return t.layout="1-1-1",i=!0,e.abrupt("break",22);case 13:return t.layout="1-1-1-1",i=!0,e.abrupt("break",22);case 16:return t.layout="1-1-1-1-1",i=!0,e.abrupt("break",22);case 19:return t.layout="1-1-1-1-1-1",i=!0,e.abrupt("break",22);case 22:e.next=48;break;case 24:e.t1=t.layout,e.next="1-1"===e.t1?27:"1-1-1"===e.t1?36:"1-1-1-1"===e.t1?39:"1-1-1-1-1"===e.t1?42:"1-1-1-1-1-1"===e.t1?45:48;break;case 27:return e.next=29,t.childNodes.forEach(function(e){e.tagName&&((a=e.cloneNode(!0)).removeAttribute("slot"),a.classList.remove("hax-mover"),a.classList.remove("hax-moving"),t.parentNode.insertBefore(a,t))});case 29:return this.activeNode=a,this.activeContainerNode=a,window.HaxStore.write("activeNode",a,this),window.HaxStore.write("activeContainerNode",a,this),setTimeout(function(){t.remove()},0),i=!0,e.abrupt("break",48);case 36:return t.layout="1-1",i=!0,e.abrupt("break",48);case 39:return t.layout="1-1-1",i=!0,e.abrupt("break",48);case 42:return t.layout="1-1-1-1",i=!0,e.abrupt("break",48);case 45:return t.layout="1-1-1-1-1",i=!0,e.abrupt("break",48);case 48:i&&(r=this.shadowRoot.querySelector("#platecontextmenu"),s=r.shadowRoot.querySelector("#right"),c=r.shadowRoot.querySelector("#rightremove"),s.disabled=!1,c.disabled=!1,"1-1-1-1-1-1"==t.layout&&(s.disabled=!0),"left"==n&&t.childNodes.forEach(function(e){if(e.tagName){var t=parseInt(e.getAttribute("slot").replace("col-",""),10)+1;e.setAttribute("slot","col-".concat(t))}})),e.next=58;break;case 51:(d=document.createElement("grid-plate")).layout="1-1",d.disableResponsive=!0,t.parentNode.insertBefore(d,t),l="2","right"==n&&(l="1"),setTimeout(function(){d.appendChild(t),u.activeContainerNode=d,window.HaxStore.write("activeContainerNode",d,u),t.setAttribute("slot","col-"+l)},0);case 58:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(o,i){var a=e.apply(t,n);function r(e){m(a,o,i,r,s,"next",e)}function s(e){m(a,o,i,r,s,"throw",e)}r(void 0)})});return function(e,n){return t.apply(this,arguments)}}()},{key:"haxReplaceNode",value:function(e,t){try{null==e&&(e=this.__oldActiveNode),e.replaceWith(t),e&&e.getAttribute&&null!=e.getAttribute("slot")&&t.setAttribute("slot",e.getAttribute("slot"))}catch(e){console.warn(e)}return t}},{key:"haxChangeTagName",value:function(e,t){for(var n=document.createElement(t),o=0,i=e.attributes.length;o<i;++o){var a=e.attributes.item(o).nodeName,r=e.attributes.item(o).value;n.setAttribute(a,r)}n.innerHTML=e.innerHTML.trim(),"ul"==t||"ol"==t?""==n.innerHTML?n.innerHTML="<li></li>":"ul"!=e.tagName.toLowerCase()&&"ol"!=e.tagName.toLowerCase()&&(n.innerHTML="<li>"+e.innerHTML.trim().replace(/<br\/>/g,"</li>\n<li>").replace(/<br>/g,"</li>\n<li>")+"</li>"):"ul"!=e.tagName.toLowerCase()&&"ol"!=e.tagName.toLowerCase()||(n.innerHTML=n.innerHTML.replace(/<ul>/g,"").replace(/<\/ul>/g,"").replace(/<li><\/li>/g,"").replace(/<li>/g,"").replace(/<\/li>/g,"<br/>"));try{e.replaceWith(n),setTimeout(function(){var e=n.children;e[0]&&e.tagName?e[0].focus():n.focus()},50)}catch(t){console.warn(t),console.warn(n),console.warn(e)}return n}},{key:"haxDeleteNode",value:function(e){this.hideContextMenus(),this.activeNode=null,this.activeContainerNode=null,window.HaxStore.write("activeNode",null,this),window.HaxStore.write("activeContainerNode",null,this);try{return e.remove()}catch(e){console.warn(e)}}},{key:"importContent",value:function(e){var t=this;(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&a.wipeSlot(this,"*"),setTimeout(function(){e=a.encapScript(e);var n=document.createElement("div");for(n.insertAdjacentHTML("beforeend",e);null!==n.firstChild;)if("undefined"!==h(n.firstChild.tagName))if(window.HaxStore.instance._isSandboxed&&"iframe"===n.firstChild.tagName.toLowerCase()){for(var o=document.createElement("webview"),i=0,r=n.firstChild.attributes.length;i<r;++i){var s=n.firstChild.attributes.item(i).nodeName,c=n.firstChild.attributes.item(i).value;"height"!==s&&"width"!==s||o.style[s],o.setAttribute(s,c)}t.appendChild(o)}else t.appendChild(n.firstChild);else n.removeChild(n.firstChild)},50)}},{key:"_haxContextOperation",value:function(e){var t=this,n=e.detail;switch(n.eventName){case"text-tag":this.shadowRoot.querySelector("#textcontextmenu").realSelectedValue=n.value,this.activeNode=this.haxChangeTagName(this.activeNode,n.value),window.HaxStore.write("activeNode",this.activeNode,this),setTimeout(function(){t.positionContextMenus()},100);break;case"text-tag-ul":this.shadowRoot.querySelector("#textcontextmenu").realSelectedValue="ul",this.activeNode=this.haxChangeTagName(this.activeNode,"ul"),window.HaxStore.write("activeNode",this.activeNode,this),setTimeout(function(){t.positionContextMenus()},100);break;case"text-tag-ol":this.shadowRoot.querySelector("#textcontextmenu").realSelectedValue="ol",this.activeNode=this.haxChangeTagName(this.activeNode,"ol"),window.HaxStore.write("activeNode",this.activeNode,this),this.positionContextMenus();break;case"hax-plate-add-element":if("other"==n.value)return window.HaxStore.instance.haxInsertAnything({}),!0;var o=JSON.parse(n.value);if(this.haxInsert(o.tag,o.content,o.properties,!1),window.HaxStore.instance.isTextElement(o))try{var i=document.createRange(),a=window.HaxStore.getSelection();i.setStart(this.activeNode,0),i.collapse(!0),a.removeAllRanges(),a.addRange(i),this.activeNode.focus(),this.activeContainerNode=this.activeNode,window.HaxStore.write("activeContainerNode",this.activeContainerNode,this)}catch(e){console.warn(e)}break;case"text-align-left":this.activeNode.style.textAlign=null;break;case"hax-transform-node":this.replaceElementWorkflow();break;case"hax-plate-create-right":"HAX-BODY"===this.activeContainerNode.tagName?this.haxGridPlateOps(this.activeNode,"right"):this.haxGridPlateOps(this.activeContainerNode,"right");break;case"hax-plate-remove-right":"HAX-BODY"===this.activeContainerNode.tagName?this.haxGridPlateOps(this.activeNode,"right",!1):this.haxGridPlateOps(this.activeContainerNode,"right",!1);break;case"hax-plate-duplicate":this.haxDuplicateNode(this.activeNode);break;case"hax-plate-delete":null!=this.activeNode&&(this.activeNode!==this.activeContainerNode?this.haxDeleteNode(this.activeNode,this.activeContainerNode):this.haxDeleteNode(this.activeNode),window.HaxStore.toast("Element deleted",2e3));break;case"hax-plate-first":this.haxMoveGridPlate("first",this.activeNode,this.activeContainerNode);break;case"hax-plate-up":this.haxMoveGridPlate("up",this.activeNode,this.activeContainerNode);break;case"hax-plate-down":this.haxMoveGridPlate("down",this.activeNode,this.activeContainerNode);break;case"hax-plate-last":this.haxMoveGridPlate("last",this.activeNode,this.activeContainerNode);break;case"close-menu":this.activeNode=null,this.activeContainerNode=null,window.HaxStore.write("activeNode",null,this),window.HaxStore.write("activeContainerNode",null,this)}}},{key:"_focusIn",value:function(e){this.__mouseDown||this.__focusLogic(e.target)&&(e.stopPropagation(),e.stopImmediatePropagation())}},{key:"__focusLogic",value:function(e){var t=this,n=!1;if(this.openDrawer||!this.editMode||this.__tabTrap)this.__tabTrap=!1;else{var o=e;"SPAN"===o.tagName&&window.HaxStore.instance.isTextElement(o.parentNode)&&""==o.parentNode.getAttribute("slot")&&(o=e.parentNode);var i=null;if(this._validElementTest(o)&&o.parentNode&&o.parentNode.tagName){if("P"===o.parentNode.tagName&&""==o.parentNode.getAttribute("slot"))i=o,n=!0;else{for(;o.parentNode.tagName&&"HAX-BODY"!=o.parentNode.tagName;)null===i&&"LI"!==o.tagName&&"B"!==o.tagName&&"I"!==o.tagName&&"STRONG"!==o.tagName&&"EM"!==o.tagName&&(i=o),o=o.parentNode;null===i?i=o:window.HaxStore.instance.isGridPlateElement(o)||(i=o)}this.activeContainerNode===o||o.classList.contains("ignore-activation")?o.classList.contains("ignore-activation")&&(n=!0):(this.activeContainerNode=o,window.HaxStore.write("activeContainerNode",o,this),n=!0),this.activeNode===i||i.classList.contains("ignore-activation")||(this.activeNode=i,window.HaxStore.write("activeNode",i,this),setTimeout(function(){if(!t.__mouseDown&&window.HaxStore.instance.isTextElement(i))try{var e=document.createRange(),n=window.HaxStore.getSelection();e.setStart(t.activeNode,0),e.collapse(!0),n.removeAllRanges(),n.addRange(e),t.activeNode.focus()}catch(e){console.warn(e)}t.positionContextMenus(i,i)},0),n=!0)}}return n}},{key:"scrollHere",value:function(e){"function"==typeof e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded(!0):e.scrollIntoView({behavior:"smooth",inline:"center"})}},{key:"undo",value:function(){var e=this;k(w(n.prototype),"undo",this).call(this),setTimeout(function(){var t=e.querySelector(".hax-active");t?(e.__focusLogic(t),e.scrollHere(t)):e.hideContextMenus()},0)}},{key:"redo",value:function(){var e=this;k(w(n.prototype),"redo",this).call(this),setTimeout(function(){var t=e.querySelector(".hax-active");t?(e.__focusLogic(t),e.scrollHere(t)):e.hideContextMenus()},0)}},{key:"_editModeChanged",value:function(e,t){var n=this;"undefined"!==h(t)&&(this._applyContentEditable(e),e&&(this.children&&this.children[0]&&this.children[0].focus?this.__focusLogic(this.children[0]):(this.haxInsert("p","",{},!1),setTimeout(function(){try{var e=document.createRange(),t=window.HaxStore.getSelection();e.setStart(n.activeNode,0),e.collapse(!0),t.removeAllRanges(),t.addRange(e),n.activeNode.focus(),n.activeContainerNode=n.activeNode,window.HaxStore.write("activeContainerNode",n.activeContainerNode,n)}catch(e){console.warn(e)}n.positionContextMenus()},0))),setTimeout(function(){n.undoStack=new u.Undo,n.undoStack.changed=function(e){n.canRedo=n.undoStack.canRedo(),n.canUndo=n.undoStack.canUndo()},n.undoStack.changed(),n.undoStackInitialValue=n.innerHTML},0)),0==e&&(this.removeAttribute("contenteditable"),this.hideContextMenus())}},{key:"_haxResolvePreviousElement",value:function(e){for(e=e.previousElementSibling;null!=e&&"undefined"!==h(e.tagName)&&"HAX-"===e.tagName.substring(0,4);)e=e.previousElementSibling;return e}},{key:"_validElementTest",value:function(e){return"undefined"!==h(e.tagName)&&("HAX-"!==e.tagName.substring(0,4)||"HAX-LOGO"===e.tagName||"FAKE-HAX-BODY-END"!==e.tagName)}},{key:"_HTMLPrimativeTest",value:function(e){return null!=e&&"undefined"!==h(e.tagName)&&-1==e.tagName.indexOf("-")}},{key:"_applyContentEditable",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.shadowRoot.querySelector("#body"),n="slot"===t.localName?t.assignedNodes({flatten:!0}):[];0===n.length&&(n=t.children);for(var o=0,i=n.length;o<i;o++)this._validElementTest(n[o])&&(!e||!0!==n[o].getAttribute("contenteditable")&&"true"!=n[o].getAttribute("contenteditable")&&"contenteditable"!=n[o].getAttribute("contenteditable"))&&this.__applyNodeEditableState(n[o],e)}},{key:"__applyNodeEditableState",value:function(e){var t,n=this,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=e.tagName.replace("-"," ").toLowerCase(),a=window.HaxStore.instance.gizmoList.findIndex(function(t){if(t)return t.tag===e.tagName.toLowerCase()});if(-1!==a&&(i=window.HaxStore.instance.gizmoList[a].title),o?(e.setAttribute("data-editable",o),e.setAttribute("data-hax-ray",i),t="addEventListener"):(e.removeAttribute("data-editable"),e.removeAttribute("data-hax-ray"),t="removeEventListener"),e[t]("drop",this.dropEvent.bind(this)),e[t]("dragenter",this.dragEnter.bind(this)),e[t]("dragleave",this.dragLeave.bind(this)),e[t]("dragover",function(e){n.__mouseMoving=!0,e.preventDefault()}),this._HTMLPrimativeTest(e)&&(o?e.setAttribute("contenteditable",o):e.removeAttribute("contenteditable"),e.querySelectorAll("a").length>0))for(var r=e.querySelectorAll("a"),s=0,c=r.length;s<c;s++)o?(r[s].setAttribute("contenteditable",o),r[s].setAttribute("data-editable",o)):(r[s].removeAttribute("contenteditable"),r[s].removeAttribute("data-editable")),r[s][t]("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()})}},{key:"undoManagerStackLogic",value:function(e){if(!this.__mouseMoving){var t=this.querySelectorAll(".hax-mover, .hax-hovered, .hax-moving, .grid-plate-active-item");for(var o in t)if("undefined"!==h(t[o].classList)&&(t[o].classList.remove("hax-mover","hax-hovered","hax-moving","grid-plate-active-item"),"GRID-PLATE"===t[o].tagName)){for(var i in t[o].children)"undefined"!==h(t[o].children[i].classList)&&t[o].children[i].classList.remove("hax-mover","hax-hovered","hax-moving","grid-plate-active-item");for(i=1;i<=t[o].columns;i++)void 0!==t[o].shadowRoot.querySelector("#col"+i)&&t[o].shadowRoot.querySelector("#col"+i).classList.remove("hax-mover")}k(w(n.prototype),"undoManagerStackLogic",this).call(this,e)}}},{key:"dropEvent",value:function(e){var t=this;if(!this.openDrawer&&this.editMode){this.__mouseMoving=!1,this.undoManagerStackLogic({}),clearTimeout(j),window.HaxStore.instance._lockContextPosition=!1,window.HaxStore.instance.haxTray.activeTab="item-1";var n=null;n=e.path&&e.path[0]?e.path[0]:e.originalTarget?e.originalTarget:e.target,this.activeNode=n,window.HaxStore.write("activeNode",n,this),n.parentNode&&"GRID-PLATE"===n.parentNode.tagName?(this.activeContainerNode=n.parentNode,window.HaxStore.write("activeContainerNode",n.parentNode,this)):(this.activeContainerNode=n.parentNode,window.HaxStore.write("activeContainerNode",n,this));var o=this.querySelectorAll(".hax-mover, .hax-hovered, .hax-moving, .grid-plate-active-item");for(var i in o)if("undefined"!==h(o[i].classList)&&(o[i].classList.remove("hax-mover","hax-hovered","hax-moving","grid-plate-active-item"),"GRID-PLATE"===o[i].tagName)){for(var a in o[i].dropEvent(e),o[i].children)"undefined"!==h(o[i].children[a].classList)&&o[i].children[a].classList.remove("hax-mover","hax-hovered","hax-moving","grid-plate-active-item");for(a=1;a<=o[i].columns;a++)void 0!==o[i].shadowRoot.querySelector("#col"+a)&&o[i].shadowRoot.querySelector("#col"+a).classList.remove("hax-mover")}try{if(e.dataTransfer&&e.dataTransfer.items&&e.dataTransfer.items.length>0&&"file"===e.dataTransfer.items[0].kind){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var r=document.createElement("p");this.activeNode.parentNode.insertBefore(r,this.activeNode),e.placeHolderElement=r,this.dispatchEvent(new CustomEvent("place-holder-file-drop",{bubbles:!0,cancelable:!0,composed:!0,detail:e}))}else{n=window.HaxStore.instance.__dragTarget;var s=e.target;if(n&&null!=n&&"function"==typeof n.removeAttribute&&"undefined"!==h(s)&&n!==s&&n!==s.parentNode&&n.parentNode===this||s.parentNode===this){try{n.removeAttribute("slot"),s.parentNode.insertBefore(n,s)}catch(e){console.warn(e)}e.preventDefault(),e.stopPropagation()}n&&"function"==typeof n.focus&&(this.activeNode=n,this.activeNode&&this.activeNode.parentNode&&"GRID-PLATE"===this.activeNode.parentNode.tagName?this.activeContainerNode=this.activeNode.parentNode:this.activeContainerNode=this.activeNode,window.HaxStore.write("activeNode",this.activeNode,this),window.HaxStore.write("activeContainerNode",this.activeContainerNode,this),this.dispatchEvent(new CustomEvent("hax-drop-focus-event",{bubbles:!0,cancelable:!0,composed:!0,detail:this.activeNode})),setTimeout(function(){t.scrollHere(t.activeNode),t.positionContextMenus()},50))}}catch(e){console.warn(e)}}window.HaxStore.instance.__dragTarget=null,this.__manageFakeEndCap(!1)}},{key:"dragEnter",value:function(e){!this.openDrawer&&this.editMode&&e.target&&(this.__mouseMoving=!0,e.preventDefault(),e.target&&e.target.classList&&e.target.classList.add("hax-hovered"),this.handleMousemove(e))}},{key:"handleMousemove",value:function(e){var t=e.clientX,n=e.clientY,o=document.documentElement.clientWidth,i=document.documentElement.clientHeight,a=B,r=B,s=i-B,c=o-B,d=t<r,l=t>c,u=n<a,h=n>s;if(d||l||u||h){var m=Math.max(document.body.scrollWidth,document.body.offsetWidth,document.body.clientWidth,document.documentElement.scrollWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth),p=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.body.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight),v=m-o,x=p-i;!function e(){clearTimeout(j),function(){var e=window.pageXOffset,o=window.pageYOffset,i=o>0,m=o<x,p=e>0,f=e<v,b=e,g=o;if(d&&p){var y=(r-t)/B;b-=I*y}else if(l&&f){var y=(t-c)/B;b+=I*y}if(u&&i){var y=(a-n)/B;g-=I*y}else if(h&&m){var y=(n-s)/B;g+=I*y}return b=Math.max(0,Math.min(v,b)),g=Math.max(0,Math.min(x,g)),(b!==e||g!==o)&&(window.scrollTo(b,g),!0)}()&&(j=setTimeout(e,30))}()}else clearTimeout(j)}},{key:"dragLeave",value:function(e){!this.openDrawer&&this.editMode&&e.target&&e.target.classList&&(this.__mouseMoving=!0,e.target.classList.remove("hax-hovered"))}},{key:"_activeContainerNodeChanged",value:function(e,t){this.editMode&&"undefined"!==h(e)&&null!=e&&null!=e.tagName&&(window.HaxStore.instance.isTextElement(e)||window.HaxStore.instance.isGridPlateElement(e)?(e.setAttribute("contenteditable",!0),this.setAttribute("contenteditable",!0)):(e.removeAttribute("contenteditable"),this.removeAttribute("contenteditable")),t&&"GRID-PLATE"==t.tagName&&(t.activeItem=null),"grid-plate"===e.tagName.toLowerCase()&&(e.editMode=this.editMode,this._applyContentEditable(this.editMode,e)))}},{key:"_activeNodeChanged",value:function(e,t){if(this.querySelectorAll(".hax-active").forEach(function(e){e.classList.remove("hax-active")}),this.editMode&&"undefined"!==h(e)&&null!==e&&e.parentNode){var n=e.tagName.toLowerCase();setTimeout(function(){e.classList.add("hax-active")},0),window.HaxStore.instance.isTextElement(e)||window.HaxStore.instance.isGridPlateElement(e)?(e.setAttribute("contenteditable",!0),this.setAttribute("contenteditable",!0)):(e.removeAttribute("contenteditable"),this.removeAttribute("contenteditable")),this.positionContextMenus(),this.shadowRoot.querySelector("#textcontextmenu").realSelectedValue=n}else null===e&&(this.hideContextMenus(),this.__oldActiveNode=t)}},{key:"_getPosition",value:function(e){return{x:e.offsetLeft-e.scrollLeft+e.clientLeft,y:e.offsetTop-e.scrollTop+e.clientTop}}},{key:"_positionContextMenu",value:function(e,t,n,o){if(null!=t){var i=this._getPosition(t);e.style.left=null!=n?i.x+n+"px":i.x+"px",e.style.top=null!=o?i.y+o+"px":i.y+"px"}e.setAttribute("on-screen","on-screen"),e.classList.add("hax-context-visible"),this.__activeHover&&(e.classList.add("hax-active-hover"),e.style.marginLeft="",this.__typeLock=!1)}},{key:"_hideContextMenu",value:function(e){e.removeAttribute("on-screen"),e.classList.remove("hax-context-visible","hax-active-hover","hax-context-pin-top")}},{key:"_tabKeyPressed",value:function(){var e=!1,t=this.activeContainerNode,n=this.activeContainerNode.tagName;if(window.HaxStore.getRange().cloneRange)try{var o=window.HaxStore.getRange().cloneRange(),i=o.commonAncestorContainer.tagName;if("undefined"===h(i)&&(i=o.commonAncestorContainer.parentNode.tagName),["UL","OL","LI"].includes(n)||["UL","OL","LI"].includes(i))this.polyfillSafe&&(document.execCommand("indent"),this.__tabTrap=!0);else for(;!e;)null==t.nextSibling?e=!0:"function"===t.nextSibling.focus?(t.nextSibling.focus(),e=!0):t=t.nextSibling}catch(e){console.warn(e)}}},{key:"_tabBackKeyPressed",value:function(){var e=this.activeContainerNode,t=this.activeContainerNode.tagName;if(window.HaxStore.getRange().cloneRange)try{var n=window.HaxStore.getRange().cloneRange(),o=n.commonAncestorContainer.tagName;if("undefined"===h(o)&&(o=n.commonAncestorContainer.parentNode.tagName),["UL","OL","LI"].includes(t)||["UL","OL","LI"].includes(o))this.polyfillSafe&&(document.execCommand("outdent"),this.__tabTrap=!0);else{if(null!=e)for(;null!=e&&!this._validElementTest(e);)e=e.previousSibling;null!=e&&setTimeout(function(){e.focus()},50)}}catch(e){console.warn(e)}}}],[{key:"tag",get:function(){return"hax-body"}},{key:"properties",get:function(){return g(g({},k(w(n),"properties",this)),{},{openDrawer:{type:Object},haxSelectedText:{type:String},editMode:{type:Boolean,reflect:!0,attribute:"edit-mode"},haxRayMode:{type:Boolean,reflect:!0,attribute:"hax-ray-mode"},globalPreferences:{type:Object},activeNode:{type:Object},activeContainerNode:{type:Object}})}}]),n}();window.customElements.define(z.tag,z),e.HaxBody=z,Object.defineProperty(e,"__esModule",{value:!0})});
