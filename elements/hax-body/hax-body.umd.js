!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@lrnwebcomponents/grid-plate/grid-plate.js"),require("@lrnwebcomponents/hax-body/lib/hax-context-item.js"),require("@lrnwebcomponents/hax-body/lib/hax-context-item-menu.js"),require("@polymer/paper-item/paper-item.js"),require("@lrnwebcomponents/utils/utils.js"),require("@lrnwebcomponents/simple-popover/lib/SimpleTourFinder"),require("@lrnwebcomponents/media-behaviors/media-behaviors.js"),require("@lrnwebcomponents/simple-toast/simple-toast.js"),require("@polymer/polymer/lib/utils/settings.js"),require("@lrnwebcomponents/hal-9000/hal-9000.js"),require("@polymer/iron-ajax/iron-ajax.js"),require("lit-element/lit-element.js"),require("@lrnwebcomponents/simple-popover/lib/simple-tour.js"),require("@lrnwebcomponents/hax-body-behaviors/hax-body-behaviors.js"),require("@lrnwebcomponents/hax-body/lib/hax-toolbar.js"),require("@polymer/iron-icon/iron-icon.js"),require("@lrnwebcomponents/hax-body/lib/hax-context-item-textop.js"),require("@lrnwebcomponents/simple-popover/lib/simple-popover-selection.js"),require("@lrnwebcomponents/simple-colors/simple-colors.js"),require("@lrnwebcomponents/undo-manager/undo-manager.js")):"function"==typeof define&&define.amd?define(["exports","@lrnwebcomponents/grid-plate/grid-plate.js","@lrnwebcomponents/hax-body/lib/hax-context-item.js","@lrnwebcomponents/hax-body/lib/hax-context-item-menu.js","@polymer/paper-item/paper-item.js","@lrnwebcomponents/utils/utils.js","@lrnwebcomponents/simple-popover/lib/SimpleTourFinder","@lrnwebcomponents/media-behaviors/media-behaviors.js","@lrnwebcomponents/simple-toast/simple-toast.js","@polymer/polymer/lib/utils/settings.js","@lrnwebcomponents/hal-9000/hal-9000.js","@polymer/iron-ajax/iron-ajax.js","lit-element/lit-element.js","@lrnwebcomponents/simple-popover/lib/simple-tour.js","@lrnwebcomponents/hax-body-behaviors/hax-body-behaviors.js","@lrnwebcomponents/hax-body/lib/hax-toolbar.js","@polymer/iron-icon/iron-icon.js","@lrnwebcomponents/hax-body/lib/hax-context-item-textop.js","@lrnwebcomponents/simple-popover/lib/simple-popover-selection.js","@lrnwebcomponents/simple-colors/simple-colors.js","@lrnwebcomponents/undo-manager/undo-manager.js"],t):t((e=e||self).HaxBody={},null,null,null,null,e.utils_js,e.SimpleTourFinder,null,e.$$3,e.$$2,e.$$1,e.$$0,e.litElement_js,e.simpleTour_js,e.haxBodyBehaviors_js,null,null,null,null,e.simpleColors_js,e.undoManager_js)}(this,function(e,t,n,o,i,a,r,s,l,c,d,u,h,p,m,v,x,g,f,b,y){"use strict";function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(e,t,n,o,i,a,r){try{var s=e[a](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,i)}function _(e){return function(){var t=this,n=arguments;return new Promise(function(o,i){var a=e.apply(t,n);function r(e){N(a,o,i,r,s,"next",e)}function s(e){N(a,o,i,r,s,"throw",e)}r(void 0)})}}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function T(e,t,n){return t&&S(e.prototype,t),n&&S(e,n),e}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach(function(t){C(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function A(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function H(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function O(e,t,n){return(O=H()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var i=new(Function.bind.apply(e,o));return n&&R(i,n.prototype),i}).apply(null,arguments)}function M(e){var t="function"==typeof Map?new Map:void 0;return(M=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,o)}function o(){return O(e,arguments,P(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),R(o,e)})(e)}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e){var t=H();return function(){var n,o,i,a=P(e);if(t){var r=P(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return o=this,!(i=n)||"object"!=typeof i&&"function"!=typeof i?q(o):i}}function D(e,t,n){return(D="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function I(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function B(e){return function(e){if(Array.isArray(e))return z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return z(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var U=function(e){A(n,M(HTMLElement));var t=j(n);function n(){var e;return k(this,n),(e=t.call(this)).eventName="hax-register-app",e}return T(n,[{key:"connectedCallback",value:function(){"undefined"!==w(this.data)&&("string"==typeof this.data&&(this.data=JSON.parse(this.data)),this.dispatchEvent(new CustomEvent(this.eventName,{bubbles:!0,composed:!0,cancelable:!1,detail:this.data})))}}],[{key:"tag",get:function(){return"hax-app"}}]),n}();window.customElements.define(U.tag,U);var G=function(e){A(n,U);var t=j(n);function n(){var e;return k(this,n),(e=t.call(this)).eventName="hax-register-blox",e}return T(n,null,[{key:"tag",get:function(){return"hax-blox"}}]),n}();window.customElements.define(G.tag,G);var V=function(e){A(n,U);var t=j(n);function n(){var e;return k(this,n),(e=t.call(this)).eventName="hax-register-stax",e}return T(n,null,[{key:"tag",get:function(){return"hax-stax"}}]),n}();function X(){var e=I(['\n      <slot></slot>\n      <iron-ajax\n        id="appstore"\n        url="','"\n        .params="','"\n        method="GET"\n        content-type="application/json"\n        handle-as="json"\n        @last-response-changed="','"\n      ></iron-ajax>\n      <hal-9000\n        id="hal"\n        .responds-to="','"\n        .debug="','"\n      ></hal-9000>\n    ']);return X=function(){return e},e}window.customElements.define(V.tag,V);var W=function(e){A(n,a.winEventsElement(m.HAXElement(h.LitElement)));var t=j(n);function n(){var e;k(this,n),(e=t.call(this)).__winEvents={"hax-register-properties":"_haxStoreRegisterProperties","hax-consent-tap":"_haxConsentTap","hax-context-item-selected":"_haxContextOperation",onbeforeunload:"_onBeforeUnload",paste:"_onPaste","hax-register-app":"_haxStoreRegisterApp","hax-register-stax":"_haxStoreRegisterStax","hax-register-blox":"_haxStoreRegisterBlox","hax-store-write":"_writeHaxStore","hax-register-core-piece":"_haxStorePieceRegistrationManager","hax-register-body":"_haxStoreRegisterBody","hax-insert-content":"_haxStoreInsertContent","hax-insert-content-array":"_haxStoreInsertMultiple","hax-add-voice-command":"_addVoiceCommand"},p.SimpleTourManager.registerNewTour({key:"hax",name:"Let's learn HAX",style:"\n      simple-popover-manager::part(simple-popover) {\n        max-width: 250px;\n      }\n      simple-popover-manager button {\n        font-size: 12px;\n        margin: 0px 2px;\n      }\n      simple-popover-manager p {\n        --hax-base-styles-p-font-size: 14px;\n        padding: 0;\n        margin: 0;\n        font-size: 14px;\n        line-height: 20px;\n      }\n      simple-popover-manager h3 {\n        --hax-base-styles-h3-font-size: 18px;\n        margin: 8px 2px;\n      }"}),e.voiceRespondsTo="(worker)",e.voiceCommands={},e.skipHAXConfirmation=!1,e.storageData={},e.appStore={url:"",params:{}},e.activeNode=null,e.haxBodies=[],e.activePlaceHolder=null,e.sessionObject={},e.editMode=!1,e.skipExitTrap=!1,e.gizmoList=[],e.elementList={},e.appList=[],e.staxList=[],e.bloxList=[],e.globalPreferences={},e.activeApp={},e.connectionRewrites={},e.voiceDebug=!1,e.validTagList=e.__validTags(),e.validGizmoTypes=e.__validGizmoTypes();var o=document.createElement("webview");return e._isSandboxed="function"==typeof o.reload,Promise.resolve(c).then(function(e){e.setPassiveTouchGestures(!0)}),Promise.resolve(l).then(function(){e.haxToast=window.SimpleToast.requestAvailability()}),document.body.style.setProperty("--hax-ui-headings","#d4ff77"),e}return T(n,[{key:"getSelection",value:function(){if(this.activeHaxBody&&this.activeHaxBody.parentNode){if(this.activeHaxBody.parentNode.getSelection)return this.activeHaxBody.parentNode.getSelection();if(a.getRange(this.activeHaxBody.parentNode))return a.getRange(this.activeHaxBody.parentNode)}return window.getSelection()}},{key:"getRange",value:function(){var e=this.getSelection();return e.getRangeAt&&e.rangeCount?e.getRangeAt(0):e||void 0}},{key:"guessGizmo",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=[];if("undefined"!==w(e)&&this.validGizmoTypes.includes(e))for(var a in this.gizmoList){var r=this.gizmoList[a],s={},l=!1;if(r.handles)for(var c=0;c<r.handles.length;c++)if(e===r.handles[c].type||"*"===e&&!l){for(var d in r.handles[c])"type"!==d&&"undefined"!==w(t[d])&&("inline"!==e&&r.meta&&(!r.meta||r.meta.inlineOnly||r.meta.hidden)||(l=!0,s[r.handles[c][d]]=t[d]));if(l||n){if(o&&r.handles[c].type_exclusive)return[this.haxElementPrototype(r,s,"")];i.push(this.haxElementPrototype(r,s,""))}}}return i}},{key:"insertLogicFromValues",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=this.guessGizmoType(e),i=o,a=!0;if("*"==o){if(n)return!1;a=!1,i="link"}var r=this.guessGizmo(o,e,!1,a);return r.length>0?(1===r.length?"undefined"!==w(r[0].tag)&&t.dispatchEvent(new CustomEvent("hax-insert-content",{bubbles:!0,cancelable:!0,composed:!0,detail:r[0]})):this.haxAppPicker.presentOptions(r,o,"Pick how to present this "+i,"gizmo"),!0):(this.toast("Sorry, HAX doesn't know how to handle that type of link yet."),!1)}},{key:"write",value:function(e,t,n){n&&n.dispatchEvent(new CustomEvent("hax-store-write",{composed:!0,bubbles:!0,cancelable:!1,detail:{property:e,value:t,owner:n}}))}},{key:"mimeTypeToGizmoType",value:function(e){var t=e.split("/");switch(t[0]){case"audio":return"audio";case"image":return"svg+xml"==t[1]?"svg":"image";case"video":return"video";case"text":return["csv","html","markdown"].includes(t[1])?t[1]:"document";case"application":return"pdf"==t[1]?"pdf":["zip","gzip","x-tar"].includes(t[1])?"archive":"document"}}},{key:"guessGizmoType",value:function(e){if("undefined"!==w(e.source)){var t=e.source.toLowerCase();if(-1!=t.indexOf(".mp3")||-1!=t.indexOf(".midi")||-1!=t.indexOf(".mid"))return"audio";if(-1!=t.indexOf(".png")||-1!=t.indexOf(".jpg")||-1!=t.indexOf(".jpeg")||-1!=t.indexOf(".gif"))return"image";if(-1!=t.indexOf(".pdf"))return"pdf";if(-1!=t.indexOf(".svg"))return"svg";if(-1!=t.indexOf(".csv"))return"csv";if(-1!=t.indexOf(".md"))return"markdown";if(-1!=t.indexOf(".html")||-1!=t.indexOf(".htm"))return"html";if(-1!=t.indexOf(".txt")||-1!=t.indexOf(".doc")||-1!=t.indexOf(".docx")||-1!=t.indexOf(".xls")||-1!=t.indexOf(".xlsx")||-1!=t.indexOf(".vtt")||-1!=t.indexOf(".ppt"))return"document";if(-1!=t.indexOf(".zip")||-1!=t.indexOf(".tar.gz")||-1!=t.indexOf(".tar"))return"archive";if("external"!=window.MediaBehaviors.Video.getVideoType(t))return"video"}return"*"}},{key:"render",value:function(){return h.html(X(),this.appStore.url,this.appStore.params,this.__appStoreDataChanged,this.voiceRespondsTo,this.voiceDebug)}},{key:"__appStoreDataChanged",value:function(e){this.__appStoreData=e.detail.value}},{key:"toast",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"capsule",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;window.dispatchEvent(new CustomEvent("simple-toast-show",{bubbles:!0,composed:!0,cancelable:!0,detail:{text:e,duration:t,classStyle:n,closeText:o,eventCallback:i}}))}},{key:"_storageDataChanged",value:function(e){e&&this.ready&&this.__storageDataProcessed&&(window.localStorage.getItem("haxConfirm")?window.localStorage.setItem("haxUserData",JSON.stringify(e)):window.sessionStorage.getItem("haxConfirm")&&window.sessionStorage.setItem("haxUserData",JSON.stringify(e)))}},{key:"isTextElement",value:function(e){var t;return null!=e&&e.tagName?t=e.tagName.toLowerCase():null!=e&&e.tag&&(t=e.tag.toLowerCase()),!!(t&&this.validTagList.includes(t)&&["p","ol","ul","li","a","h1","h2","h3","h4","h5","h6","strike","u","b","sub","sup","span","i","bold","em","strong","blockquote","code","figure"].includes(t))}},{key:"isGridPlateElement",value:function(e){var t;return e&&e.tagName?t=e.tagName.toLowerCase():e&&e.tag&&(t=e.tag.toLowerCase()),!!(t&&this.validTagList.includes(t)&&["p","ol","ul","li","div","h1","h2","h3","h4","h5","h6","blockquote","code","figure","grid-plate"].includes(t))}},{key:"_appStoreChanged",value:function(e,t){"undefined"!==w(e)&&null!=e&&"undefined"!==w(t)&&("undefined"===w(e.apps)&&this.shadowRoot&&this.shadowRoot.querySelector("#appstore")&&this.shadowRoot.querySelector("#appstore").generateRequest?this.shadowRoot.querySelector("#appstore").generateRequest():this.__appStoreData=e)}},{key:"_loadAppStoreData",value:function(e,t,n){if(e&&"undefined"!==w(t)&&null!=t){var o={};if("undefined"!==w(t.autoloader))for(var i in t.autoloader=Object.assign({},t.autoloader),t.autoloader){var a=i,r=t.autoloader[i];isNaN(a)||(a=t.autoloader[i],r="@lrnwebcomponents/".concat(a,"/").concat(a,".js")),this.validTagList.push(a),o[a]=r}if("undefined"!==w(t.apps)){var s=t.apps;for(i=0;i<s.length;i++){var l=document.createElement("hax-app");l.data=s[i],this.appendChild(l)}}if("undefined"!==w(t.stax)){var c=t.stax;for(i=0;i<c.length;i++){var d=document.createElement("hax-stax");d.data=c[i],this.appendChild(d)}}if("undefined"!==w(t.blox)){var u=t.blox;for(i=0;i<u.length;i++){var h=document.createElement("hax-blox");h.data=u[i],this.appendChild(h)}}this.dispatchEvent(new CustomEvent("hax-store-app-store-loaded",{bubbles:!0,cancelable:!0,composed:!0,detail:!0})),this._handleDynamicImports(o,n)}}},{key:"pathFromUrl",value:function(e){return e.substring(0,e.lastIndexOf("/")+1)}},{key:"_handleDynamicImports",value:function(){var e=_(regeneratorRuntime.mark(function e(t,n){var o,i,a,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=this.pathFromUrl(decodeURIComponent("undefined"==typeof document?new(require("url").URL)("file:"+__filename).href:document.currentScript&&document.currentScript.src||new URL("hax-body.umd.js",document.baseURI).href)),e.t0=regeneratorRuntime.keys(t);case 2:if((e.t1=e.t0()).done){e.next=13;break}if(i=e.t1.value,window.customElements.get(i)){e.next=9;break}return e.next=7,import("".concat(o,"../../../").concat(t[i])).then(function(e){var t=!1;for(var n in e){var o=e[n];"function"==typeof o.getHaxProperties?(r.setHaxProperties(o.getHaxProperties(),i),t=!0):"function"==typeof o.HAXWiring?(r.setHaxProperties(o.HAXWiring.getHaxProperties(),i),t=!0):o.haxProperties&&(r.setHaxProperties(o.haxProperties,i),t=!0)}!t&&window.customElements.get(i)&&window.customElements.get(i).haxProperties&&r.setHaxProperties(window.customElements.get(i).haxProperties,i)}).catch(function(e){console.warn(e)});case 7:e.next=11;break;case 9:"function"==typeof(a=window.customElements.get(i)).getHaxProperties?this.setHaxProperties(a.getHaxProperties(),i):"function"==typeof a.HAXWiring?this.setHaxProperties(a.HAXWiring.getHaxProperties(),i):a.haxProperties?this.setHaxProperties(a.haxProperties,i):n.appendChild(document.createElement(i));case 11:e.next=2;break;case 13:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"_editModeChanged",value:function(e){e&&this.globalPreferences.haxVoiceCommands&&this.__hal?this.__hal.auto=!0:this.__hal.auto=!1}},{key:"_globalPreferencesChanged",value:function(e,t){if(this.__storageDataProcessed&&e&&"undefined"!==w(e.haxVoiceCommands)&&this.ready){var n=this.storageData;n.globalPreferences=e,this.storageData=n,this._storageDataChanged(this.storageData),e.haxVoiceCommands&&this.editMode&&this.__hal?this.__hal.auto=!0:this.__hal.auto=!1}}},{key:"_haxContextOperation",value:function(e){var t=this,n=e.detail;if(this.activeNode){var o=!1;switch(n.eventName){case"hax-align-left":this.activeNode.style.float=null,this.activeNode.style.margin=null,this.activeNode.style.display=null,o=!0;break;case"hax-align-center":this.activeNode.style.float=null,this.activeNode.style.margin="0 auto",this.activeNode.style.display="block",o=!0;break;case"hax-align-right":this.activeNode.style.float="right",this.activeNode.style.margin="0 auto",this.activeNode.style.display="block",o=!0;break;case"hax-size-change":100==n.value?this.activeNode.style.width=null:this.activeNode.style.width=n.value+"%",o=!0}o&&setTimeout(function(){t.activeHaxBody.positionContextMenus()},0)}}},{key:"_haxConsentTap",value:function(e){window.localStorage.setItem("haxConfirm",!0),window.localStorage.setItem("haxUserData",JSON.stringify(this.storageData))}},{key:"updated",value:function(e){var t=this;D(P(n.prototype),"updated",this)&&D(P(n.prototype),"updated",this).call(this,e);var o=!1;e.forEach(function(e,n){"openDrawer"==n&&t.openDrawersCallback(t[n],e),"appStore"==n&&t._appStoreChanged(t[n],e),"globalPreferences"==n&&t._globalPreferencesChanged(t[n],e),"editMode"==n&&t._editModeChanged(t[n],e),"activeNode"==n&&(t.activeGizmo=t._calculateActiveGizmo(t[n]),t.write("activeGizmo",t.activeGizmo,t)),["__ready","__appStoreData","haxAutoloader"].includes(n)&&(o=!0),["haxAutoloader","activeHaxBody","haxToast","haxExport","haxAppPicker","haxTray"].includes(n)&&t._storePiecesAllHere(t.haxAutoloader,t.activeHaxBody,t.haxToast,t.haxExport,t.haxAppPicker,t.haxTray)}),o&&this._loadAppStoreData(this.__ready,this.__appStoreData,this.haxAutoloader)}},{key:"_calculateActiveGizmo",value:function(e){if(null==e)return null;for(var t in this.gizmoList){var n=this.gizmoList[t];if(n.tag===e.tagName.toLowerCase())return n}}},{key:"firstUpdated",value:function(e){var t=this;if(D(P(n.prototype),"firstUpdated",this)&&D(P(n.prototype),"firstUpdated",this).call(this,e),Promise.resolve(u).then(function(e){t.shadowRoot.querySelector("#appstore")&&t.shadowRoot.querySelector("#appstore").generateRequest()}),Promise.resolve(d).then(function(e){t.__hal=t.shadowRoot.querySelector("#hal")}),setTimeout(function(){t.__storageDataProcessed=!0,t.storageData.globalPreferences&&t.write("globalPreferences",t.storageData.globalPreferences,t)},100),this.skipHAXConfirmation&&(window.sessionStorage.setItem("haxConfirm",!0),window.localStorage.setItem("haxConfirm",!0)),window.sessionStorage.getItem("haxConfirm")||window.localStorage.getItem("haxConfirm"))if(window.sessionStorage.getItem("haxConfirm")&&!window.localStorage.getItem("haxConfirm"))try{var o=window.sessionStorage.getItem("haxUserData")?JSON.parse(window.sessionStorage.getItem("haxUserData")):{};this.storageData=o,this._storageDataChanged(this.storageData)}catch(e){}else try{var i=window.localStorage.getItem("haxUserData")?JSON.parse(window.localStorage.getItem("haxUserData")):{};this.storageData=i,this._storageDataChanged(this.storageData)}catch(e){}else{window.sessionStorage.setItem("haxConfirm",!0);this.toast("\n    The HAX content editor keeps preferences in order to improve your experience.\n    This data is stored in your browser and is never sent anywhere.\n    Click to accept.\n    ","-1","fit-bottom","I Accept","hax-consent-tap")}}},{key:"_storePiecesAllHere",value:function(e,t,n,o,i,a){!this.__ready&&t&&e&&n&&o&&i&&a&&(this.dispatchEvent(new CustomEvent("hax-store-ready",{bubbles:!0,cancelable:!1,composed:!0,detail:!0})),this.ready=!0,this.__ready=!0,this._buildPrimitiveDefinitions(),this._initVoiceCommands(),this.__hal.commands=L({},this.voiceCommands))}},{key:"_initVoiceCommands",value:function(){var e=this;this.__voiceInit=!0,this.voiceCommands["scroll up ".concat(this.voiceRespondsTo)]=function(){window.scrollBy({top:-.5*window.innerHeight,left:0,behavior:"smooth"})},this.voiceCommands["scroll (down) ".concat(this.voiceRespondsTo)]=function(){window.scrollBy({top:.5*window.innerHeight,left:0,behavior:"smooth"})},this.voiceCommands["scroll to bottom ".concat(this.voiceRespondsTo)]=function(){window.scrollTo(0,document.body.scrollHeight)},this.voiceCommands["scroll to top ".concat(this.voiceRespondsTo)]=function(){window.scrollTo(0,0)},this.voiceCommands["".concat(this.voiceRespondsTo," (show)(focus) active (element)(content)")]=function(){try{e._positionCursorInNode(e.activeNode)}catch(e){}},this.voiceCommands["".concat(this.voiceRespondsTo," (focus) previous (element)(content)")]=function(){e.activeNode.previousElementSibling?(e.activeNode=e.activeNode.previousElementSibling,e.write("activeNode",e.activeNode,e),e._positionCursorInNode(e.activeNode)):e.speak("You are at the top of the document")},this.voiceCommands["".concat(this.voiceRespondsTo," (focus) next (element)(content)")]=function(){e.activeNode.nextElementSibling?(e.activeNode=e.activeNode.nextElementSibling,e.write("activeNode",e.activeNode,e),e._positionCursorInNode(e.activeNode)):e.speak("You are at the bottom of the document")},this.voiceCommands["".concat(this.voiceRespondsTo," type *mycontent")]=function(t){if(e.isTextElement(e.activeNode))try{var n=e._positionCursorInNode(e.activeNode),o=document.createTextNode(t);n.deleteContents(),n.insertNode(o)}catch(t){e.speak("That didn't work"),console.warn(t)}else e.speak("I'm sorry but I can only type in text areas. Try saying Insert Paragraph and try again.")},this.voiceCommands["hey ".concat(this.voiceRespondsTo)]=function(){e.speak("Yeah what do you want")},this.voiceCommands["".concat(this.voiceRespondsTo," now your name is *splat")]=function(t){var n=e.voiceRespondsTo;e.speak("I used to be named ".concat(n," but you can call me ").concat(t," now.")),e.voiceRespondsTo="(".concat(t,")")},this.voiceCommands["".concat(this.voiceRespondsTo," close")]=function(){e.write("openDrawer",!1,e)}}},{key:"speak",value:function(e){this.__hal&&this.__hal.speak&&this.__hal.speak(e),this.toast("".concat(this.voiceRespondsTo,": ").concat(e))}},{key:"addVoiceCommand",value:function(e,t,n){t&&(e=e.replace(":name:",this.voiceRespondsTo).toLowerCase(),this.voiceCommands[e]=t[n].bind(t),this.__voiceInit&&(this.__hal.commands=L({},this.voiceCommands)))}},{key:"_addVoiceCommand",value:function(e){var t=e.detail.context;t||(t=e.target),this.addVoiceCommand(e.detail.command,t,e.detail.callback)}},{key:"_positionCursorInNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.activeHaxBody.positionContextMenus();var n=document.createRange(),o=this.getSelection();return n.setStart(e,t),n.collapse(!0),o.removeAllRanges(),o.addRange(n),n}},{key:"_onBeforeUnload",value:function(e){if(!this.skipExitTrap&&this.editMode)return"Are you sure you want to leave? Your work will not be saved!"}},{key:"_onPaste",value:function(e){var t=this;if(this.isTextElement(this.activeNode)){var n,o="";e.clipboardData||e.originalEvent.clipboardData?""==(o=(e.originalEvent||e).clipboardData.getData("text/html"))&&(o=(e.originalEvent||e).clipboardData.getData("text")):window.clipboardData&&(o=window.clipboardData.getData("Text")),n=o;var i=!1,r="";o=(o=(o=o.replace(/<span>\s*?<\/span>/g," ")).replace(/<div/g,"<p")).replace(/<\/div>/g,"</p>"),o=a.stripMSWord(o);var s=this.htmlToHaxElements(o);if(0===s.length&&a.validURL(o)){if(""!=this.activeNode.innerText.trim())return!1;var l={source:o,title:o};if(!this.insertLogicFromValues(l,this))return!1}else if(0===s.length){if(i=!0,n==o)return!1;r=o}else if(1===s.length&&"p"===s[0].tag)r=o,i=!0;else if(1===s.length&&"a"===s[0].tag&&s[0].properties.href)if(""!=this.activeNode.innerText.trim())r=s[0].properties.href,i=!0;else{var c={source:s[0].properties.href,title:s[0].content};if(!this.insertLogicFromValues(c,this))return!1}else{if(!this.isGridPlateElement(s[0]))return!1;for(var d in s){delete s[d].properties.style,delete s[d].properties.start,delete s[d].properties.align;var u=a.haxElementToNode({tag:s[d].tag,content:s[d].content.replace(/<span>&nbsp;<\/span>/g," ").trim(),properties:s[d].properties});r+=this.nodeToContent(u)}}e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();try{var h,p=this.getRange(),m=this.getSelection(),v=document.createElement("div");if(v.innerHTML=r,p&&m&&"function"==typeof p.deleteContents){for(var d in p.deleteContents(),v.children)v.children[d].tagName&&"P"===v.children[d].tagName&&""===v.children[d].innerHTML&&v.children[d].remove();if(i){var x=document.createTextNode(v.innerHTML);p.insertNode(x),setTimeout(function(){t._positionCursorInNode(x,x.length)},0)}else for(var g;v.lastElementChild;)p.commonAncestorContainer&&p.commonAncestorContainer.parentNode&&(h||this.activeNode==p.commonAncestorContainer||(h=p.commonAncestorContainer.parentNode.nextElementSibling)||(h=p.commonAncestorContainer),g=v.lastElementChild,h?(h.getAttribute&&h.getAttribute("slot")&&g.setAttribute("slot",h.getAttribute("slot")),h.parentNode.insertBefore(g,h)):this.activeNode?(this.activeNode.getAttribute("slot")&&g.setAttribute("slot",this.activeNode.getAttribute("slot")),this.activeNode.parentNode.insertBefore(g,this.activeNode.nextElementSibling)):this.activeHaxBody.appendChild(g),h=g)}}catch(e){console.warn(e)}}}},{key:"__validTags",value:function(){return["p","div","span","table","caption","sup","sub","u","strike","tr","th","td","ol","ul","li","a","strong","kbd","tt","em","i","b","hr","h1","h2","h3","h4","h5","h6","blockquote","code","figure","img","iframe","video","audio","section","grid-plate","template","webview"]}},{key:"__validGizmoTypes",value:function(){return["data","video","audio","text","link","file","pdf","image","csv","doc","archive","markdown","html","wikipedia","content","text","inline","*"]}}],[{key:"tag",get:function(){return"hax-store"}},{key:"properties",get:function(){return L(L({},D(P(n),"properties",this)),{},{openDrawer:{type:Object},voiceDebug:{type:Boolean,attribute:"voice-debug"},activeGizmo:{type:Object},voiceRespondsTo:{type:String,attribute:"voice-responses-to"},skipHAXConfirmation:{type:Boolean,reflect:!0,attribute:"skip-hax-confirmation"},storageData:{type:Object},haxTray:{type:Object},haxAppPicker:{type:Object},haxStaxPicker:{type:Object},haxBloxPicker:{type:Object},haxAutoloader:{type:Object},haxBodies:{type:Array},activePlaceHolder:{type:Object},activeHaxBody:{type:Object},appStore:{type:Object},haxToast:{type:Object},haxExport:{type:Object},activeNode:{type:Object},sessionObject:{type:Object},editMode:{type:Boolean},skipExitTrap:{type:Boolean},gizmoList:{type:Array},elementList:{type:Object},appList:{type:Array},staxList:{type:Array},bloxList:{type:Array},globalPreferences:{type:Object},activeApp:{type:Object},validTagList:{type:Array},validGizmoTypes:{type:Array},_isSandboxed:{type:Boolean},__appStoreData:{type:Object},__ready:{type:Boolean},connectionRewrites:{type:Object}})}}]),T(n,[{key:"_buildPrimitiveDefinitions",value:function(){if(this._isSandboxed){this.setHaxProperties({canScale:!0,canPosition:!0,canEditSource:!1,settings:{quick:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"}],configure:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"}],advanced:[]}},"webview")}this.setHaxProperties({canScale:!0,canPosition:!0,canEditSource:!0,gizmo:{title:"Basic iframe",description:"A basic iframe",icon:"icons:fullscreen",color:"blue-grey",groups:["Content"],handles:[{type:"link",source:"src",height:"height",width:"width"},{type:"pdf",source:"src",height:"height",width:"width"},{type:"document",source:"src",height:"height",width:"width"},{type:"html",source:"src",height:"height",width:"width"}],meta:{author:"W3C"}},settings:{quick:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"}],configure:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"}],advanced:[{attribute:"loading",title:"Loading method",description:"Whether or not to lazy load this",inputMethod:"select",options:{lazy:"Load when visible",auto:"Automatic"}}]}},"iframe");this.setHaxProperties({canScale:{min:10,step:5},canPosition:!0,canEditSource:!0,gizmo:{title:"Image",description:"A basic img tag",icon:"image:image",color:"blue-grey",groups:["Image","Media"],handles:[{type:"link",source:"src"},{type:"image",type_exclusive:!0,source:"src",height:"height",width:"width"}],meta:{author:"W3C"}},settings:{quick:[{attribute:"alt",title:"Alt text",description:"Useful for screen readers and improved SEO.",inputMethod:"alt",icon:"accessibility"},{attribute:"height",title:"Height",description:"height in pixels of the item. Leave blank to respond to the natural resolution",inputMethod:"textfield",icon:"icons:swap-vert"}],configure:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"haxupload",icon:"link",required:!0,validationType:"url"},{attribute:"alt",title:"Alt text",description:"Useful for screen readers and improved SEO.",inputMethod:"alt",icon:"accessibility"},{attribute:"height",title:"Height",description:"height in pixels of the item. Leave blank to respond to the natural resolution",inputMethod:"textfield",icon:"icons:swap-vert"}],advanced:[{attribute:"aria-describedby",title:"Aria-describedby",description:"Space-separated list of IDs for elements that describe the image.",inputMethod:"textfield",icon:"accessibility"},{attribute:"loading",title:"Loading method",description:"Whether or not to lazy load this",inputMethod:"select",options:{lazy:"Load when visible",auto:"Automatic"}}]}},"img");var e={canScale:!1,canPosition:!1,canEditSource:!0,gizmo:{title:"Basic link",description:"A basic a tag",icon:"icons:link",color:"blue-grey",groups:["Link"],handles:[],meta:{author:"W3C"}},settings:{quick:[{attribute:"href",title:"Link",description:"The URL for this video.",inputMethod:"textfield",icon:"icons:link",required:!0,validationType:"url"},{attribute:"title",title:"Title text",description:"Useful for screen readers and improved SEO.",inputMethod:"textfield",icon:"icons:accessibility"}],configure:[{attribute:"innerText",title:"Text",description:"Text of the link",inputMethod:"textfield",required:!0},{attribute:"href",title:"Link",description:"The URL for this video.",inputMethod:"haxupload",icon:"icons:link",required:!0,validationType:"url"},{attribute:"title",title:"Title text",description:"Useful for screen readers and improved SEO.",inputMethod:"textfield",icon:"icons:accessibility"},{attribute:"target",title:"Target",description:"Where to place the link.",inputMethod:"select",icon:"icons:launch",options:{"":"Same window",_blank:"New window",_top:"Top window",_parent:"Parent window"}}],advanced:[]}};this.validGizmoTypes.forEach(function(t){e.gizmo.handles.push({type:t,source:"href",title:"innerText",alt:"title"})}),this.setHaxProperties(e,"a");this.setHaxProperties({canScale:!1,canPosition:!1,canEditSource:!0,gizmo:{title:"Paragraph",description:"A basic text area",icon:"hax:paragraph",color:"blue-grey",groups:["Content"],handles:[{type:"content",content:""}],meta:{author:"W3C"}},settings:{quick:[],configure:[],advanced:[]},demoSchema:[{tag:"p",content:"Text",properties:{}}]},"p");this.setHaxProperties({canScale:!0,canPosition:!0,canEditSource:!0,gizmo:{title:"Table",description:"A table for displaying data",icon:"image:grid-on",color:"blue-grey",groups:["Content","Table","Data"],meta:{author:"W3C"}},settings:{quick:[],configure:[{slot:"",title:"Body",description:"Tags that make up the table",inputMethod:"code-editor",slotWrapper:""}],advanced:[]}},"table");var t={caption:{title:"Caption",icon:"av:call-to-action"},video:{title:"Video",icon:"av:play-circle-filled"},audio:{title:"Audio",icon:"image:music-note"},section:{title:"Section",icon:"image:crop-landscape"},ol:{title:"Numbered list",icon:"editor:format-list-numbered"},ul:{title:"Bulleted list",icon:"editor:format-list-bulleted"},li:{title:"List item",icon:"editor:format-list-bulleted"},h1:{title:"Heading",icon:"hax:h1"},h2:{title:"Heading",icon:"hax:h2"},h3:{title:"Heading",icon:"hax:h3"},h4:{title:"Heading",icon:"hax:h4"},h5:{title:"Heading",icon:"hax:h5"},h6:{title:"Heading",icon:"hax:h6"},strike:{title:"Cross out",icon:"editor:format-strikethrough"},u:{title:"Underline",icon:"editor:format-underlined"},sub:{title:"Subscript",icon:"mdextra:subscript"},sup:{title:"Superscript",icon:"mdextra:superscript"},div:{title:"DIV",icon:"image:crop-landscape"},span:{title:"SPAN",icon:"editor:short-text"},i:{title:"Italic",icon:"editor:format-italic"},em:{title:"Emphasis",icon:"editor:format-italic"},strong:{title:"Bold",icon:"editor:format-bold"},b:{title:"Bold",icon:"editor:format-bold"},blockquote:{title:"Block quote",icon:"editor:format-quote"},code:{title:"Code",icon:"icons:code"},figure:{title:"Figure",icon:"icons:label-outline"},embed:{title:"Embedded object",icon:"icons:fullscreen"}};for(var n in t)this.setHaxProperties({canScale:!1,canPosition:!1,canEditSource:!0,gizmo:{title:t[n].title,icon:t[n].icon,meta:{hidden:"h2"!=n}},settings:{quick:[],configure:[],advanced:[]},demoSchema:[{tag:n,content:"h2"==n?"Heading":"",properties:{}}]},n);this.setHaxProperties({canScale:{min:25,step:25},gizmo:{title:"Horizontal line",icon:"hax:hr",meta:{author:"W3C"}},canPosition:!1,canEditSource:!1,settings:{quick:[],configure:[],advanced:[]},demoSchema:[{tag:"hr",content:"",properties:{style:"width:50%;"}}]},"hr")}},{key:"_haxStorePieceRegistrationManager",value:function(e){e.detail&&e.detail.piece&&e.detail.object&&(this[e.detail.piece]=e.detail.object)}},{key:"openDrawersCallback",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=["haxAppPicker","haxExport"];for(var n in t)e===this[t[n]]?(e.open(),setTimeout(function(){null!=e.querySelector("simple-fields-field,textarea,paper-button,hax-tray-button")&&e.querySelector("simple-fields-field,textarea,paper-button,hax-tray-button").focus();var t=document.createEvent("UIEvents");t.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(t)},325)):this[t[n]].close()}},{key:"_haxStoreInsertContent",value:function(e){var t=this;if(e.detail){var n=e.detail;if(window.customElements.get(n.tag)){var o=Object.getPrototypeOf(document.createElement(n.tag));"undefined"!==w(o.preProcessHaxInsertContent)&&(n=o.preProcessHaxInsertContent(n))}var i={};if("undefined"!==w(n.properties)&&(i=n.properties),i.innerHTML&&(""==n.content&&(n.content=i.innerHTML),delete i.innerHTML),i.innerText&&(""==n.content&&(n.content=i.innerText),delete i.innerText),this.activeHaxBody.__activeHover=null,n.replace&&n.replacement){var r=a.haxElementToNode({tag:n.tag,content:n.content,properties:i});this.activePlaceHolder?(this.activeHaxBody.haxReplaceNode(this.activePlaceHolder,r),this.activePlaceHolder=null):this.activeHaxBody.haxReplaceNode(this.activeNode,r)}else if("undefined"!==w(n.__type)&&"inline"===n.__type){var s=a.haxElementToNode({tag:n.tag,content:n.content,properties:i});null!==this.activePlaceHolder&&(this.activePlaceHolder.deleteContents(),this.activePlaceHolder.insertNode(s)),this.activePlaceHolder=null}else if("HAX-BODY"!=this.activeNode.parentNode.tagName){var l=a.haxElementToNode({tag:n.tag,content:n.content,properties:i});this.activeNode.parentNode&&"GRID-PLATE"===this.activeNode.parentNode.tagName?(null!=this.activeNode.getAttribute("slot")&&l.setAttribute("slot",this.activeNode.getAttribute("slot")),this.activeHaxBody.haxInsert(n.tag,n.content,i,!1),this.activeHaxBody.shadowRoot.querySelector("#textcontextmenu").highlightOps=!1):this.activeHaxBody.haxInsert(n.tag,n.content,i,!1)}else this.activeHaxBody.haxInsert(n.tag,n.content,i,!1);setTimeout(function(){var e=t.gizmoList;for(var o in e){if(e[o].tag===n.tag){var i=e[o];delete e[o],t.gizmoList.unshift(i)}}t.gizmoList=B(e),t.write("gizmoList",e,t)},10)}}},{key:"haxSchemaFromTag",value:function(e){return this.elementList&&this.elementList[e]?this.elementList[e]:{}}},{key:"_haxStoreInsertMultiple",value:function(e){var t;if(e.detail)for(var n in e.detail)t={},"undefined"!==w(e.detail[n].properties)&&(t=e.detail[n].properties),this.activeHaxBody.haxInsert(e.detail[n].tag,e.detail[n].content,t,!1)}},{key:"_haxStoreRegisterBody",value:function(e){e.detail&&(this.haxBodies.push(e.detail),this.activeHaxBody=e.detail,this.write("activeHaxBody",this.activeHaxBody,this),this.write("editMode",this.editMode,this))}},{key:"computePolyfillSafe",value:function(){return!(!document.head.createShadowRoot&&!document.head.attachShadow)||(console.warn("Shadow DOM missing, certain operations hidden"),!1)}},{key:"_writeHaxStore",value:function(e){e.detail&&"undefined"!==w(e.detail.value)&&e.detail.property&&e.detail.owner&&(null==e.detail.value?this[e.detail.property]=null:"object"===w(e.detail.value)&&(this[e.detail.property]={}),this[e.detail.property]=e.detail.value,this.dispatchEvent(new CustomEvent("hax-store-property-updated",{bubbles:!0,composed:!0,cancelable:!1,detail:{property:e.detail.property,value:e.detail.value,owner:e.detail.owner}})))}},{key:"_haxStoreRegisterApp",value:function(e){if(e.detail){if(e.detail.index=this.appList.length,this.appList=[].concat(B(this.appList),[e.detail]),this.write("appList",this.appList,this),e.detail.connection&&e.detail.connection.protocol&&e.detail.connection.url){var t=document.createElement("link");t.rel="preconnect",t.href=e.detail.connection.protocol+"://"+e.detail.connection.url,document.head.appendChild(t)}"undefined"!==w(e.target.parentElement)&&"HAX-STORE"===e.target.parentElement.tagName&&e.target.parentElement.removeChild(e.target)}}},{key:"_haxStoreRegisterStax",value:function(e){e.detail&&(e.detail.index=this.staxList.length,this.staxList=[].concat(B(this.staxList),[e.detail]),this.write("staxList",this.staxList,this),"undefined"!==w(e.target.parentElement)&&"HAX-STORE"===e.target.parentElement.tagName&&e.target.parentElement.removeChild(e.target))}},{key:"_haxStoreRegisterBlox",value:function(e){e.detail&&(e.detail.index=this.bloxList.length,this.bloxList=[].concat(B(this.bloxList),[e.detail]),this.write("bloxList",this.bloxList,this),"undefined"!==w(e.target.parentElement)&&"HAX-STORE"===e.target.parentElement.tagName&&e.target.parentElement.removeChild(e.target))}},{key:"dashToCamel",value:function(e){return e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})}},{key:"htmlToHaxElements",value:function(e){var t=[],n=this.validTagList,o=document.createElement("div");o.innerHTML=e;for(var i=o.childNodes,r=0;r<i.length;r++)"undefined"!==w(i[r].tagName)&&n.includes(i[r].tagName.toLowerCase())&&t.push(a.nodeToHaxElement(i[r],null));return t}},{key:"nodeToContent",value:function(e){var t=Object.getPrototypeOf(e);"undefined"!==w(t.preProcessHaxNodeToContent)&&(e=t.preProcessHaxNodeToContent(e));var n=e.tagName.toLowerCase();this._isSandboxed&&"webview"===n&&(n="iframe");var o="";o+="<"+n;for(var i,r=this.elementList[n],s={},l=0,c=e.attributes.length;l<c;++l){var d=e.attributes.item(l).nodeName,u=e.attributes.item(l).value;"style"==d||w(u)!==("undefined"==typeof Object?"undefined":w(Object))&&u.constructor!==Array?null!=u&&"null"!=u&&(!0===u||"true"===u?s[d]=!0:!1===u||("string"==typeof u&&""!==u?(u=u.replace(new RegExp('"',"g"),"&quot;"),s[d]=u):""===u?(""==u&&""!=e.attributes.item(l).value&&(u=e.attributes.item(l).value),s[d]=u):s[d]=u)):s[d]=JSON.stringify(u).replace(new RegExp('"',"g"),"&quot;")}if(customElements.get(n)&&(i=customElements.get(n).properties),"undefined"===w(i)&&(i=e.__data),"undefined"!==w(i))for(var l in i){d=a.camelToDash(l),u=null;"undefined"!==w(e[l])&&(u=e[l]),i[l].readOnly||i[l].computed||u===i[l].value||d.startsWith("__")||(null==u||"object"!==w(u)&&u.constructor!==Array?null!=u&&"null"!=u&&(!0===u||"true"===u?s[d]=!0:!1===u||("string"==typeof u&&""!==u?(u=u.replace(new RegExp('"',"g"),"&quot;"),s[d]=u):""===u?""==u&&""!=i[l].value?u=i[l].value:""===u&&i[l].value:s[d]=u)):u.constructor===Array&&u!=[]?s[d]=JSON.stringify(u).replace(new RegExp('"',"g"),"&quot;"):"object"===w(u)&&u!={}&&(s[d]=JSON.stringify(u).replace(new RegExp('"',"g"),"&quot;")))}if("undefined"!==w(r)&&"undefined"!==w(r.saveOptions.unsetAttributes))for(var h in r.saveOptions.unsetAttributes)delete s[r.saveOptions.unsetAttributes[h]];var p=["inner-text","inner-html","tabindex","guestinstance"];for(var m in p)"undefined"!==w(s[p[m]])&&delete s[p[m]];for(var h in"undefined"!==w(s.id)&&""===s.id&&delete s.id,s)!0===s[h]?o+=" "+h:o+=" "+h+'="'+s[h]+'"';if(["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"].includes(n)?o+="/>":o+=">","undefined"===w(r)||!r.saveOptions.wipeSlot){var v=e.childNodes;if(v.length>0){l=0;for(var x=v.length;l<x;l++)"undefined"!==w(v[l].tagName)?this.HTMLPrimativeTest(v[l].tagName)||"TEMPLATE"===v[l].tagName?(v[l].removeAttribute("data-hax-ray"),v[l].contentEditable=!1,o+=v[l].outerHTML):o+=this.nodeToContent(v[l]):8===v[l].nodeType?o+="\x3c!-- "+v[l].textContent+" --\x3e":1!==v[l].nodeType&&"undefined"!==w(v[l].textContent)&&"undefined"!==v[l].textContent&&(o+=v[l].textContent)}}return"function"==typeof e.haxProgressiveEnhancement&&(o+=e.haxProgressiveEnhancement()),"span"===n?o+="</"+n+">":"hr"===n||"br"===n||"img"===n||(o+="</"+n+">\n"),o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=o.replace(/&nbsp;/gm," ")).replace(/ data-hax-ray="(\s|.)*?"/gim,"")).replace(/ class=""/gim,"")).replace(/ class="hax-active"/gim,"")).replace(/ contenteditable="(\s|.)*?"/gim,"")).replace(/<span style="(.*?)">/gim,"<span>")).replace(/<span>\s*?<\/span>/g," ")).replace(/<span><br\/><\/span>/gm,"")).replace(/<strong style="(.*?)">/gim,"<strong>")).replace(/<b style="(.*?)">/gim,"<b>")).replace(/<strike style="(.*?)">/gim,"<strike>")).replace(/<em style="(.*?)">/gim,"<em>")).replace(/<i style="(.*?)">/gim,"<i>")).replace(/<p>(\s*)<\/p>/gm,"<p></p>")).replace(/<p>&nbsp;<\/p>/gm,"<p></p>")).replace(/<p><br\/><\/p>/gm,"<p></p>")).replace(/<p><br><\/p>/gm,"<p></p>")).replace(/<\/p>(\s*)<p>/gm,"</p><p>")).split("\n\r").join("\n").split("\r").join("\n").split("\n\n").join("\n").split("\n\n").join("\n").split("\n\n").join("\n"),"function"===e.postProcesshaxNodeToContent&&(o=e.postProcesshaxNodeToContent(o)),o}},{key:"HTMLPrimativeTest",value:function(e){return"undefined"!==w(e.tagName)&&-1==e.tagName.indexOf("-")}},{key:"getHaxAppStoreTargets",value:function(e){return this.appList.filter(function(t){if("undefined"!==w(t.connection.operations.add)){var n=t.connection.operations.add;if("undefined"!==w(n.acceptsGizmoTypes)&&n.acceptsGizmoTypes.includes(e))return!0}return!1})}},{key:"haxElementPrototype",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return{tag:e.tag,properties:t,content:n,gizmo:e}}},{key:"getHAXSlot",value:function(e){if(this.isTextElement(e))return e.innerHTML;var t="",n=e.childNodes;if(n.length>0)for(var o=0,i=n.length;o<i;o++)"undefined"!==w(n[o].tagName)?n[o].tagName.indexOf("-")>0?t+="  "+this.nodeToContent(n[o])+"\n":t+="  "+n[o].outerHTML+"\n":8===n[o].nodeType?t+="\x3c!-- "+n[o].textContent+" --\x3e":1!==n[o].nodeType&&"undefined"!==w(n[o].textContent)&&"undefined"!==n[o].textContent&&(t+=n[o].textContent);return t}},{key:"_haxStoreRegisterProperties",value:function(e){if(e.detail&&e.detail.properties&&e.detail.tag){if("undefined"===w(this.elementList[e.detail.tag])){var t=e.detail.properties.gizmo;if(t){t.tag=e.detail.tag;var n=this.gizmoList;n.push(t),this.write("gizmoList",n,this)}this.elementList[e.detail.tag]=e.detail.properties,this.validTagList.find(function(t){return t===e.detail.tag})||this.validTagList.push(e.detail.tag)}"undefined"!==w(e.target.parentElement)&&"HAX-AUTOLOADER"===e.target.parentElement.tagName&&this.haxAutoloader.removeChild(e.target)}}}]),n}();window.customElements.define(W.tag,W),window.HaxStore=window.HaxStore||{},window.HaxStore.requestAvailability=function(){return window.HaxStore.instance||(window.HaxStore.instance=document.createElement("hax-store"),document.body.appendChild(window.HaxStore.instance)),window.HaxStore.instance};var F=window.HaxStore.requestAvailability(),Y=function(e){A(n,r.SimpleTourFinder(a.winEventsElement(HTMLElement)));var t=j(n);function n(){var e,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return k(this,n),(e=t.call(this)).tourName="hax",e.__winEvents={"hax-store-property-updated":"_haxStorePropertyUpdated"},e.tag=n.tag,e.template=document.createElement("template"),e.attachShadow({mode:"open"}),o||e.render(),setTimeout(function(){},0),e}return T(n,[{key:"_haxStorePropertyUpdated",value:function(e){var t=this;setTimeout(function(){e.detail&&"undefined"!==w(e.detail.value)&&e.detail.property&&null!=t.getAttribute("on-screen")&&["activeNode"].includes(e.detail.property)&&t.__updatePlatePosition()},10)}},{key:"__updatePlatePosition",value:function(){var e=this;setTimeout(function(){var t=F.activeNode,n=e.shadowRoot.querySelector("#right"),o=e.shadowRoot.querySelector("#rightremove");n.disabled=!1,o.disabled=!1,t&&"GRID-PLATE"==t.tagName?"1-1-1-1-1-1"==t.layout&&(n.disabled=!0):o.disabled=!0},100)}},{key:"render",value:function(){this.shadowRoot.innerHTML=null,this.template.innerHTML=this.html,window.ShadyCSS&&window.ShadyCSS.prepareTemplate(this.template,this.tag),this.shadowRoot.appendChild(this.template.content.cloneNode(!0))}},{key:"connectedCallback",value:function(){var e=this;D(P(n.prototype),"connectedCallback",this).call(this),setTimeout(function(){e.shadowRoot.querySelector("#drag").addEventListener("dragstart",e._dragStart),e.shadowRoot.querySelector("#drag").addEventListener("dragend",e._dragEnd)},0)}},{key:"disconnectedCallback",value:function(){this.shadowRoot.querySelector("#drag").removeEventListener("dragstart",this._dragStart),this.shadowRoot.querySelector("#drag").removeEventListener("dragend",this._dragEnd),D(P(n.prototype),"disconnectedCallback",this).call(this)}},{key:"_dragEnd",value:function(e){F._lockContextPosition=!1}},{key:"_dragStart",value:function(e){var t=F.activeNode;F.__dragTarget=t,F._lockContextPosition=!0,t.classList.add("hax-moving"),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move",e.dataTransfer.setDragImage(t,-20,-20)),e.stopPropagation(),e.stopImmediatePropagation()}},{key:"html",get:function(){return'\n    <style>\n    :host {\n      display: block;\n      margin-top: -2px;\n      background-color:white;\n    }\n    hax-context-item {\n      display: block;\n    }\n    hax-context-item[large] {\n      display: inline-block;\n      margin:0;\n      padding:0;\n    }\n    hax-context-item-menu {\n      --hax-context-item-menu-height: 28px;\n    }\n    .area {\n      display: flex;\n      visibility: visible;\n      opacity: .8;\n      transition: .2s all ease-in-out;\n    }\n    .area:hover {\n      opacity: 1;\n    }\n    paper-item {\n      background-color: var(--hax-contextual-action-color);\n      -webkit-justify-content: flex-start;\n      justify-content: flex-start;\n      height: 24px;\n      padding: 0 4px;\n      min-height: 24px;\n      font-size: 10px;\n      color: white;\n    }\n    #drag hax-context-item:hover,\n    paper-item:hover {\n      cursor: pointer;\n      color: black;\n    }\n    iron-icon {\n      padding: 0 2px;\n      width: 16px;\n      height: 16px;\n    }\n    :host(.hax-context-pin-top) .area {\n      position: fixed;\n      top: 40px;\n      margin-left: -30px;\n      flex-direction: column;\n    }\n    </style>\n    <div class="area" id="area">\n      <hax-context-item-menu\n        mini\n        id="drag"\n        action\n        icon="hax:arrow-all"\n        label="Drag handle"\n        draggable="true"\n        selected-value="0"\n        reset-on-select\n        data-simple-tour-stop\n        data-stop-title="label">\n        <paper-item hidden value=""></paper-item>\n        <hax-context-item\n          action\n          mini\n          icon="hardware:keyboard-arrow-up"\n          label="Move up"\n          event-name="hax-plate-up"\n          direction="left"\n          ></hax-context-item>\n        <hax-context-item\n          action\n          mini\n          icon="hardware:keyboard-arrow-down"\n          label="Move down"\n          event-name="hax-plate-down"\n          direction="left"\n          ></hax-context-item>\n        <div slot="tour" data-stop-content>\n          Click the drag handle once to show a menu to just move\n          up or down one item in the content OR click and drag\n          to place the item exactly where you want it to go.\n        </div>\n      </hax-context-item-menu>\n      <hax-context-item\n        mini\n        action\n        id="right"\n        class="paddle"\n        icon="hax:table-column-remove"\n        label="Add column"\n        event-name="hax-plate-create-right"\n        data-simple-tour-stop\n        data-stop-title="label"\n      >\n      <div slot="tour" data-stop-content>\n      Add a column to split the current column into two pieces. This can be done up to\n      six pieces columns. For differnet layouts see Grid settings panel.\n      </div>\n    </hax-context-item>\n    <hax-context-item\n      mini\n      action\n      class="paddle"\n      icon="hax:table-column-plus-after"\n      label="Remove column"\n      event-name="hax-plate-remove-right"\n      id="rightremove"\n      data-simple-tour-stop\n      data-stop-title="label"\n    >\n    <div slot="tour" data-stop-content>\n      Remove a column from the split column layout. If at two columns and removing it will\n      remove the layout split and make it 100% width.\n    </div>\n    </hax-context-item>\n  <hax-context-item\n    mini\n    action\n    label="Duplicate"\n    icon="icons:content-copy"\n    event-name="hax-plate-duplicate"\n    data-simple-tour-stop\n    data-stop-title="label"\n    >\n    <div slot="tour" data-stop-content>\n      Duplicate the active piece of content and place it below the current item.\n    </div>\n    </hax-context-item>\n  <hax-context-item\n    mini\n    action\n    icon="delete"\n    label="Remove"\n    event-name="hax-plate-delete"\n    data-simple-tour-stop\n    data-stop-title="label"\n  >\n  <div slot="tour" data-stop-content>\n      Delete the current item. You can always use the undo arrow to bring this back.\n    </div>\n  </hax-context-item>\n  </div>\n  '}}],[{key:"tag",get:function(){return"hax-plate-context"}}]),n}();function K(){var e=I(['\n      <hax-toolbar hide-more>\n        <hax-context-item\n          mini\n          action\n          more\n          slot="prefix"\n          icon="','"\n          label="',', click to change"\n          ?disabled="','"\n          event-name="hax-transform-node"\n        ></hax-context-item>\n        <slot slot="primary"></slot>\n      </hax-toolbar>\n    ']);return K=function(){return e},e}function J(){var e=I(["\n        :host *[hidden] {\n          display: none;\n        }\n        :host {\n          display: block;\n        }\n        hax-context-item {\n          margin: 0;\n        }\n        :host(.hax-context-pin-top) hax-toolbar {\n          position: fixed;\n          top: 40px;\n          flex-direction: column;\n        }\n      "]);return J=function(){return e},e}window.customElements.define(Y.tag,Y);var $=function(e){A(n,a.winEventsElement(h.LitElement));var t=j(n);function n(){var e;return k(this,n),(e=t.call(this)).__winEvents={"hax-store-property-updated":"_haxStorePropertyUpdated"},e.haxProperties={},setTimeout(function(){},0),e}return T(n,null,[{key:"styles",get:function(){return[h.css(J())]}}]),T(n,[{key:"_haxStorePropertyUpdated",value:function(e){var t=this;e.detail&&"undefined"!==w(e.detail.value)&&e.detail.property&&"activeNode"===e.detail.property&&setTimeout(function(){t._computeValues()},0)}},{key:"render",value:function(){return h.html(K(),this.activeTagIcon,this.activeTagName,this.disableTransform)}},{key:"_computeValues",value:function(){null!=F.activeNode?F.isTextElement(F.activeNode)||("GRID-PLATE"==F.activeNode.tagName?(this.disableTransform=!0,this.activeTagName="Grid",this.activeTagIcon="hax:3/3/3/3"):(this.disableTransform=!F.activeHaxBody.canTansformNode(F.activeNode),F.activeGizmo&&(this.activeTagName=F.activeGizmo.title,this.activeTagIcon=F.activeGizmo.icon))):(this.activeTagName="",this.activeTagIcon="")}}],[{key:"tag",get:function(){return"hax-ce-context"}},{key:"properties",get:function(){return{disableTransform:{type:Boolean},activeTagIcon:{type:String},activeTagName:{type:String}}}}]),n}();function Q(){var e=I([' <paper-item slot="options" value="','">\n                <iron-icon icon="','"></iron-icon>\n                ',"\n              </paper-item>"]);return Q=function(){return e},e}function Z(){var e=I(['\n      <hax-toolbar\n        .selected="','"\n        ?hide-more="','"\n        id="toolbar"\n      >\n        <simple-popover-selection\n          slot="primary"\n          @simple-popover-selection-changed="','"\n          auto\n          orientation="tb"\n          id="textformat"\n        >\n          <style slot="style">\n            simple-popover-manager paper-item {\n              color: black;\n              font-size: 10px !important;\n              margin: 0;\n              padding: 2px;\n              min-height: unset;\n            }\n            simple-popover-manager paper-item iron-icon {\n              width: 18px;\n              margin-right: 8px;\n            }\n          </style>\n          <hax-context-item\n            action\n            mini\n            slot="button"\n            id="formatsize"\n            icon="','"\n            label="Text format"\n            data-simple-tour-stop\n            data-stop-title="label"\n          >\n            <div slot="tour" data-stop-content>\n              Change how the text is structured and visualized in the page.\n            </div>\n          </hax-context-item>\n          ','\n        </simple-popover-selection>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:format-list-bulleted"\n          event-name="text-tag-ul"\n          label="Bulleted list"\n          .hidden="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:format-list-numbered"\n          label="Numbered list"\n          event-name="text-tag-ol"\n          .hidden="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:format-indent-decrease"\n          label="Outdent"\n          event-name="text-outdent"\n          .hidden="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:format-indent-increase"\n          label="Indent"\n          event-name="text-indent"\n          .hidden="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:format-bold"\n          label="Bold"\n          class="selected-buttons"\n          event-name="text-bold"\n          ?disabled="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:format-italic"\n          label="Italic"\n          class="selected-buttons"\n          event-name="text-italic"\n          ?disabled="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:insert-link"\n          label="Link"\n          class="selected-buttons"\n          event-name="text-link"\n          ?disabled="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="mdextra:unlink"\n          label="Remove link"\n          class="selected-buttons"\n          event-name="text-unlink"\n          ?disabled="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="editor:format-clear"\n          label="Remove format"\n          class="selected-buttons"\n          event-name="text-remove-format"\n          ?disabled="','"\n        ></hax-context-item-textop>\n        <hax-context-item\n          mini\n          action\n          slot="primary"\n          icon="hax:add-brick"\n          label="Add element to selection"\n          class="selected-buttons"\n          event-name="insert-inline-gizmo"\n          ?hidden="','"\n        ></hax-context-item>\n        <hax-context-item-textop\n          mini\n          action\n          slot="primary"\n          icon="hax:add-brick"\n          label="Add element to selection"\n          class="selected-buttons"\n          event-name="insert-inline-gizmo"\n          ?hidden="','"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          action\n          menu\n          slot="more"\n          icon="mdextra:subscript"\n          event-name="text-subscript"\n          >Subscript</hax-context-item-textop\n        >\n        <hax-context-item-textop\n          action\n          menu\n          slot="more"\n          icon="mdextra:superscript"\n          event-name="text-superscript"\n          >Superscript</hax-context-item-textop\n        >\n        <hax-context-item-textop\n          action\n          menu\n          slot="more"\n          icon="editor:format-underlined"\n          event-name="text-underline"\n          >Underline</hax-context-item-textop\n        >\n        <hax-context-item-textop\n          action\n          menu\n          slot="more"\n          icon="editor:format-strikethrough"\n          event-name="text-strikethrough"\n          >Cross out</hax-context-item-textop\n        >\n      </hax-toolbar>\n    ']);return Z=function(){return e},e}function ee(){var e=I(["\n        :host {\n          display: block;\n          pointer-events: none;\n        }\n        hax-context-item-textop:not(:defined),\n        hax-context-item-menu:not(:defined),\n        hax-context-item:not(:defined),\n        hax-toolbar:not(:defined),\n        paper-item:not(:defined),\n        iron-icon:not(:defined) {\n          display: none;\n        }\n        :host [hidden] {\n          display: none;\n        }\n        simple-popover-selection {\n          display: inline-flex;\n        }\n        .selected-buttons {\n          transition: 0.1s all ease-in-out;\n          width: 0;\n        }\n        :host([has-selected-text]) .selected-buttons {\n          width: 100%;\n        }\n        #toolbar {\n          overflow: hidden;\n        }\n        paper-item {\n          color: black;\n          -webkit-justify-content: flex-start;\n          justify-content: flex-start;\n          font-size: 11px;\n          line-height: 24px;\n          margin: 0;\n          padding: 0 4px;\n          min-height: 24px;\n        }\n        paper-item:hover {\n          cursor: pointer;\n          color: black;\n        }\n        iron-icon {\n          width: 20px;\n          height: 20px;\n          padding: 4px;\n        }\n        hax-context-item-textop,\n        hax-context-item {\n          transition: all 0.2s linear;\n          visibility: visible;\n          opacity: 1;\n        }\n        hax-context-item-textop[hidden],\n        hax-context-item[hidden] {\n          visibility: hidden;\n          opacity: 0;\n        }\n        :host(.hax-context-pin-top) hax-toolbar {\n          position: fixed;\n          top: 40px;\n          flex-direction: column;\n        }\n      "]);return ee=function(){return e},e}window.customElements.define($.tag,$);var te=function(e){A(n,r.SimpleTourFinder(a.winEventsElement(h.LitElement)));var t=j(n);function n(){var e;return k(this,n),(e=t.call(this)).tourName="hax",e.__winEvents={"hax-store-property-updated":"_haxStorePropertyUpdated"},setTimeout(function(){e.addEventListener("hax-context-item-selected",e._haxContextOperation.bind(q(e)))},0),e.formattingList=[{value:"p",icon:"hax:paragraph",text:"Paragraph"},{value:"ul",icon:"editor:format-list-bulleted",text:"Bulleted list"},{value:"ol",icon:"editor:format-list-numbered",text:"Numbered list"},{value:"h2",icon:"hax:h2",text:"Title"},{value:"h3",icon:"hax:h3",text:"Content heading"},{value:"h4",icon:"hax:h4",text:"Subheading"},{value:"h5",icon:"hax:h5",text:"Deep subheading"},{value:"blockquote",icon:"editor:format-quote",text:"Blockquote"},{value:"code",icon:"icons:code",text:"Code"}],e.realSelectedValue="p",e.selection=!1,e.formatIcon="hax:format-textblock",e.isSafari=e._isSafari(),e}return T(n,null,[{key:"styles",get:function(){return[h.css(ee())]}}]),T(n,[{key:"_haxStorePropertyUpdated",value:function(e){e.detail&&"undefined"!==w(e.detail.value)&&e.detail.property&&(this[e.detail.property]=e.detail.value),"activeNode"==e.detail.property&&F.isTextElement(e.detail.value)&&this.shadowRoot.querySelector('#textformat paper-item[value="'+e.detail.value.tagName.toLowerCase()+'"]')&&(this.shadowRoot.querySelector("simple-popover-selection").opened&&(this.shadowRoot.querySelector("simple-popover-selection").opened=!1),this.updateTextIconSelection(e.detail.value.tagName.toLowerCase()))}},{key:"render",value:function(){return h.html(Z(),this.selection,!this.hasSelectedText,this.textFormatChanged,this.formatIcon,this.formattingList.map(function(e){return h.html(Q(),e.value,e.icon,e.text)}),!this._showLists,!this._showLists,!this._showIndent,!this._showIndent,!this.hasSelectedText,!this.hasSelectedText,!this.hasSelectedText,!this.hasSelectedText,!this.hasSelectedText,this.isSafari||!this.hasSelectedText,!this.isSafari||!this.hasSelectedText)}},{key:"textFormatChanged",value:function(e){this.updateTextIconSelection(e.detail.getAttribute("value"))}},{key:"updateTextIconSelection",value:function(e){this.realSelectedValue=e,this.shadowRoot.querySelector("[data-simple-popover-selection-active]")&&this.shadowRoot.querySelector("[data-simple-popover-selection-active]").removeAttribute("data-simple-popover-selection-active");var t=this.shadowRoot.querySelector('#textformat paper-item[value="'+this.realSelectedValue+'"]');t.setAttribute("data-simple-popover-selection-active",!0),this.formatIcon=t.querySelector("iron-icon").getAttribute("icon")}},{key:"updated",value:function(e){var t=this;e.forEach(function(e,n){"realSelectedValue"==n&&t.shadowRoot&&(t._showIndent=t._computeShowIndent(t.realSelectedValue),"p"==t.realSelectedValue?t._showLists=!0:t._showLists=!1,t.dispatchEvent(new CustomEvent("hax-context-item-selected",{bubbles:!0,cancelable:!0,composed:!0,detail:{eventName:"text-tag",value:t.realSelectedValue}}))),"haxSelectedText"==n&&(t.hasSelectedText=t[n].length>0)})}},{key:"_computeShowIndent",value:function(e){return!(!F.computePolyfillSafe()||"ol"!=e&&"ul"!=e)}},{key:"_haxContextOperation",value:function(e){var t=e.detail,n=F.getSelection(),o=!1;switch(t.eventName){case"close-menu":this.shadowRoot.querySelector("simple-popover-selection").opened&&(this.shadowRoot.querySelector("simple-popover-selection").opened=!1);break;case"insert-inline-gizmo":if(F._tmpSelection&&F.editMode)try{"HAX-BODY"!==F._tmpRange.startContainer.parentNode.parentNode.tagName&&"HAX-BODY"!==F._tmpRange.startContainer.parentNode.parentNode.parentNode.tagName||(F.activePlaceHolder=F._tmpRange,F.write("activePlaceHolder",F._tmpRange,this))}catch(e){}if(null!=F.activePlaceHolder){var i={text:F.activePlaceHolder.toString()},a=F.guessGizmo("inline",i);a.length>0&&F.haxAppPicker.presentOptions(a,"inline","Transform selected text to..","gizmo")}break;case"text-bold":document.execCommand("bold"),o=!0;break;case"text-italic":document.execCommand("italic"),o=!0;break;case"text-underline":document.execCommand("underline"),o=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-subscript":document.execCommand("subscript"),o=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-superscript":document.execCommand("superscript"),o=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-remove-format":document.execCommand("removeFormat"),o=!0;break;case"text-strikethrough":document.execCommand("strikeThrough"),o=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-link":var r="";n&&n.focusNode&&n.focusNode.parentNode&&"undefined"!==w(n.focusNode.parentNode.href)&&(r=n.focusNode.parentNode.href);var s=prompt("Enter a URL:",r);s&&(document.execCommand("createLink",!1,s),n.focusNode.parentNode&&(n.focusNode.parentNode.setAttribute("contenteditable",!0),n.focusNode.parentNode.removeEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),n.focusNode.parentNode.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()})),o=!0);break;case"text-unlink":document.execCommand("unlink"),o=!0;break;case"text-indent":document.execCommand("indent"),o=!0;break;case"text-outdent":document.execCommand("outdent"),o=!0}o&&(e.preventDefault(),e.stopPropagation())}},{key:"_isSafari",value:function(){var e=navigator.userAgent.toLowerCase();return!(-1==e.indexOf("safari")||e.indexOf("chrome")>-1)}}],[{key:"tag",get:function(){return"hax-text-context"}},{key:"properties",get:function(){return{_showIndent:{type:Boolean},_showLists:{type:Boolean},realSelectedValue:{type:String},formattingList:{type:Array},hasSelectedText:{type:Boolean,attribute:"has-selected-text",reflect:!0},haxSelectedText:{type:String},selection:{type:Boolean},formatIcon:{type:String,attribute:"format-icon"},isSafari:{type:Boolean,attribute:"is-safari"}}}}]),n}();function ne(){var e=I(['\n      <div id="bodycontainer" class="ignore-activation">\n        <slot id="body"></slot>\n      </div>\n      <hax-text-context\n        id="textcontextmenu"\n        class="hax-context-menu ignore-activation"\n      ></hax-text-context>\n      <hax-ce-context\n        id="cecontextmenu"\n        class="hax-context-menu ignore-activation"\n      ></hax-ce-context>\n      <hax-plate-context\n        id="platecontextmenu"\n        class="hax-context-menu ignore-activation"\n      ></hax-plate-context>\n    ']);return ne=function(){return e},e}function oe(){var e=I(['\n        :host([edit-mode]),\n        :host([edit-mode]) * ::slotted(*) {\n          line-height: 1.8;\n        }\n        :host([edit-mode]) ul,\n        :host([edit-mode]) ol {\n          padding-left: 20px;\n          margin-left: 20px;\n        }\n        :host([edit-mode]) ul {\n          list-style-type: disc;\n        }\n        :host([edit-mode]) li {\n          margin-bottom: 6px;\n        }\n        :host {\n          display: block;\n          position: relative;\n          min-height: 32px;\n          min-width: 32px;\n          outline: none;\n          --hax-contextual-action-text-color: var(\n            --simple-colors-default-theme-grey-1,\n            #fff\n          );\n          --hax-contextual-action-hover-color: var(\n            --simple-colors-default-theme-cyan-7,\n            #009dc7\n          );\n          --hax-contextual-action-color: var(\n            --simple-colors-default-theme-grey-12,\n            #007999\n          );\n          --hax-body-editable-outline: 0px solid\n            var(--simple-colors-default-theme-grey-4, #eeeeee);\n          --hax-body-active-outline-hover: 1px solid\n            var(--simple-colors-default-theme-grey-4, #eeeeee);\n          --hax-body-active-outline: 0px solid\n            var(\n              --hax-contextual-action-hover-color,\n              var(--simple-colors-default-theme-cyan-7, #009dc7)\n            );\n          --hax-body-active-drag-outline: 1px solid\n            var(\n              --hax-contextual-action-hover-color,\n              var(--simple-colors-default-theme-cyan-7, #009dc7)\n            );\n          --hax-body-target-background-color: var(\n            --simple-colors-default-theme-cyan-7,\n            #009dc7\n          );\n          --hax-body-possible-target-background-color: inherit;\n        }\n        .hax-context-menu {\n          padding: 0;\n          margin-left: -5000px;\n          position: fixed;\n          visibility: hidden;\n          opacity: 0;\n          z-index: 1000;\n          float: left;\n          display: block;\n          pointer-events: none;\n          transition: 0.2s top ease-in-out, 0.2s left ease-in-out,\n            0.2s visibility ease-in-out, 0.2s opacity ease-in-out;\n        }\n        #textcontextmenu.hax-context-menu {\n          z-index: 1000;\n        }\n        .hax-context-visible {\n          position: absolute;\n          visibility: visible;\n          pointer-events: all;\n          opacity: 1;\n        }\n        .hax-context-visible.hax-active-hover {\n          margin-left: unset;\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(p) {\n          min-height: var(--hax-base-styles-p-min-height, 1rem);\n          font-size: var(--hax-base-styles-p-font-size);\n          line-height: var(--hax-base-styles-p-line-height);\n          letter-spacing: var(--hax-base-styles-p-letter-spacing);\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(a) {\n          color: var(--hax-base-styles-a-color);\n          font-size: var(\n            --hax-base-styles-a-font-size,\n            var(--hax-base-styles-p-font-size)\n          );\n          font-weight: var(--hax-base-styles-a-font-weight);\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(a:visited) {\n          color: var(--hax-base-styles-a-color-visited);\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(a:active),\n        :host([edit-mode]) #bodycontainer ::slotted(a:focus),\n        :host([edit-mode]) #bodycontainer ::slotted(a:hover) {\n          color: var(--hax-base-styles-a-color-active);\n          font-weight: var(--hax-base-styles-a-font-weight-active);\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(ol),\n        :host([edit-mode]) #bodycontainer ::slotted(ul),\n        :host([edit-mode]) #bodycontainer ::slotted(li) {\n          padding-bottom: var(--hax-base-styles-list-padding-bottom);\n          line-height: var(\n            --hax-base-styles-list-line-height,\n            var(--hax-base-styles-p-line-height)\n          );\n          font-size: var(\n            --hax-base-styles-list-font-size,\n            var(--hax-base-styles-p-font-size)\n          );\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(ol > li:last-child),\n        :host([edit-mode]) #bodycontainer ::slotted(ul > li:last-child) {\n          padding-bottom: var(--hax-base-styles-list-last-child-padding-bottom);\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(img[contenteditable]) {\n          max-width: 100%;\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(*[contenteditable]) {\n          outline: none;\n          caret-color: var(--hax-color-text);\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(*.blinkfocus) {\n          outline: 8px solid var(--hax-contextual-action-hover-color);\n        }\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*:not(grid-plate)[contenteditable]:hover) {\n          outline: var(--hax-body-active-outline-hover);\n          caret-color: #000000;\n        }\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*.hax-active[contenteditable]:hover) {\n          cursor: text !important;\n          outline: var(--hax-body-active-outline-hover);\n        }\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*:not(grid-plate)[contenteditable] .hax-active:hover) {\n          cursor: text !important;\n          outline: var(--hax-body-active-outline-hover);\n        }\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(code.hax-active[contenteditable]) {\n          display: block;\n        }\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*.hax-active[contenteditable]) {\n          outline: var(--hax-body-active-outline) !important;\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(hr[contenteditable]) {\n          height: 2px;\n          background-color: #eeeeee;\n          padding-top: 4px;\n          padding-bottom: 4px;\n        }\n        /** Fix to support safari as it defaults to none */\n        :host([edit-mode]) #bodycontainer ::slotted(*[contenteditable]) {\n          -webkit-user-select: text;\n          cursor: pointer;\n        }\n\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*[contenteditable]::-moz-selection),\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*[contenteditable] *::-moz-selection) {\n          background-color: var(--hax-body-highlight, --paper-yellow-300);\n          color: black;\n        }\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*[contenteditable]::selection),\n        :host([edit-mode])\n          #bodycontainer\n          ::slotted(*[contenteditable] *::selection) {\n          background-color: var(--hax-body-highlight, --paper-yellow-300);\n          color: black;\n        }\n        #bodycontainer {\n          -webkit-user-select: text;\n          user-select: text;\n        }\n        :host([edit-mode][hax-ray-mode])\n          #bodycontainer\n          ::slotted(*[contenteditable]):before {\n          content: attr(data-hax-ray) " " attr(resource) " " attr(typeof) " "\n            attr(property) " " attr(content);\n          font-size: 12px;\n          line-height: 12px;\n          left: unset;\n          right: unset;\n          top: unset;\n          background-color: var(--simple-colors-default-theme-cyan-7, #3b97e3);\n          color: #ffffff;\n          bottom: unset;\n          width: auto;\n          padding: 6px;\n          margin: -2px;\n          z-index: 1;\n          margin: 0;\n          float: right;\n        }\n        .hax-context-menu:not(:defined) {\n          display: none;\n        }\n        /* drag and drop */\n        :host([edit-mode]) #bodycontainer ::slotted(*.hax-moving) {\n          outline: var(--hax-body-active-drag-outline);\n        }\n        :host([edit-mode][hax-mover]) #bodycontainer ::slotted(*):before {\n          outline: 1px var(--simple-colors-default-theme-grey-2) solid;\n          background-color: var(--hax-body-possible-target-background-color);\n          content: " ";\n          width: 100%;\n          display: block;\n          position: relative;\n          margin: -20px 0 0 0;\n          z-index: 2;\n          height: 20px;\n        }\n        :host([edit-mode][hax-mover]) #bodycontainer ::slotted(img) {\n          outline: var(--hax-body-editable-outline);\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(img.hax-hovered),\n        :host([edit-mode]) #bodycontainer ::slotted(*.hax-hovered):before {\n          background-color: var(--hax-body-target-background-color) !important;\n          outline: var(--hax-body-active-drag-outline);\n        }\n        :host([edit-mode]) #bodycontainer ::slotted(img.hax-hovered) {\n          border-top: 10px\n            var(\n              --hax-contextual-action-hover-color,\n              var(--simple-colors-default-theme-cyan-7, #009dc7)\n            );\n          margin-top: -10px;\n        }\n\n        @media screen and (min-color-index: 0) and(-webkit-min-device-pixel-ratio:0) {\n          /*\n            Define here the CSS styles applied only to Safari browsers\n            (any version and any device) via https://solvit.io/bcf61b6\n          */\n          :host([edit-mode][hax-mover]) #bodycontainer ::slotted(*) {\n            outline: var(--hax-body-editable-outline);\n            background-color: var(--hax-body-possible-target-background-color);\n          }\n          :host([edit-mode]) #bodycontainer ::slotted(*.hax-hovered) {\n            background-color: var(\n              --hax-body-target-background-color\n            ) !important;\n            outline: var(--hax-body-active-outline);\n          }\n        }\n      ']);return oe=function(){return e},e}window.customElements.define(te.tag,te);var ie=null,ae=25,re=200,se=function(e){A(n,y.UndoManagerBehaviors(b.SimpleColors));var t=j(n);function n(){var e;return k(this,n),(e=t.call(this)).__mouseMoving=!1,e.___moveLock=!1,e.editMode=!1,e.haxMover=!1,e.globalPreferences={},e.haxRayMode=!1,e.activeNode=null,e.haxSelectedText="",setTimeout(function(){e.polyfillSafe=F.computePolyfillSafe(),e.addEventListener("hax-context-item-selected",e._haxContextOperation.bind(q(e))),e.addEventListener("place-holder-replace",e.replacePlaceholder.bind(q(e))),e.addEventListener("focusin",e._focusIn.bind(q(e))),e.addEventListener("mousedown",e._mouseDown.bind(q(e))),e.addEventListener("mouseup",e._mouseUp.bind(q(e))),e.addEventListener("dragenter",e.dragEnterBody.bind(q(e))),e.addEventListener("dragend",e.dragEndBody.bind(q(e))),e.addEventListener("drop",e.dropEvent.bind(q(e))),e.addEventListener("click",e.clickEvent.bind(q(e)))},0),e}return T(n,null,[{key:"styles",get:function(){return[].concat(B(D(P(n),"styles",this)),[h.css(oe())])}}]),T(n,[{key:"dragEndBody",value:function(e){this.__manageFakeEndCap(!1),F._lockContextPosition=!1;var t=F.activeHaxBody.children;for(var n in t)"undefined"!==w(t[n].classList)&&t[n].classList.remove("hax-hovered","hax-moving","grid-plate-active-item")}},{key:"_mouseDown",value:function(e){this.__mouseDown=!0;var t=e.target;this.__focusLogic(t)&&(e.stopPropagation(),e.stopImmediatePropagation())}},{key:"_mouseUp",value:function(e){var t=this;setTimeout(function(){t.__mouseDown=!1},0),clearTimeout(ie),this.__manageFakeEndCap(!1)}},{key:"clickEvent",value:function(e){clearTimeout(ie)}},{key:"__manageFakeEndCap",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e&&!this.__fakeEndCap){var t=document.createElement("fake-hax-body-end");t.style.width="100%",t.style.height="20px",t.style.zIndex="2",t.style.display="block",t.classList.add("hax-move"),this.__fakeEndCap=t,this.haxMover=!0,this.appendChild(this.__fakeEndCap)}else!e&&this.__fakeEndCap&&(this.__fakeEndCap.remove(),this.haxMover=!1,this.__fakeEndCap=null)}},{key:"dragEnterBody",value:function(e){this.__manageFakeEndCap(!0)}},{key:"render",value:function(){return h.html(ne())}},{key:"firstUpdated",value:function(e){var t=this;this.dispatchEvent(new CustomEvent("hax-register-body",{bubbles:!0,cancelable:!0,composed:!0,detail:this}));try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("defaultParagraphSeparator",!1,"p")}catch(e){console.warn(e)}this.shadowRoot.querySelector("slot").addEventListener("mousemove",this.hoverEvent.bind(this)),this.shadowRoot.querySelector("slot").addEventListener("mouseup",function(e){!t.openDrawer&&t.editMode&&setTimeout(function(){var e=F.getSelection();F._tmpSelection=e,F.write("haxSelectedText",e.toString(),t);try{var n=F.getRange();n.cloneRange&&(F._tmpRange=n.cloneRange())}catch(e){console.warn(e)}},10)}),this.editMode=F.editMode,this.__tabTrap=!1,this.__ready=!0,D(P(n.prototype),"firstUpdated",this)&&D(P(n.prototype),"firstUpdated",this).call(this,e)}},{key:"updated",value:function(e){var t=this;e.forEach(function(e,n){"editMode"==n&&t._editModeChanged(t[n],e),"globalPreferences"==n&&t._globalPreferencesUpdated(t[n],e),"activeNode"==n&&t.__ready&&t._activeNodeChanged(t[n],e)}),D(P(n.prototype),"updated",this)&&D(P(n.prototype),"updated",this).call(this,e)}},{key:"connectedCallback",value:function(){var e=this;D(P(n.prototype),"connectedCallback",this).call(this),this._observer=new MutationObserver(function(t){var n=!1;e.__mouseMoving||e.undoStackIgnore||e.__fakeEndCap?e.undoStackIgnore&&t.forEach(function(t){t.addedNodes.length>0&&t.addedNodes.forEach(function(t){e._validElementTest(t)&&setTimeout(function(){e.__applyNodeEditableState(t,e.editMode)},0)})}):t.forEach(function(t){t.addedNodes.length>0&&t.addedNodes.forEach(function(t){e._validElementTest(t)&&(!e.editMode||"true"!=t.getAttribute("contenteditable")&&!0!==t.getAttribute("contenteditable")&&"contenteditable"!=t.getAttribute("contenteditable")||e.__applyNodeEditableState(t,!e.editMode),e.__applyNodeEditableState(t,e.editMode),e.dispatchEvent(new CustomEvent("hax-body-tag-added",{bubbles:!0,cancelable:!0,composed:!0,detail:{node:t}})),["H1","H2","H3","H4","H5","H6"].includes(t.tagName)&&null==t.getAttribute("id")&&t.setAttribute("id",a.generateResourceID("header-")),e.___moveLock||n?e.___moveLock=!1:(n=!0,e.activeNode=t,F.write("activeNode",t,e)))}),t.removedNodes.length>0&&t.removedNodes.forEach(function(t){e._validElementTest(t)&&!t.classList.contains("hax-active")&&e.dispatchEvent(new CustomEvent("hax-body-tag-removed",{bubbles:!0,cancelable:!0,composed:!0,detail:{node:t}}))})})}),this._observer.observe(this,{childList:!0}),setTimeout(function(){window.addEventListener("keydown",e._onKeyDown.bind(e)),window.addEventListener("keypress",e._onKeyPress.bind(e)),document.body.addEventListener("hax-store-property-updated",e._haxStorePropertyUpdated.bind(e)),window.addEventListener("scroll",e._keepContextVisible.bind(e)),window.addEventListener("resize",e._keepContextVisible.bind(e))},0)}},{key:"disconnectedCallback",value:function(){window.removeEventListener("keydown",this._onKeyDown.bind(this)),window.removeEventListener("keypress",this._onKeyPress.bind(this)),document.body.removeEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),window.removeEventListener("scroll",this._keepContextVisible.bind(this)),window.removeEventListener("resize",this._keepContextVisible.bind(this)),this._observer.disconnect(),D(P(n.prototype),"disconnectedCallback",this).call(this)}},{key:"_keepContextVisible",value:function(){var e=this;!this.openDrawer&&this.editMode&&(clearTimeout(this.__contextVisibleLock),this.__contextVisibleLock=setTimeout(function(){var t=!1;e.shadowRoot.querySelector("#textcontextmenu").classList.contains("hax-context-visible")?t=e.shadowRoot.querySelector("#textcontextmenu"):e.shadowRoot.querySelector("#cecontextmenu").classList.contains("hax-context-visible")&&(t=e.shadowRoot.querySelector("#cecontextmenu")),t&&(e.elementMidViewport()?(t.classList.add("hax-context-pin-top"),e.shadowRoot.querySelector("#platecontextmenu").classList.add("hax-context-pin-top")):(t.classList.remove("hax-context-pin-top"),e.shadowRoot.querySelector("#platecontextmenu").classList.remove("hax-context-pin-top")),e.positionContextMenus())},50))}},{key:"_onKeyDown",value:function(e){var t=this;if(!this.openDrawer&&this.editMode&&this.getAttribute("contenteditable")&&null!=F.getSelection().anchorNode){switch(e.key){case"Tab":F.isTextElement(this.activeNode)&&(e.detail.keyboardEvent&&(e.detail.keyboardEvent.preventDefault(),e.detail.keyboardEvent.stopPropagation(),e.detail.keyboardEvent.stopImmediatePropagation()),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.shiftKey?this._tabBackKeyPressed():this._tabKeyPressed());break;case"Enter":this.setAttribute("contenteditable",!0);case"Backspace":case"Delete":case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":setTimeout(function(){var e=F.getSelection();F._tmpSelection=e,F.write("haxSelectedText",e.toString(),t);var n=F.getRange();n.commonAncestorContainer&&t.activeNode!==n.commonAncestorContainer&&"function"==typeof n.commonAncestorContainer.focus?"HAX-BODY"!==n.commonAncestorContainer.tagName&&(F.isTextElement(n.commonAncestorContainer)?t.setAttribute("contenteditable",!0):t.removeAttribute("contenteditable"),n.commonAncestorContainer.focus(),t.__focusLogic(n.commonAncestorContainer)):n.commonAncestorContainer&&n.commonAncestorContainer.parentNode&&t.activeNode!==n.commonAncestorContainer.parentNode&&"function"==typeof n.commonAncestorContainer.parentNode.focus&&("HAX-BODY"!==n.commonAncestorContainer.parentNode.tagName?(F.isTextElement(n.commonAncestorContainer.parentNode)?t.setAttribute("contenteditable",!0):t.removeAttribute("contenteditable"),n.commonAncestorContainer.parentNode.focus(),t.__focusLogic(n.commonAncestorContainer.parentNode)):(t.activeNode=n.commonAncestorContainer,F.write("activeNode",n.commonAncestorContainer,t),t.positionContextMenus()))},50)}this.shadowRoot.querySelector("#platecontextmenu").classList.contains("hax-active-hover")&&this.__dropActiveHover()}}},{key:"_onKeyPress",value:function(e){var t=this;clearTimeout(this.__keyPress),this.__keyPress=setTimeout(function(){!t.openDrawer&&t.editMode&&t.shadowRoot.querySelector("#textcontextmenu").classList.contains("hax-active-hover")&&t.activeNode&&F.isTextElement(t.activeNode)?t.__dropActiveHover():!t.openDrawer&&t.editMode&&t.activeNode&&F.isTextElement(t.activeNode)&&(clearTimeout(t.__positionContextTimer),t.__positionContextTimer=setTimeout(function(){t.positionContextMenus()},2500))},50)}},{key:"hoverEvent",value:function(e){if(!this.openDrawer&&this.editMode&&(e.target&&null!=e.target.getAttribute("data-hax-ray")?this.__activeHover=e.target:e.target&&e.target.parentNode&&null!=e.target.parentNode.getAttribute("data-hax-ray")&&(this.__activeHover=e.target.parentNode),!this.shadowRoot.querySelector("#platecontextmenu").classList.contains("hax-active-hover"))){var t=e.target;e.target===this.shadowRoot.querySelector("#cecontextmenu")||e.target===this.shadowRoot.querySelector("#textcontextmenu")||e.target===this.shadowRoot.querySelector("#platecontextmenu")||t===this.activeNode||t===this.activeNode.parentNode||e.target===this.activeNode||e.target===this.activeNode.parentNode||t.parentNode===this.activeNode.parentNode||t.parentNode.parentNode===this.activeNode.parentNode||t.parentNode.parentNode.parentNode===this.activeNode.parentNode?(this.positionContextMenus(),this.__addActiveHover(),this.__typeLock=!1):this.__dropActiveHover()}}},{key:"__addActiveHover",value:function(){this.shadowRoot.querySelector("#cecontextmenu").classList.add("hax-active-hover"),this.shadowRoot.querySelector("#textcontextmenu").classList.add("hax-active-hover"),this.shadowRoot.querySelector("#platecontextmenu").classList.add("hax-active-hover")}},{key:"__dropActiveHover",value:function(){this.shadowRoot.querySelector("#cecontextmenu").classList.remove("hax-active-hover"),this.shadowRoot.querySelector("#textcontextmenu").classList.remove("hax-active-hover"),this.shadowRoot.querySelector("#platecontextmenu").classList.remove("hax-active-hover")}},{key:"elementMidViewport",value:function(){var e=this.activeNode.getBoundingClientRect().y;return e<0&&e>-1*this.activeNode.offsetHeight+140}},{key:"replacePlaceholder",value:function(e){if("text"===e.detail){var t=document.createElement("p");t.innerHTML="<br/>",this.haxReplaceNode(this.activeNode,t),this.activeNode.parentNode.setAttribute("contenteditable",!0),this.__focusLogic(t)}else this.replaceElementWorkflow()}},{key:"canTansformNode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.replaceElementWorkflow(e,!0).length>0}},{key:"replaceElementWorkflow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];null==e&&(e=this.activeNode);var n=a.nodeToHaxElement(e,null),o="*",i=!1;"place-holder"===n.tag&&"undefined"!==w(n.properties.type)&&(o=n.properties.type,i=!0);var r={};if("undefined"!==w(F.elementList[n.tag])&&!1!==F.elementList[n.tag].gizmo&&"undefined"!==w(F.elementList[n.tag].gizmo.handles)&&F.elementList[n.tag].gizmo.handles.length>0)for(var s=F.elementList[n.tag].gizmo,l=0;l<s.handles.length;l++)for(var c in s.handles[l])"type"!==c&&"undefined"!==w(n.properties[s.handles[l][c]])&&(r[c]=n.properties[s.handles[l][c]]);var d=F.guessGizmo(o,r,i);if(d.length>0){var u=e.tagName.toLowerCase(),h=u.replace("-"," ");"undefined"!==w(F.elementList[u])&&!1!==F.elementList[u].gizmo&&(h=F.elementList[u].gizmo.title),t||(F.activePlaceHolder=this.activeNode,F.haxAppPicker.presentOptions(d,"__convert","Transform ".concat(h," to.."),"gizmo"))}else t||F.toast("Sorry, this can not be transformed!",5e3);return d}},{key:"_globalPreferencesUpdated",value:function(e,t){"undefined"!==w(e)&&null!=e&&(this.haxRayMode=e.haxRayMode)}},{key:"_haxStorePropertyUpdated",value:function(e){e.detail&&"undefined"!==w(e.detail.value)&&e.detail.property&&(this[e.detail.property]=e.detail.value)}},{key:"haxClearBody",value:function(){var e=!0;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(e=prompt("Are you sure you want to delete all content?")),e&&a.wipeSlot(this)}},{key:"haxInsert",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.__activeHover=null;var o=document.createElement(e);o.innerHTML=t;var i=o.cloneNode(!0);for(var r in n){var s=a.camelToDash(r);n.hasOwnProperty(r)&&(!0===n[r]?i.setAttribute(s,s):!1===n[r]?i.removeAttribute(s):null!=n[r]&&n[r].constructor===Array?i.properties&&i.properties[r].readOnly||(i.set?i.set(s,n[r]):i[s]=n[r]):null!=n[r]&&n[r].constructor===Object?i.properties&&i.properties[r].readOnly||(i.set?i.set(s,n[r]):i[s]=n[r]):i.setAttribute(s,n[r]))}return null!==F.activePlaceHolder&&"undefined"!==w(F.activePlaceHolder.style)?(i.style.width=F.activePlaceHolder.style.width,i.style.float=F.activePlaceHolder.style.float,i.style.margin=F.activePlaceHolder.style.margin,i.style.display=F.activePlaceHolder.style.display,this.haxReplaceNode(F.activePlaceHolder,i),F.activePlaceHolder=null):null!=this.activeNode.parentNode?"GRID-PLATE"===this.activeNode.parentNode.tagName&&this.activeNode.parentNode!==this.activeNode?(null!=this.activeNode.getAttribute("slot")&&i.setAttribute("slot",this.activeNode.getAttribute("slot")),this.activeNode.parentNode.insertBefore(i,this.activeNode)):this.activeNode.parentNode&&this.activeNode.parentNode.nextElementSibling?this.activeNode.parentNode.nextElementSibling.parentNode.insertBefore(i,this.activeNode.parentNode.nextElementSibling):this.activeNode.parentNode?this.activeNode.parentNode.insertBefore(i,this.activeNode):this.appendChild(i):this.appendChild(i),this.shadowRoot.querySelector("#textcontextmenu").highlightOps=!1,this.activeNode=i,F.write("activeNode",i,this),this.scrollHere(i),this.positionContextMenus(),!0}},{key:"haxToContent",value:function(){this.hideContextMenus();var e=this.activeNode;this.activeNode=null,F.write("activeNode",null,this);for(var t="slot"===this.shadowRoot.querySelector("#body").localName?this.shadowRoot.querySelector("#body").assignedNodes({flatten:!0}):[],n="",o=0,i=t.length;o<i;o++)this._validElementTest(t[o])?(t[o].removeAttribute("data-hax-ray"),t[o].classList.remove("hax-moving","hax-hovered","grid-plate-active-item"),t[o].contentEditable=!1,n+=F.nodeToContent(t[o]),"grid-plate"===t[o].tagName.toLowerCase()&&this._applyContentEditable(this.editMode,t[o])):8===t[o].nodeType?n+="\x3c!-- "+t[o].textContent+" --\x3e":1!==t[o].nodeType&&"undefined"!==w(t[o].textContent)&&"undefined"!==t[o].textContent&&(n+=t[o].textContent);if(n=(n=(n=(n=n.replace(/\scontenteditable=\"false\"/g,"")).replace(/\scontenteditable/g,"")).replace(/\sdraggable/g,"")).replace(/\sdata-hax-ray=\".*?\"/g,""),this.parentNode.tagName){var r=this.parentNode.tagName.toLowerCase(),s="style-scope "+r+" x-scope",l=new RegExp(s,"g");n=n.replace(l,""),s="style-scope "+r,l=new RegExp(s,"g"),n=n.replace(l,""),s="x-scope "+r+"-0",l=new RegExp(s,"g"),n=n.replace(l,"");var c=F.validTagList;for(var o in c)s="style-scope "+c[o],l=new RegExp(s,"g"),n=n.replace(l,""),s="x-scope "+c[o]+"-0 ",l=new RegExp(s,"g"),n=n.replace(l,""),s="x-scope "+c[o]+"-0",l=new RegExp(s,"g"),n=n.replace(l,"")}return n=(n=n.replace(/\sclass=\"\"/g,"")).replace(/\sclass=\"\s\"/g,""),this._applyContentEditable(this.editMode),F.write("activeNode",e,this),n=a.encapScript(n)}},{key:"haxDuplicateNode",value:function(e){var t=a.nodeToHaxElement(e,null),n=F.elementList[e.tagName.toLowerCase()];if("undefined"!==w(n)&&"undefined"!==w(n.saveOptions.unsetAttributes))for(var o in n.saveOptions.unsetAttributes)t.properties[n.saveOptions.unsetAttributes[o]]&&delete t.properties[n.saveOptions.unsetAttributes[o]];"undefined"!==w(e.preProcessHaxInsertContent)&&(t=e.preProcessHaxInsertContent(t)),t.content==t.properties.innerHTML&&delete t.properties.innerHTML;var i=a.haxElementToNode({tag:t.tag,content:t.content,properties:t.properties});return"webview"===i.tagName.toLowerCase()&&F._isSandboxed&&"undefined"!==w(i.guestinstance)&&delete i.guestinstance,null!==e?e.parentNode.insertBefore(i,e.nextSibling):e.parentNode.appendChild(i),F.write("activeNode",i,this),!0}},{key:"hideContextMenus",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];clearTimeout(ie),clearTimeout(this.__keyPress),clearTimeout(this.__contextVisibleLock),clearTimeout(this.__positionContextTimer),this._hideContextMenu(this.shadowRoot.querySelector("#textcontextmenu")),this._hideContextMenu(this.shadowRoot.querySelector("#cecontextmenu")),e&&this._hideContextMenu(this.shadowRoot.querySelector("#platecontextmenu")),this.shadowRoot.querySelector("#textcontextmenu").highlightOps=!1}},{key:"positionContextMenus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.activeNode;clearTimeout(this.__positionContextTimer),this.__positionContextTimer=setTimeout(function(){if(t&&!F._lockContextPosition&&e.__ready){var n=140,o=t.tagName.toLowerCase();F._isSandboxed&&"webview"===o&&(o="iframe");var i=F.elementList[o];if("undefined"===w(i)||F.isTextElement(t))e._hideContextMenu(e.shadowRoot.querySelector("#cecontextmenu")),e._positionContextMenu(e.shadowRoot.querySelector("#textcontextmenu"),t,-1,-30),n+=e.shadowRoot.querySelector("#textcontextmenu").getBoundingClientRect().width;else e._hideContextMenu(e.shadowRoot.querySelector("#textcontextmenu")),i.element=t,e._positionContextMenu(e.shadowRoot.querySelector("#cecontextmenu"),t,-1,-30),n+=28;var a=t.getBoundingClientRect();Math.round(n)>=Math.round(a.width)?e._positionContextMenu(e.shadowRoot.querySelector("#platecontextmenu"),t,-1,-58):e._positionContextMenu(e.shadowRoot.querySelector("#platecontextmenu"),t,a.width-e.shadowRoot.querySelector("#platecontextmenu").getBoundingClientRect().width+2,-28),t&&!F.isTextElement(t)?t.removeAttribute("contenteditable"):t&&t.setAttribute("contenteditable",!0)}},10)}},{key:"haxMoveGridPlate",value:function(e,t){switch(this.___moveLock=!0,e){case"up":null!==t.previousElementSibling&&t.parentNode.insertBefore(t,t.previousElementSibling);break;case"down":null!==t.nextElementSibling&&t.parentNode.insertBefore(t.nextElementSibling,t)}return this.scrollHere(t),this.positionContextMenus(t),!0}},{key:"haxGridPlateOps",value:function(){var e=_(regeneratorRuntime.mark(function e(t,n){var o,i,a,r,s,l,c,d,u,h=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=!(h.length>2&&void 0!==h[2])||h[2],i=!1,"GRID-PLATE"!==t.tagName){e.next=49;break}if(!o){e.next=24;break}e.t0=t.layout,e.next="1"===e.t0?7:"1-1"===e.t0?10:"1-1-1"===e.t0?13:"1-1-1-1"===e.t0?16:"1-1-1-1-1"===e.t0?19:22;break;case 7:return t.layout="1-1",i=!0,e.abrupt("break",22);case 10:return t.layout="1-1-1",i=!0,e.abrupt("break",22);case 13:return t.layout="1-1-1-1",i=!0,e.abrupt("break",22);case 16:return t.layout="1-1-1-1-1",i=!0,e.abrupt("break",22);case 19:return t.layout="1-1-1-1-1-1",i=!0,e.abrupt("break",22);case 22:e.next=46;break;case 24:e.t1=t.layout,e.next="1-1"===e.t1?27:"1-1-1"===e.t1?34:"1-1-1-1"===e.t1?37:"1-1-1-1-1"===e.t1?40:"1-1-1-1-1-1"===e.t1?43:46;break;case 27:return e.next=29,t.childNodes.forEach(function(e){e.tagName&&((a=e.cloneNode(!0)).removeAttribute("slot"),a.classList.remove("hax-moving"),t.parentNode.insertBefore(a,t))});case 29:return this.activeNode=a,F.write("activeNode",a,this),setTimeout(function(){t.remove()},0),i=!0,e.abrupt("break",46);case 34:return t.layout="1-1",i=!0,e.abrupt("break",46);case 37:return t.layout="1-1-1",i=!0,e.abrupt("break",46);case 40:return t.layout="1-1-1-1",i=!0,e.abrupt("break",46);case 43:return t.layout="1-1-1-1-1",i=!0,e.abrupt("break",46);case 46:i&&(r=this.shadowRoot.querySelector("#platecontextmenu"),s=r.shadowRoot.querySelector("#right"),l=r.shadowRoot.querySelector("#rightremove"),s.disabled=!1,l.disabled=!1,"1-1-1-1-1-1"==t.layout&&(s.disabled=!0),"left"==n&&t.childNodes.forEach(function(e){if(e.tagName){var t=parseInt(e.getAttribute("slot").replace("col-",""),10)+1;e.setAttribute("slot","col-".concat(t))}})),e.next=59;break;case 49:(c=document.createElement("grid-plate")).layout="1-1",c.disableResponsive=!0,d="2","right"==n&&(d="1"),(u=t.cloneNode(!0)).setAttribute("slot","col-"+d),c.appendChild(u),t.parentNode.insertBefore(c,t),setTimeout(function(){t.remove()},0);case 59:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"haxReplaceNode",value:function(e,t){try{null==e&&(e=this.__oldActiveNode),e.replaceWith(t),e&&e.getAttribute&&null!=e.getAttribute("slot")&&t.setAttribute("slot",e.getAttribute("slot"))}catch(e){console.warn(e)}return t}},{key:"haxChangeTagName",value:function(e,t){for(var n=document.createElement(t),o=0,i=e.attributes.length;o<i;++o){var a=e.attributes.item(o).nodeName,r=e.attributes.item(o).value;n.setAttribute(a,r)}n.innerHTML=e.innerHTML.trim(),"ul"==t||"ol"==t?""==n.innerHTML?n.innerHTML="<li></li>":"ul"!=e.tagName.toLowerCase()&&"ol"!=e.tagName.toLowerCase()&&(n.innerHTML="<li>"+e.innerHTML.trim().replace(/<br\/>/g,"</li>\n<li>").replace(/<br>/g,"</li>\n<li>")+"</li>"):"ul"!=e.tagName.toLowerCase()&&"ol"!=e.tagName.toLowerCase()||(n.innerHTML=n.innerHTML.replace(/<ul>/g,"").replace(/<\/ul>/g,"").replace(/<li><\/li>/g,"").replace(/<li>/g,"").replace(/<\/li>/g,"<br/>"));try{e.replaceWith(n),setTimeout(function(){var e=n.children;e[0]&&e.tagName?e[0].focus():n.focus()},50)}catch(t){console.warn(t),console.warn(n),console.warn(e)}return n}},{key:"haxDeleteNode",value:function(e){if(e.previousElementSibling)this.activeNode=e.previousElementSibling;else if(e.nextElementSibling)this.activeNode=e.nextElementSibling;else{this.haxInsert("p","",{},!1);try{var t=document.createRange(),n=F.getSelection();t.setStart(this.activeNode,0),t.collapse(!0),n.removeAllRanges(),n.addRange(t),this.activeNode.focus()}catch(e){console.warn(e)}}F.write("activeNode",this.activeNode,this);try{return e.remove()}catch(e){console.warn(e)}}},{key:"importContent",value:function(e){var t=this;(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&a.wipeSlot(this,"*"),setTimeout(function(){e=a.encapScript(e);var n=document.createElement("div");for(n.insertAdjacentHTML("beforeend",e);null!==n.firstChild;)if("undefined"!==w(n.firstChild.tagName))if(F._isSandboxed&&"iframe"===n.firstChild.tagName.toLowerCase()){for(var o=document.createElement("webview"),i=0,r=n.firstChild.attributes.length;i<r;++i){var s=n.firstChild.attributes.item(i).nodeName,l=n.firstChild.attributes.item(i).value;"height"!==s&&"width"!==s||o.style[s],o.setAttribute(s,l)}t.appendChild(o)}else t.appendChild(n.firstChild);else n.removeChild(n.firstChild)},50)}},{key:"_haxContextOperation",value:function(e){var t=e.detail;switch(t.eventName){case"text-tag":this.activeNode=this.haxChangeTagName(this.activeNode,t.value),F.write("activeNode",this.activeNode,this),this.positionContextMenus();break;case"text-tag-ul":this.shadowRoot.querySelector("#textcontextmenu").realSelectedValue="ul",this.activeNode=this.haxChangeTagName(this.activeNode,"ul"),F.write("activeNode",this.activeNode,this),this.positionContextMenus();break;case"text-tag-ol":this.shadowRoot.querySelector("#textcontextmenu").realSelectedValue="ol",this.activeNode=this.haxChangeTagName(this.activeNode,"ol"),F.write("activeNode",this.activeNode,this),this.positionContextMenus();break;case"hax-plate-add-element":if("other"==t.value)return F.haxInsertAnything({}),!0;var n=JSON.parse(t.value);if(this.haxInsert(n.tag,n.content,n.properties,!1),F.isTextElement(n))try{var o=document.createRange(),i=F.getSelection();o.setStart(this.activeNode,0),o.collapse(!0),i.removeAllRanges(),i.addRange(o),this.activeNode.focus()}catch(e){console.warn(e)}break;case"text-align-left":this.activeNode.style.textAlign=null;break;case"hax-transform-node":this.replaceElementWorkflow();break;case"hax-plate-create-right":"HAX-BODY"===this.activeNode.parentNode.tagName?this.haxGridPlateOps(this.activeNode,"right"):this.haxGridPlateOps(this.activeNode.parentNode,"right");break;case"hax-plate-remove-right":"HAX-BODY"===this.activeNode.parentNode.tagName?this.haxGridPlateOps(this.activeNode,"right",!1):this.haxGridPlateOps(this.activeNode.parentNode,"right",!1);break;case"hax-plate-duplicate":this.haxDuplicateNode(this.activeNode);break;case"hax-plate-delete":null!=this.activeNode&&this.haxDeleteNode(this.activeNode);break;case"hax-plate-up":this.haxMoveGridPlate("up",this.activeNode);break;case"hax-plate-down":this.haxMoveGridPlate("down",this.activeNode)}}},{key:"_focusIn",value:function(e){this.__mouseDown||this.__focusLogic(e.target)&&(e.stopPropagation(),e.stopImmediatePropagation())}},{key:"__focusLogic",value:function(e){var t=this,n=!1;if(this.openDrawer||!this.editMode||this.__tabTrap)this.__tabTrap=!1;else{var o=e;"SPAN"===o.tagName&&F.isTextElement(o.parentNode)&&""==o.parentNode.getAttribute("slot")&&(o=e.parentNode);var i=null;if(this._validElementTest(o)&&o.parentNode&&o.parentNode.tagName){if("P"===o.parentNode.tagName&&""==o.parentNode.getAttribute("slot"))i=o,n=!0;else{for(;o.parentNode.tagName&&"HAX-BODY"!=o.parentNode.tagName;)null===i&&"LI"!==o.tagName&&"B"!==o.tagName&&"I"!==o.tagName&&"STRONG"!==o.tagName&&"EM"!==o.tagName&&(i=o),o=o.parentNode;null===i?i=o:F.isGridPlateElement(o)||(i=o)}this.activeNode.parentNode===o||o.classList.contains("ignore-activation")?o.classList.contains("ignore-activation")&&(n=!0):n=!0,this.activeNode===i||i.classList.contains("ignore-activation")||(this.activeNode=i,F.write("activeNode",i,this),setTimeout(function(){if(!t.__mouseDown&&F.isTextElement(i))try{var e=document.createRange(),n=F.getSelection();e.setStart(t.activeNode,0),e.collapse(!0),n.removeAllRanges(),n.addRange(e),t.activeNode.focus()}catch(e){console.warn(e)}t.positionContextMenus(i)},0),n=!0)}}return n}},{key:"scrollHere",value:function(e){setTimeout(function(){"function"==typeof e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded(!0):e.scrollIntoView({behavior:"smooth",inline:"center"})},0)}},{key:"undo",value:function(){var e=this;D(P(n.prototype),"undo",this).call(this),setTimeout(function(){var t=e.querySelector(".hax-active");t?(e.__focusLogic(t),e.scrollHere(t)):e.hideContextMenus()},0)}},{key:"redo",value:function(){var e=this;D(P(n.prototype),"redo",this).call(this),setTimeout(function(){var t=e.querySelector(".hax-active");t?(e.__focusLogic(t),e.scrollHere(t)):e.hideContextMenus()},0)}},{key:"_editModeChanged",value:function(e,t){var n=this;if("undefined"!==w(t)){if(this._applyContentEditable(e),e)if(this.children&&this.children[0]&&this.children[0].focus)this.__focusLogic(this.children[0]);else{this.haxInsert("p","",{},!1);try{var o=document.createRange(),i=F.getSelection();o.setStart(this.activeNode,0),o.collapse(!0),i.removeAllRanges(),i.addRange(o),this.activeNode.focus()}catch(e){console.warn(e)}}setTimeout(function(){n.undoStack.undoStackLimit=20,n.undoStack.undoStackPosition=-1,n.undoStack.commands=[],n.undoStack.changed(),n.undoStackInitialValue=n.innerHTML,n.undoStackPrevValue=n.undoStackInitialValue},0)}0==e&&(this.removeAttribute("contenteditable"),this.hideContextMenus(),this.querySelectorAll("[contenteditable],.hax-active").forEach(function(e){e.removeAttribute("contenteditable"),e.classList.remove("hax-active")}))}},{key:"_haxResolvePreviousElement",value:function(e){for(e=e.previousElementSibling;null!=e&&"undefined"!==w(e.tagName)&&"HAX-"===e.tagName.substring(0,4);)e=e.previousElementSibling;return e}},{key:"_validElementTest",value:function(e){return"undefined"!==w(e.tagName)&&("HAX-"!==e.tagName.substring(0,4)||"HAX-LOGO"===e.tagName||"FAKE-HAX-BODY-END"!==e.tagName)}},{key:"_HTMLPrimativeTest",value:function(e){return null!=e&&"undefined"!==w(e.tagName)&&-1==e.tagName.indexOf("-")}},{key:"_applyContentEditable",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.shadowRoot.querySelector("#body"),n="slot"===t.localName?t.assignedNodes({flatten:!0}):[];0===n.length&&(n=t.children);for(var o=0,i=n.length;o<i;o++)this._validElementTest(n[o])&&(!e||!0!==n[o].getAttribute("contenteditable")&&"true"!=n[o].getAttribute("contenteditable")&&"contenteditable"!=n[o].getAttribute("contenteditable"))&&this.__applyNodeEditableState(n[o],e)}},{key:"__applyNodeEditableState",value:function(e){var t,n=this,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=e.tagName.replace("-"," ").toLowerCase(),a=F.gizmoList.findIndex(function(t){if(t)return t.tag===e.tagName.toLowerCase()});if(-1!==a&&(i=F.gizmoList[a].title),o?(e.setAttribute("data-hax-ray",i),t="addEventListener"):(e.removeAttribute("data-hax-ray"),t="removeEventListener"),e[t]("drop",this.dropEvent.bind(this)),e[t]("dragenter",this.dragEnter.bind(this)),e[t]("dragleave",this.dragLeave.bind(this)),e[t]("dragover",function(e){n.__mouseMoving=!0,e.preventDefault()}),this._HTMLPrimativeTest(e)&&(o?e.setAttribute("contenteditable",o):e.removeAttribute("contenteditable"),e.querySelectorAll("a").length>0))for(var r=e.querySelectorAll("a"),s=0,l=r.length;s<l;s++)o?r[s].setAttribute("contenteditable",o):r[s].removeAttribute("contenteditable"),r[s][t]("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()})}},{key:"undoManagerStackLogic",value:function(e){if(!this.__mouseMoving){var t=this.querySelectorAll(".hax-hovered, .hax-moving, .grid-plate-active-item");for(var o in t)if("undefined"!==w(t[o].classList)&&(t[o].classList.remove("hax-hovered","hax-moving","grid-plate-active-item"),"GRID-PLATE"===t[o].tagName))for(var i in t[o].children)"undefined"!==w(t[o].children[i].classList)&&t[o].children[i].classList.remove("hax-hovered","hax-moving","grid-plate-active-item");D(P(n.prototype),"undoManagerStackLogic",this).call(this,e)}}},{key:"dropEvent",value:function(e){if(!this.openDrawer&&this.editMode){this.__mouseMoving=!1,this.undoManagerStackLogic({}),clearTimeout(ie),F._lockContextPosition=!1,F.haxTray.activeTab="item-1";var t=null;t=e.path&&e.path[0]?e.path[0]:e.originalTarget?e.originalTarget:e.target,this.activeNode=t,F.write("activeNode",t,this);var n=this.querySelectorAll(".hax-hovered, .hax-moving, .grid-plate-active-item");for(var o in n)if("undefined"!==w(n[o].classList)&&(n[o].classList.remove("hax-hovered","hax-moving","grid-plate-active-item"),"GRID-PLATE"===n[o].tagName))for(var i in n[o].dropEvent(e),n[o].children)"undefined"!==w(n[o].children[i].classList)&&n[o].children[i].classList.remove("hax-hovered","hax-moving","grid-plate-active-item");try{if(e.dataTransfer&&e.dataTransfer.items&&e.dataTransfer.items.length>0&&"file"===e.dataTransfer.items[0].kind){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var a=document.createElement("p");this.activeNode.parentNode.insertBefore(a,this.activeNode),e.placeHolderElement=a,this.dispatchEvent(new CustomEvent("place-holder-file-drop",{bubbles:!0,cancelable:!0,composed:!0,detail:e}))}else{t=F.__dragTarget;var r=e.target;if(t&&null!=t&&"function"==typeof t.removeAttribute&&"undefined"!==w(r)&&t!==r&&t!==r.parentNode&&t.parentNode===this||r.parentNode===this){try{t.removeAttribute("slot"),r.parentNode.insertBefore(t,r)}catch(e){console.warn(e)}e.preventDefault(),e.stopPropagation()}t&&"function"==typeof t.focus&&(this.activeNode=t,F.write("activeNode",this.activeNode,this),this.dispatchEvent(new CustomEvent("hax-drop-focus-event",{bubbles:!0,cancelable:!0,composed:!0,detail:this.activeNode})),this.scrollHere(this.activeNode),this.positionContextMenus())}}catch(e){console.warn(e)}}F.__dragTarget=null,this.__manageFakeEndCap(!1)}},{key:"dragEnter",value:function(e){!this.openDrawer&&this.editMode&&e.target&&(this.__mouseMoving=!0,e.preventDefault(),e.target&&e.target.classList&&e.target.classList.add("hax-hovered"),this.handleMousemove(e))}},{key:"handleMousemove",value:function(e){var t=e.clientX,n=e.clientY,o=document.documentElement.clientWidth,i=document.documentElement.clientHeight,a=re,r=re,s=i-re,l=o-re,c=t<r,d=t>l,u=n<a,h=n>s;if(c||d||u||h){var p=Math.max(document.body.scrollWidth,document.body.offsetWidth,document.body.clientWidth,document.documentElement.scrollWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth),m=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.body.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight),v=p-o,x=m-i;!function e(){clearTimeout(ie),function(){var e=window.pageXOffset,o=window.pageYOffset,i=o>0,p=o<x,m=e>0,g=e<v,f=e,b=o;if(c&&m){var y=(r-t)/re;f-=ae*y}else if(d&&g){var y=(t-l)/re;f+=ae*y}if(u&&i){var y=(a-n)/re;b-=ae*y}else if(h&&p){var y=(n-s)/re;b+=ae*y}return f=Math.max(0,Math.min(v,f)),b=Math.max(0,Math.min(x,b)),(f!==e||b!==o)&&(window.scrollTo(f,b),!0)}()&&(ie=setTimeout(e,30))}()}else clearTimeout(ie)}},{key:"dragLeave",value:function(e){!this.openDrawer&&this.editMode&&e.target&&e.target.classList&&(this.__mouseMoving=!0,e.target.classList.remove("hax-hovered"))}},{key:"_activeNodeChanged",value:function(e,t){if(this.querySelectorAll(".hax-active").forEach(function(e){e.classList.remove("hax-active")}),this.editMode&&"undefined"!==w(e)&&null!==e&&e.parentNode){var n=e.tagName.toLowerCase();setTimeout(function(){e.classList.add("hax-active")},0),F.isTextElement(e)||F.isGridPlateElement(e)?(e.setAttribute("contenteditable",!0),this.setAttribute("contenteditable",!0)):(e.removeAttribute("contenteditable"),this.removeAttribute("contenteditable")),this.positionContextMenus(),this.shadowRoot.querySelector("#textcontextmenu").realSelectedValue=n}else null===e&&(this.hideContextMenus(),this.__oldActiveNode=t)}},{key:"_getPosition",value:function(e){return{x:e.offsetLeft-e.scrollLeft+e.clientLeft,y:e.offsetTop-e.scrollTop+e.clientTop}}},{key:"_positionContextMenu",value:function(e,t,n,o){if(null!=t){var i=this._getPosition(t);e.style.left=null!=n?i.x+n+"px":i.x+"px",e.style.top=null!=o?i.y+o+"px":i.y+"px"}e.setAttribute("on-screen","on-screen"),e.classList.add("hax-context-visible"),this.__activeHover&&(e.classList.add("hax-active-hover"),e.style.marginLeft="",this.__typeLock=!1)}},{key:"_hideContextMenu",value:function(e){e.removeAttribute("on-screen"),e.classList.remove("hax-context-visible","hax-active-hover","hax-context-pin-top")}},{key:"_tabKeyPressed",value:function(){var e=!1,t=this.activeNode.parentNode,n=this.activeNode.parentNode.tagName;if(F.getRange().cloneRange)try{var o=F.getRange().cloneRange(),i=o.commonAncestorContainer.tagName;if("undefined"===w(i)&&(i=o.commonAncestorContainer.parentNode.tagName),["UL","OL","LI"].includes(n)||["UL","OL","LI"].includes(i))this.polyfillSafe&&(document.execCommand("indent"),this.__tabTrap=!0);else for(;!e;)null==t.nextSibling?e=!0:"function"===t.nextSibling.focus?(t.nextSibling.focus(),e=!0):t=t.nextSibling}catch(e){console.warn(e)}}},{key:"_tabBackKeyPressed",value:function(){var e=this.activeNode.parentNode,t=this.activeNode.parentNode.tagName;if(F.getRange().cloneRange)try{var n=F.getRange().cloneRange(),o=n.commonAncestorContainer.tagName;if("undefined"===w(o)&&(o=n.commonAncestorContainer.parentNode.tagName),["UL","OL","LI"].includes(t)||["UL","OL","LI"].includes(o))this.polyfillSafe&&(document.execCommand("outdent"),this.__tabTrap=!0);else{if(null!=e)for(;null!=e&&!this._validElementTest(e);)e=e.previousSibling;null!=e&&setTimeout(function(){e.focus()},50)}}catch(e){console.warn(e)}}}],[{key:"tag",get:function(){return"hax-body"}},{key:"properties",get:function(){return L(L({},D(P(n),"properties",this)),{},{haxMover:{type:Boolean,attribute:"hax-mover",reflect:!0},openDrawer:{type:Object},haxSelectedText:{type:String},editMode:{type:Boolean,reflect:!0,attribute:"edit-mode"},haxRayMode:{type:Boolean,reflect:!0,attribute:"hax-ray-mode"},globalPreferences:{type:Object},activeNode:{type:Object}})}}]),n}();window.customElements.define(se.tag,se),e.HaxBody=se,Object.defineProperty(e,"__esModule",{value:!0})});
