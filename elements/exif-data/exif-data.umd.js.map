{"version":3,"file":"exif-data.umd.js","sources":["exif-data.umd.js"],"sourcesContent":["/**\n * Copyright 2019 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport \"@lrnwebcomponents/es-global-bridge/es-global-bridge.js\";\n/**\n * `exif-data`\n * `obtain exif data from slotted elements`\n * @demo demo/index.html\n * @customElement exif-data\n */\nclass ExifData extends HTMLElement {\n  /**\n   * Store the tag name to make it easier to obtain directly.\n   * @notice function name must be here for tooling to operate correctly\n   */\n  static get tag() {\n    return \"exif-data\";\n  }\n  // simple path from a url modifier\n  pathFromUrl(url) {\n    return url.substring(0, url.lastIndexOf(\"/\") + 1);\n  }\n  get html() {\n    return `\n    <style>\n      ul.showdata {\n        z-index: 1;\n        visibility: visible;\n        opacity: .9;\n      }\n      ul {\n        position: absolute;\n        transition: 0.3s linear all;\n        background-color: #000000;\n        opacity: 0;\n        visibility: hidden;\n        overflow: scroll;\n        padding: 0;\n        margin: 0;\n      }\n      ul li {\n        padding: 8px;\n        font-size: 14px;\n        color: white;\n      }\n    </style>\n    <slot></slot>\n    <ul id=\"data\"></ul>`;\n  }\n  render() {\n    this.shadowRoot.innerHTML = null;\n    this.template.innerHTML = this.html;\n    this.shadowRoot.appendChild(this.template.content.cloneNode(true));\n  }\n  /**\n   * life cycle\n   */\n  constructor() {\n    super();\n    const basePath = this.pathFromUrl(decodeURIComponent(import.meta.url));\n    window.ESGlobalBridge.requestAvailability();\n    window.ESGlobalBridge.instance.load(\"exif-js\", `${basePath}lib/exif-js.js`);\n    window.addEventListener(\n      \"es-bridge-exif-js-loaded\",\n      this._onExifJsLoaded.bind(this)\n    );\n    this.template = document.createElement(\"template\");\n    this.attachShadow({ mode: \"open\" });\n    this.render();\n    if (!this.getAttribute(\"no-events\")) {\n      this.addEventListener(\"click\", this.clickImage.bind(this));\n    }\n  }\n  /**\n   * Library loaded\n   */\n  _onExifJsLoaded() {\n    window.removeEventListener(\n      \"es-bridge-exif-js-loaded\",\n      this._onExifJsLoaded.bind(this)\n    );\n    this.__ready = true;\n    this.updateExif();\n  }\n  showDetails(item) {\n    let target = this.alignTarget;\n    if (!target) {\n      target = item.node;\n    }\n    const dim = target.getBoundingClientRect();\n    var content = \"\";\n    for (var key in item.data) {\n      if (\n        item.data[key] != \"\" &&\n        item.data[key] != false &&\n        item.data[key] != \" \" &&\n        item.data[key] != 0 &&\n        item.data[key] != null\n      ) {\n        content += `<li><strong>${key}</strong>: ${item.data[key]}</li>`;\n      }\n    }\n    this.dataElement.innerHTML = content;\n    if (this.alignTargetTop) {\n      this.dataElement.style.top = this.alignTargetTop;\n    } else {\n      this.dataElement.style.top = dim.top + \"px\";\n    }\n    this.dataElement.style.height = dim.height + \"px\";\n    this.dataElement.style.width = dim.width + \"px\";\n    this.dataElement.style.left = dim.left + \"px\";\n    this.dataElement.classList.add(\"showdata\");\n  }\n  clickImage(e) {\n    if (e.target.tagName === \"IMG\") {\n      this.nodeData.forEach(item => {\n        if (item.node === e.target) {\n          this.showDetails(item);\n        }\n      });\n    }\n  }\n  /**\n   * Load exifData\n   */\n  getExifData(node) {\n    window.EXIF.getData(node, () => {\n      let data = window.EXIF.getAllTags(node);\n      // REALLY verbose field\n      delete data.MakerNote;\n      delete data.thumbnail;\n      this.nodeData.push({\n        node: node,\n        data: data\n      });\n    });\n  }\n  updateExif(show = false) {\n    this.nodeData = [];\n    this.dataElement.innerHTML = \"\";\n    this.childNodes.forEach(node => {\n      if (this.__ready && node.tagName && node.tagName === \"IMG\") {\n        this.getExifData(node);\n      }\n    });\n    if (show && this.children.length === 1) {\n      this.showDetails(this.nodeData[0]);\n    }\n  }\n  clickData(e) {\n    this.dataElement.classList.remove(\"showdata\");\n  }\n  /**\n   * life cycle, element is afixed to the DOM\n   */\n  connectedCallback() {\n    if (window.ShadyCSS) {\n      window.ShadyCSS.styleElement(this);\n    }\n    this.dataElement = this.shadowRoot.querySelector(\"#data\");\n    if (!this.getAttribute(\"no-events\")) {\n      this.dataElement.addEventListener(\"click\", this.clickData.bind(this));\n    }\n    // any change, update things\n    this.observer = new MutationObserver(mutations => {\n      this.updateExif();\n    });\n    this.observer.observe(this, {\n      childList: true\n    });\n  }\n\n  disconnectedCallback() {\n    if (!this.getAttribute(\"no-events\")) {\n      this.dataElement.removeEventListener(\"click\", this.clickData.bind(this));\n    }\n    this.observer.disconnect();\n  }\n}\nwindow.customElements.define(ExifData.tag, ExifData);\nexport { ExifData };\n"],"names":["ExifData","basePath","pathFromUrl","decodeURIComponent","window","ESGlobalBridge","requestAvailability","instance","load","addEventListener","_this","_onExifJsLoaded","bind","template","document","createElement","attachShadow","mode","render","getAttribute","clickImage","HTMLElement","url","substring","lastIndexOf","shadowRoot","innerHTML","this","html","appendChild","content","cloneNode","removeEventListener","__ready","updateExif","item","target","alignTarget","node","dim","getBoundingClientRect","key","data","dataElement","alignTargetTop","style","top","height","width","left","classList","add","e","tagName","nodeData","forEach","_this2","showDetails","EXIF","getData","getAllTags","MakerNote","thumbnail","_this3","push","show","childNodes","_this4","getExifData","children","length","remove","ShadyCSS","styleElement","querySelector","clickData","observer","MutationObserver","mutations","_this5","observe","childList","disconnect","customElements","define","tag"],"mappings":"6xDAWMA,sJAiDIC,4EAAgBC,YAAYC,2MAClCC,OAAOC,eAAeC,sBACtBF,OAAOC,eAAeE,SAASC,KAAK,oBAAcP,qBAClDG,OAAOK,iBACL,2BACAC,EAAKC,gBAAgBC,cAElBC,SAAWC,SAASC,cAAc,cAClCC,aAAa,CAAEC,KAAM,WACrBC,SACAR,EAAKS,aAAa,gBAChBV,iBAAiB,QAASC,EAAKU,WAAWR,4PA5D9BS,qDASTC,UACHA,EAAIC,UAAU,EAAGD,EAAIE,YAAY,KAAO,yCA8B1CC,WAAWC,UAAY,UACvBb,SAASa,UAAYC,KAAKC,UAC1BH,WAAWI,YAAYF,KAAKd,SAASiB,QAAQC,WAAU,8kBApCrD,6DA6DP3B,OAAO4B,oBACL,2BACAL,KAAKhB,gBAAgBC,KAAKe,YAEvBM,SAAU,OACVC,iDAEKC,OACNC,EAAST,KAAKU,YACbD,IACHA,EAASD,EAAKG,UAEVC,EAAMH,EAAOI,wBACfV,EAAU,OACT,IAAIW,KAAON,EAAKO,KAEC,IAAlBP,EAAKO,KAAKD,IACQ,GAAlBN,EAAKO,KAAKD,IACQ,KAAlBN,EAAKO,KAAKD,IACQ,GAAlBN,EAAKO,KAAKD,IACQ,MAAlBN,EAAKO,KAAKD,KAEVX,yBAA0BW,wBAAiBN,EAAKO,KAAKD,kBAGpDE,YAAYjB,UAAYI,EACzBH,KAAKiB,oBACFD,YAAYE,MAAMC,IAAMnB,KAAKiB,oBAE7BD,YAAYE,MAAMC,IAAMP,EAAIO,IAAM,UAEpCH,YAAYE,MAAME,OAASR,EAAIQ,OAAS,UACxCJ,YAAYE,MAAMG,MAAQT,EAAIS,MAAQ,UACtCL,YAAYE,MAAMI,KAAOV,EAAIU,KAAO,UACpCN,YAAYO,UAAUC,IAAI,+CAEtBC,cACgB,QAArBA,EAAEhB,OAAOiB,cACNC,SAASC,QAAQ,SAAApB,GAChBA,EAAKG,OAASc,EAAEhB,QAClBoB,EAAKC,YAAYtB,yCAQbG,cACVlC,OAAOsD,KAAKC,QAAQrB,EAAM,eACpBI,EAAOtC,OAAOsD,KAAKE,WAAWtB,UAE3BI,EAAKmB,iBACLnB,EAAKoB,UACZC,EAAKT,SAASU,KAAK,CACjB1B,KAAMA,EACNI,KAAMA,sDAIDuB,+DACJX,SAAW,QACXX,YAAYjB,UAAY,QACxBwC,WAAWX,QAAQ,SAAAjB,GAClB6B,EAAKlC,SAAWK,EAAKe,SAA4B,QAAjBf,EAAKe,SACvCc,EAAKC,YAAY9B,KAGjB2B,GAAiC,IAAzBtC,KAAK0C,SAASC,aACnBb,YAAY9B,KAAK2B,SAAS,sCAGzBF,QACHT,YAAYO,UAAUqB,OAAO,mEAM9BnE,OAAOoE,UACTpE,OAAOoE,SAASC,aAAa9C,WAE1BgB,YAAchB,KAAKF,WAAWiD,cAAc,SAC5C/C,KAAKR,aAAa,mBAChBwB,YAAYlC,iBAAiB,QAASkB,KAAKgD,UAAU/D,KAAKe,YAG5DiD,SAAW,IAAIC,iBAAiB,SAAAC,GACnCC,EAAK7C,oBAEF0C,SAASI,QAAQrD,KAAM,CAC1BsD,WAAW,mDAKRtD,KAAKR,aAAa,mBAChBwB,YAAYX,oBAAoB,QAASL,KAAKgD,UAAU/D,KAAKe,YAE/DiD,SAASM,sBAGlB9E,OAAO+E,eAAeC,OAAOpF,EAASqF,IAAKrF"}