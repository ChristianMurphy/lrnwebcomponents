{"version":3,"file":"img-pan-zoom.umd.js","sources":["lib/img-loader.js","img-pan-zoom.umd.js"],"sourcesContent":["import { html, Polymer } from \"@polymer/polymer/polymer-legacy.js\";\n\n/*\n`img-loader` preloads images\n\nall `img-loader` code comes from <a href=\"https://github.com/PolymerElements/iron-image/blob/master/iron-image.html\">iron image</a>\n*/\nPolymer({\n  _template: html`\n    <img id=\"img\" hidden=\"\" src=\"[[src]]\" />\n  `,\n\n  is: \"img-loader\",\n\n  properties: {\n    src: {\n      observer: \"_srcChanged\",\n      type: String\n    },\n    /**\n     * Read-only value that is true when the image is loaded.\n     */\n    loaded: {\n      notify: true,\n      readOnly: true,\n      type: Boolean,\n      value: false\n    },\n    /**\n     * Read-only value that tracks the loading state of the image when the `preload`\n     * option is used.\n     */\n    loading: {\n      notify: true,\n      readOnly: true,\n      type: Boolean,\n      value: false\n    },\n    /**\n     * Read-only value that indicates that the last set `src` failed to load.\n     */\n    error: {\n      notify: true,\n      readOnly: true,\n      type: Boolean,\n      value: false\n    }\n  },\n\n  ready: function() {\n    var img = this.$.img;\n\n    img.onload = function() {\n      if (this.$.img.src !== this._resolveSrc(this.src)) return;\n      this._setLoading(false);\n      this._setLoaded(true);\n      this._setError(false);\n    }.bind(this);\n\n    img.onerror = function() {\n      if (this.$.img.src !== this._resolveSrc(this.src)) return;\n      this._reset();\n      this._setLoading(false);\n      this._setLoaded(false);\n      this._setError(true);\n    }.bind(this);\n\n    this._resolvedSrc = \"\";\n  },\n\n  _srcChanged: function(newSrc, oldSrc) {\n    var newResolvedSrc = this._resolveSrc(newSrc);\n    if (newResolvedSrc === this._resolvedSrc) return;\n    this._resolvedSrc = newResolvedSrc;\n    this._reset();\n    this._load(newSrc);\n  },\n\n  _load: function(src) {\n    if (src) {\n      this.$.img.src = src;\n    } else {\n      this.$.img.removeAttribute(\"src\");\n    }\n    this._setLoading(!!src);\n    this._setLoaded(false);\n    this._setError(false);\n  },\n\n  _reset: function() {\n    this.$.img.removeAttribute(\"src\");\n    this._setLoading(false);\n    this._setLoaded(false);\n    this._setError(false);\n  },\n\n  _resolveSrc: function(testSrc) {\n    var baseURI = /** @type {string} */ (this.ownerDocument.baseURI);\n    return new URL(this.resolveUrl(testSrc, baseURI), baseURI).href;\n  }\n});\n","import { html, Polymer } from \"@polymer/polymer/polymer-legacy.js\";\nimport { pathFromUrl } from \"@polymer/polymer/lib/utils/resolve-url.js\";\nimport \"@lrnwebcomponents/es-global-bridge/es-global-bridge.js\";\nimport \"./lib/img-loader.js\";\n/**\n`img-pan-zoom` Image pan zoom element\n\nImages are preloaded by `img-loader` and a spinner is shown until loaded\nDeep Zoom Images are supported\n\n### Styling\n\nCustom property | Description | Default\n----------------|-------------|----------\n`--img-pan-zoom-spinner` | Mixin applied to spinner |\n`--img-pan-zoom-spinner-color` | Spinner color | `#2196F3`\n`--img-pan-zoom-spinner-width` | Spinner width | `5px`\n\n### Credits\n\n<a href=\"https://openseadragon.github.io\">openSeadragon</a>\n\n\n* @demo demo/index.html\n*/\nlet ImgPanZoom = Polymer({\n  _template: html`\n    <style>\n      :host {\n        display: block;\n        position: relative;\n        height: 500px;\n      }\n      #viewer {\n        position: relative;\n        height: 100%;\n        width: 100%;\n      }\n\n      paper-spinner-lite {\n        opacity: 0;\n        display: block;\n        transition: opacity 700ms;\n        position: absolute;\n        margin: auto;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        right: 0;\n        z-index: 1;\n        height: 70px;\n        width: 70px;\n        --paper-spinner-color: var(--img-pan-zoom-spinner-color, #2196f3);\n        --paper-spinner-stroke-width: var(--img-pan-zoom-spinner-width, 5px);\n        @apply --img-pan-zoom-spinner;\n      }\n      paper-spinner-lite[active] {\n        opacity: 1;\n      }\n    </style>\n\n    <!-- Only preload regular images -->\n    <template is=\"dom-if\" if=\"[[!dzi]]\">\n      <paper-spinner-lite\n        hidden$=\"[[hideSpinner]]\"\n        active=\"[[loading]]\"\n      ></paper-spinner-lite>\n      <img-loader\n        loaded=\"{{loaded}}\"\n        loading=\"{{loading}}\"\n        src=\"[[src]]\"\n      ></img-loader>\n    </template>\n\n    <!-- Openseadragon -->\n    <div id=\"viewer\"></div>\n  `,\n\n  is: \"img-pan-zoom\",\n\n  properties: {\n    // Image source\n    src: {\n      type: String\n    },\n    // Set to true if you are using a deep zoom image\n    dzi: {\n      type: Boolean,\n      value: false\n    },\n    // Fade in new items added to the viewer\n    fadeIn: {\n      type: Boolean,\n      value: true\n    },\n    // loading\n    loading: {\n      type: Boolean,\n      readonly: true,\n      notify: true\n    },\n    // hides spinner\n    hideSpinner: {\n      type: Boolean,\n      value: false\n    },\n    // loaded\n    loaded: {\n      type: Boolean,\n      readonly: true,\n      notify: true,\n      observer: \"_loadedChanged\"\n    },\n    // Set to false to prevent the appearance of the default navigation controls. Note that if set to false, the customs buttons set by the options zoomInButton, zoomOutButton etc, are rendered inactive.\n    showNavigationControl: {\n      type: Boolean,\n      value: false\n    },\n    // Set to true to make the navigator minimap appear.\n    showNavigator: {\n      type: Boolean,\n      value: false\n    },\n    // The \"zoom distance\" per mouse click or touch tap. Note: Setting this to 1.0 effectively disables the click-to-zoom feature (also see gestureSettings[Mouse|Touch|Pen].clickToZoom/dblClickToZoom).\n    zoomPerClick: {\n      type: Number,\n      value: 2.0\n    },\n    // The \"zoom distance\" per mouse scroll or touch pinch. Note: Setting this to 1.0 effectively disables the mouse-wheel zoom feature (also see gestureSettings[Mouse|Touch|Pen].scrollToZoom}).\n    zoomPerScroll: {\n      type: Number,\n      value: 1.2\n    },\n    // Specifies the animation duration per each OpenSeadragon.Spring which occur when the image is dragged or zoomed.\n    animationTime: {\n      type: Number,\n      value: 1.2\n    },\n    // If true then the 'previous' button will wrap to the last image when viewing the first image and the 'next' button will wrap to the first image when viewing the last image.\n    navPrevNextWrap: {\n      type: Boolean,\n      value: false\n    },\n    // If true then the rotate left/right controls will be displayed as part of the standard controls. This is also subject to the browser support for rotate (e.g. viewer.drawer.canRotate()).\n    showRotationControl: {\n      type: Boolean,\n      value: false\n    },\n    // The minimum percentage ( expressed as a number between 0 and 1 ) of the viewport height or width at which the zoom out will be constrained. Setting it to 0, for example will allow you to zoom out infinity.\n    minZoomImageRatio: {\n      type: Number,\n      value: 1\n    },\n    // The maximum ratio to allow a zoom-in to affect the highest level pixel ratio. This can be set to Infinity to allow 'infinite' zooming into the image though it is less effective visually if the HTML5 Canvas is not availble on the viewing device.\n    maxZoomPixelRatio: {\n      type: Number,\n      value: 1.1\n    },\n    // Constrain during pan\n    constrainDuringPan: {\n      type: Boolean,\n      value: false\n    },\n    // The percentage ( as a number from 0 to 1 ) of the source image which must be kept within the viewport. If the image is dragged beyond that limit, it will 'bounce' back until the minimum visibility ratio is achieved. Setting this to 0 and wrapHorizontal ( or wrapVertical ) to true will provide the effect of an infinitely scrolling viewport.\n    visibilityRatio: {\n      type: Number,\n      value: 1\n    }\n  },\n\n  observers: [\"_srcChanged(src)\"],\n  created: function() {\n    const name = \"openseadragon\";\n    const basePath = pathFromUrl(decodeURIComponent(import.meta.url));\n    const location = `${basePath}lib/openseadragon/build/openseadragon/openseadragon.js`;\n    window.addEventListener(\n      `es-bridge-${name}-loaded`,\n      this._openseadragonLoaded.bind(this)\n    );\n    window.ESGlobalBridge.requestAvailability();\n    window.ESGlobalBridge.instance.load(name, location);\n  },\n  _openseadragonLoaded: function() {\n    this.__openseadragonLoaded = true;\n    if (this.dzi) {\n      this._initOpenSeadragon();\n    }\n  },\n  ready: function() {\n    this.animationConfig = {\n      fade: {\n        name: \"fade-in-animation\",\n        node: this.$.viewer\n      }\n    };\n\n    // Init openseadragon if we are using a deep zoom image\n    if (this.dzi && this.__openseadragonLoaded) {\n      // Add src changed observer\n      this._initOpenSeadragon();\n    }\n  },\n\n  // Init openseadragon\n  _initOpenSeadragon: function() {\n    setTimeout(() => {\n      var tileSources = this.src;\n      if (!this.dzi) {\n        tileSources = {\n          type: \"image\",\n          url: this.src,\n          buildPyramid: false\n        };\n      }\n      this.viewer = new OpenSeadragon({\n        element: this.$.viewer,\n        visibilityRatio: this.visibilityRatio,\n        constrainDuringPan: this.constrainDuringPan,\n        showNavigationControl: this.showNavigationControl,\n        showNavigator: this.showNavigator,\n        zoomPerClick: this.zoomPerClick,\n        zoomPerScroll: this.zoomPerScroll,\n        animationTime: this.animationTime,\n        navPrevNextWrap: this.navPrevNextWrap,\n        showRotationControl: this.showRotationControl,\n        minZoomImageRatio: this.minZoomImageRatio,\n        maxZoomPixelRatio: this.maxZoomPixelRatio,\n        tileSources: tileSources\n      });\n      this.init = true;\n    }, 100);\n  },\n\n  //Function to destroy the viewer and clean up everything created by OpenSeadragon.\n  destroy: function() {\n    this.viewer.destroy();\n  },\n\n  // Zoom in\n  zoomIn: function() {\n    // TODO: Replace with native openseadragon zoomIn\n    var currentZoom = this.viewer.viewport.getZoom();\n    var maxZoom = this.viewer.viewport.getMaxZoom();\n    var zoomTo = currentZoom + 0.7;\n    if (zoomTo < maxZoom) {\n      this.viewer.viewport.zoomTo(zoomTo);\n    }\n  },\n\n  // Zoom out\n  zoomOut: function() {\n    // TODO: Replace with openseadragon native zoomOut\n    var currentZoom = this.viewer.viewport.getZoom();\n    var minZoom = this.viewer.viewport.getMinZoom();\n    var zoomTo = currentZoom - 0.7;\n    if (zoomTo > minZoom) {\n      this.viewer.viewport.zoomTo(zoomTo);\n    } else {\n      if (minZoom != currentZoom) {\n        this.resetZoom();\n      }\n    }\n  },\n\n  // reset zoom\n  resetZoom: function() {\n    this.viewer.viewport.goHome();\n  },\n\n  _srcChanged: function() {\n    if (this.dzi && this.init) {\n      // add tiled image\n      this._addTiledImage();\n    }\n  },\n\n  // Add loaded images to viewer\n  _loadedChanged: function() {\n    if (this.loaded) {\n      if (!this.init) {\n        this._initOpenSeadragon();\n      } else {\n        this._addImage();\n      }\n    }\n  },\n\n  _addImage: function() {\n    this.viewer.addSimpleImage({ url: this.src, index: 0, replace: true });\n  },\n\n  _addTiledImage: function() {\n    this.viewer.addTiledImage({\n      tileSource: this.src,\n      index: 0,\n      replace: true\n    });\n  }\n});\nexport { ImgPanZoom };\n"],"names":["_template","html","is","properties","src","observer","type","String","loaded","notify","readOnly","Boolean","value","loading","error","ready","img","this","$","onload","_resolveSrc","_setLoading","_setLoaded","_setError","bind","onerror","_reset","_resolvedSrc","_srcChanged","newSrc","oldSrc","newResolvedSrc","_load","removeAttribute","testSrc","baseURI","ownerDocument","URL","resolveUrl","href","ImgPanZoom","Polymer","dzi","fadeIn","readonly","hideSpinner","showNavigationControl","showNavigator","zoomPerClick","Number","zoomPerScroll","animationTime","navPrevNextWrap","showRotationControl","minZoomImageRatio","maxZoomPixelRatio","constrainDuringPan","visibilityRatio","observers","created","name","basePath","pathFromUrl","decodeURIComponent","location","window","addEventListener","_openseadragonLoaded","ESGlobalBridge","requestAvailability","instance","load","__openseadragonLoaded","_initOpenSeadragon","animationConfig","fade","node","viewer","setTimeout","tileSources","_this","url","buildPyramid","OpenSeadragon","element","init","destroy","zoomIn","zoomTo","viewport","getZoom","getMaxZoom","zoomOut","currentZoom","minZoom","getMinZoom","resetZoom","goHome","_addTiledImage","_loadedChanged","_addImage","addSimpleImage","index","replace","addTiledImage","tileSource"],"mappings":"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"}