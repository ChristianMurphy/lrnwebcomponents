{"version":3,"file":"map-menu.umd.js","sources":["map-menu.umd.js"],"sourcesContent":["/**\n * Copyright 2019 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport { LitElement, html, css } from \"lit-element/lit-element.js\";\nimport \"@lrnwebcomponents/smooth-scroll/smooth-scroll.js\";\nimport \"@lrnwebcomponents/map-menu/lib/map-menu-builder.js\";\nimport \"@lrnwebcomponents/map-menu/lib/map-menu-container.js\";\n/**\n * @deprecatedApply - required for @apply / invoking @apply css var convention\n */\nimport \"@polymer/polymer/lib/elements/custom-style.js\";\n/**\n * `map-menu`\n * `A series of elements that generate a hierarchical menu`\n *\n * @demo demo/index.html\n */\nclass MapMenu extends LitElement {\n  /**\n   * LitElement constructable styles enhancement\n   */\n  static get styles() {\n    return [\n      css`\n        :host {\n          --map-menu-active-color: rgba(0, 0, 0, 0.1);\n          --map-menu-size: 1;\n          --map-menu-font-size: 16px;\n          display: block;\n          overflow-y: scroll;\n          position: relative;\n          height: 100%;\n          transition: 0.2s linear all;\n          opacity: 1;\n          background-color: transparent;\n        }\n        #activeindicator {\n          background: var(--map-menu-active-color);\n          transition: all 0.3s ease-in-out;\n          position: absolute;\n        }\n\n        map-menu-container {\n          padding: var(--map-menu-container-padding, 0);\n        }\n\n        /* turn default active color if indicator is on */\n        :host([active-indicator]) map-menu-builder {\n          --map-menu-active-color: transparent;\n        }\n      `\n    ];\n  }\n  /**\n   * HTMLElement\n   */\n  constructor() {\n    super();\n    this.disabled = false;\n    this.title = \"Content outline\";\n    this.data = null;\n    this.items = [];\n    this.autoScroll = false;\n    this.activeIndicator = false;\n    this.addEventListener(\"link-clicked\", this.__linkClickedHandler.bind(this));\n    this.addEventListener(\"toggle-updated\", this.__toggleUpdated.bind(this));\n    this.addEventListener(\"active-item\", this.__activeItemHandler.bind(this));\n    this.addEventListener(\n      \"map-meu-item-hidden-check\",\n      this._mapMeuItemHiddenCheckHandler.bind(this)\n    );\n  }\n  /**\n   * LitElement life cycle - render\n   */\n  render() {\n    return html`\n      <custom-style>\n        <style>\n          #itemslist {\n            @apply --map-menu-items-list;\n          }\n          #activeindicator {\n            @apply --map-menu-active-indicator;\n          }\n          map-menu-container {\n            @apply --map-menu-container;\n          }\n        </style>\n      </custom-style>\n      <div id=\"itemslist\">\n        <map-menu-container>\n          <div id=\"activeindicator\"></div>\n          <map-menu-builder\n            id=\"builder\"\n            .items=\"${this.items}\"\n            .selected=\"${this.selected}\"\n          ></map-menu-builder>\n        </map-menu-container>\n      </div>\n      <smooth-scroll id=\"smoothscroll\"></smooth-scroll>\n    `;\n  }\n\n  static get tag() {\n    return \"map-menu\";\n  }\n\n  static get properties() {\n    return {\n      disabled: {\n        type: Boolean,\n        reflect: true\n      },\n      title: {\n        type: String\n      },\n      data: {\n        type: Array\n      },\n      /**\n       * Support for JSON Outline Schema manifest format\n       */\n      manifest: {\n        type: Object\n      },\n      items: {\n        type: Array\n      },\n      /**\n       * Current selected item.\n       */\n      selected: {\n        type: String\n      },\n      activeItem: {\n        type: Object\n      },\n      /**\n       * Auto scroll an active element if not in view\n       */\n      autoScroll: {\n        type: Boolean\n      },\n      /**\n       * Show active indicator animation\n       */\n      activeIndicator: {\n        type: Boolean,\n        reflect: true,\n        attribute: \"active-indicator\"\n      }\n    };\n  }\n  /**\n   * LitElement life cycle - properties changed\n   */\n  updated(changedProperties) {\n    changedProperties.forEach((oldValue, propName) => {\n      if (propName == \"data\") {\n        this._dataChanged(this[propName]);\n      }\n      if (propName == \"manifest\") {\n        this._manifestChanged(this[propName]);\n      }\n      if (propName == \"activeItem\") {\n        this.refreshActiveChildren(this[propName], oldValue);\n      }\n      // notify\n      if ([\"manifest\", \"items\", \"selected\"].includes(propName)) {\n        this.dispatchEvent(\n          new CustomEvent(`${propName}-changed`, {\n            detail: {\n              value: this[propName]\n            }\n          })\n        );\n      }\n    });\n  }\n  __activeItemHandler(e) {\n    this.activeItem = e.detail;\n  }\n\n  _mapMeuItemHiddenCheckHandler(e) {\n    const action = e.detail.action;\n    const hiddenChild = e.detail.hiddenChild;\n    if (action === \"closed\" && hiddenChild === true) {\n      this.__updateActiveIndicator(this.activeItem, true);\n    } else {\n      this.__updateActiveIndicator(this.activeItem, false);\n    }\n  }\n\n  /**\n   * Set and unset active properties on children\n   * @param {string} activeItem\n   */\n  refreshActiveChildren(newValue, oldValue) {\n    if (newValue) {\n      // set the new active attribute to the item\n      newValue.setAttribute(\"active\", \"active\");\n      // move the highlight thingy\n      if (this.activeIndicator) {\n        this.__updateActiveIndicator(newValue);\n      }\n      // if auto scroll enabled then scroll element into view\n      if (this.autoScroll) {\n        // kick off smooth scroll\n        this.shadowRoot.querySelector(\"#smoothscroll\").scroll(newValue, {\n          duration: 100,\n          scrollElement: this\n        });\n      }\n    }\n\n    if (oldValue) {\n      oldValue.removeAttribute(\"active\");\n      this.__updateActiveIndicator(newValue);\n    }\n  }\n\n  _manifestChanged(newValue) {\n    if (newValue) {\n      this.data = newValue.items;\n    }\n  }\n  /**\n   * LitElement life cycle - ready\n   */\n  firstUpdated(changedProperties) {\n    if (this.activeItem) {\n      this.refreshActiveChildren(this.activeItem, false);\n    }\n  }\n  /**\n   * Convert data from a linear array\n   * to a nested array for template rendering\n   */\n  _dataChanged(data) {\n    const items = [];\n    if (!data) return;\n    // find parents\n    data.forEach(element => {\n      // find top level parents\n      if (!element.parent) {\n        items.push(element);\n      }\n    });\n    // Recursively find and set children\n    items.forEach((item, i) => {\n      this._setChildren(item, data);\n    });\n    // Update items array\n    this.items = [...items];\n  }\n\n  /**\n   * Recursively search through a data to find children\n   * of a specified item.\n   * @param {object} item item of an array to search on. Passed by reference.\n   * @param {array} data linear array of the data set.\n   * @return {void}\n   */\n  _setChildren(item, data) {\n    // find all children\n    const children = data.filter(d => item.id === d.parent);\n    item.children = children;\n    if (item.children.length > 0) {\n      item.children.forEach(child => {\n        // recursively call itself\n        this._setChildren(child, data);\n      });\n    }\n  }\n\n  /**\n   * Determine if a menu item has children\n   */\n  __hasChildren(item) {\n    return item.children.length > 0;\n  }\n\n  /**\n   * asdf\n   */\n  __linkClickedHandler(e) {\n    this.selected = e.detail.id;\n    this.dispatchEvent(\n      new CustomEvent(\"selected\", {\n        bubbles: true,\n        cancelable: true,\n        composed: true,\n        detail: e.detail.id\n      })\n    );\n  }\n\n  /**\n   * When a user clicks the toggle button to collapse or\n   * expand a submenu, this event gets triggered after\n   * the animation has been triggered\n   */\n  __toggleUpdated(e) {\n    const action = e.detail.opened ? \"opened\" : \"closed\";\n    const target = e.path[0];\n    if (typeof this.activeItem !== \"undefined\") {\n      this.activeItem.dispatchEvent(\n        new CustomEvent(\"map-menu-item-hidden-check\", {\n          bubbles: true,\n          cancelable: true,\n          composed: true,\n          detail: Object.assign(\n            {},\n            {\n              action: action,\n              target: target\n            }\n          )\n        })\n      );\n    }\n  }\n\n  /**\n   * Find out if\n   */\n  __isInViewport(element) {\n    const scrollParent = this.__getScrollParent(element);\n    if (!scrollParent) return false;\n\n    var elementTop = element.offsetTop;\n    var elementBottom = elementTop + element.offsetHeight;\n    var viewportTop = scrollParent.offsetTop;\n    var viewportBottom = viewportTop + scrollParent.offsetHeight;\n    return elementBottom > viewportTop && elementTop < viewportBottom;\n  }\n\n  /**\n   * Get scroll parent\n   */\n  __getScrollParent(node) {\n    if (node == null) {\n      return null;\n    }\n\n    if (node.scrollHeight > node.clientHeight) {\n      return node;\n    } else {\n      return this.__getScrollParent(node.parentNode);\n    }\n  }\n\n  /**\n   * Move the highlight widget over active element\n   */\n  __updateActiveIndicator(element, hidden = false) {\n    // run it through to set time just to let stuff set up\n    const activeindicator = this.shadowRoot.querySelector(\"#activeindicator\");\n    const left = element.offsetLeft;\n    const top = element.offsetTop;\n    const width = element.offsetWidth;\n    // if the element is hidden the set the indicator height to zero to make it disapear\n    const height = !hidden ? element.offsetHeight : 0;\n    activeindicator.setAttribute(\n      \"style\",\n      `width:${width}px;height:${height}px;top:${top}px;left:${left}px`\n    );\n  }\n  /**\n   * Find out if any parents of the item are collapsed\n   */\n  __parentsHidden(node) {\n    // get the parent node\n    const parent = node.parentNode;\n    // bail if we have no node to work with\n    if (parent == null) return null;\n    // if we found a submenu check if it is hidden\n    if (parent.tagName === \"MAP-MENU-SUBMENU\") {\n      // if open is set to false then we have\n      // found a hidden parent\n      if (!parent.opened) return true;\n    }\n    // wrap up and exit if we came all the way back to map-menu\n    if (parent.tagName === \"MAP-MENU\") return false;\n    // if we got all the way here then we need recursively run this\n    // against the parent node\n    return this.__parentsHidden(parent);\n  }\n}\nwindow.customElements.define(MapMenu.tag, MapMenu);\nexport { MapMenu };\n"],"names":["MapMenu","disabled","title","data","items","autoScroll","activeIndicator","addEventListener","_this","__linkClickedHandler","bind","__toggleUpdated","__activeItemHandler","_mapMeuItemHiddenCheckHandler","LitElement","css","html","this","selected","changedProperties","forEach","oldValue","propName","_this2","_dataChanged","_manifestChanged","refreshActiveChildren","includes","dispatchEvent","CustomEvent","detail","value","e","activeItem","action","hiddenChild","__updateActiveIndicator","newValue","setAttribute","shadowRoot","querySelector","scroll","duration","scrollElement","removeAttribute","element","parent","push","item","i","_this3","_setChildren","children","filter","d","id","length","child","_this4","bubbles","cancelable","composed","opened","target","path","Object","assign","scrollParent","__getScrollParent","elementTop","offsetTop","elementBottom","offsetHeight","viewportTop","viewportBottom","node","scrollHeight","clientHeight","parentNode","hidden","activeindicator","left","offsetLeft","top","width","offsetWidth","height","tagName","__parentsHidden","type","Boolean","reflect","String","Array","manifest","attribute","window","customElements","define","tag"],"mappings":"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"}