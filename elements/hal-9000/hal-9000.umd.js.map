{"version":3,"file":"hal-9000.umd.js","sources":["hal-9000.umd.js"],"sourcesContent":["/**\n * Copyright 2019 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport { html, PolymerElement } from \"@polymer/polymer/polymer-element.js\";\nimport { ESGlobalBridge } from \"@lrnwebcomponents/es-global-bridge/es-global-bridge.js\";\nimport { pathFromUrl } from \"@polymer/polymer/lib/utils/resolve-url.js\";\n\n/**\n * `hal-9000`\n * `Robot assistant tag, hopefully not evil`\n *\n * @microcopy - language worth noting:\n *  -\n *\n * @customElement\n * @polymer\n * @demo demo/index.html\n */\nclass Hal9000 extends PolymerElement {\n  \n  // render function\n  static get template() {\n    return html`\n<style>:host {\n  display: block;\n}\n\n:host([hidden]) {\n  display: none;\n}\n[hidden] {\n  display: none;\n}\n</style>\n<slot></slot>`;\n  }\n\n  // properties available to the custom element for data binding\n  static get properties() {\n    return {\n  /**\n   * Commands to listen for and take action on\n   */\n  \"commands\": {\n    \"name\": \"commands\",\n    \"type\": \"Object\",\n    \"value\": {},\n    \"observer\": \"_commandsChanged\"\n  },\n  /**\n   * The name that HAL 9000 should respond to.\n   */\n  \"respondsTo\": {\n    \"name\": \"respondsTo\",\n    \"type\": \"String\",\n    \"value\": \"(hal)\",\n    \"observer\": \"_respondsToChanged\"\n  },\n  /**\n   * Debug mode for annyang\n   */\n  \"debug\": {\n    \"name\": \"debug\",\n    \"type\": \"Boolean\",\n    \"value\": false,\n    \"observer\": \"_debugChanged\"\n  },\n  /**\n   * Start automatically\n   */\n  \"auto\": {\n    \"name\": \"auto\",\n    \"type\": \"Boolean\",\n    \"reflectToAttribute\": true,\n    \"observer\": \"_autoChanged\"\n  },\n  /**\n   * Status of listening\n   */\n  \"enabled\": {\n    \"name\": \"enabled\",\n    \"type\": \"Boolean\",\n    \"reflectToAttribute\": true,\n    \"observer\": \"_enabledChanged\"\n  },\n  /**\n   * Pitch of speech\n   */\n  \"pitch\": {\n    \"name\": \"pitch\",\n    \"type\": \"Number\",\n    \"reflectToAttribute\": true,\n    \"value\": 0.9\n  },\n  /**\n   * Rate of speech\n   */\n  \"rate\": {\n    \"name\": \"rate\",\n    \"type\": \"Number\",\n    \"reflectToAttribute\": true,\n    \"value\": 0.9\n  },\n  /**\n   * Language of the speaker\n   */\n  \"language\": {\n    \"name\": \"language\",\n    \"type\": \"String\",\n    \"reflectToAttribute\": true,\n    \"value\": \"en-US\"\n  }\n}\n;\n  }\n\n  /**\n   * Store the tag name to make it easier to obtain directly.\n   * @notice function name must be here for tooling to operate correctly\n   */\n  static get tag() {\n    return \"hal-9000\";\n  }\n  /**\n   * Establish the element\n   */\n  constructor() {\n    super();\n    const name = \"annyang\";\n    const basePath = pathFromUrl(import.meta.url);\n    const location = `${basePath}lib/annyang/annyang.min.js`;\n    window.addEventListener(\n      `es-bridge-${name}-loaded`,\n      this._annyangLoaded.bind(this)\n    );\n    window.ESGlobalBridge.requestAvailability();\n    window.ESGlobalBridge.instance.load(name, location);\n    // ensure singleton is set\n    window.Hal9000.instance = this;\n    // check for speech synthesis API\n    if (typeof window.speechSynthesis !== \"undefined\") {\n      this.synth = window.speechSynthesis;\n      this.voices = this.synth.getVoices();\n      for (var i = 0; i < this.voices.length; i++) {\n        if (this.voices[i].default) {\n          this.defaultVoice = this.voices[i].name;\n        }\n      }\n    }\n  }\n  /**\n   * life cycle, element is afixed to the DOM\n   */\n  connectedCallback() {\n    super.connectedCallback();\n  }\n  /**\n   * Callback for clicking on whatever was just said\n   */\n  clickObject(phrase) {\n    this.__text = phrase;\n    this.commands[phrase].object.click();\n    this.commands[phrase].object.focus();\n  }\n  /**\n   * Notice new voice commands added\n   */\n  _commandsChanged(newValue) {\n    this.addCommands(newValue);\n  }\n  /**\n   * Just rout add commands call to the right place\n   */\n  addCommands(commands) {\n    if (this.annyang) {\n      this.annyang.addCommands(commands);\n    }\n  }\n  /**\n   * And the word was good.\n   */\n  speak(text) {\n    this.__text = text;\n    if (this.synth) {\n      this.utter = new SpeechSynthesisUtterance(this.__text);\n      this.utter.pitch = this.pitch;\n      this.utter.rate = this.rate;\n      this.utter.lang = this.language;\n      this.utter.voice = this.defaultVoice;\n      // THOU SPEAKITH\n      this.synth.speak(this.utter);\n    } else {\n      console.warn(\"I have no voice...\");\n    }\n  }\n  /**\n   * Annyang library has been loaded globally so we can use it\n   */\n  _annyangLoaded() {\n    this.annyang = window.annyang;\n    // Add our commands to annyang\n    if (this.annyang) {\n      this.annyang.addCommands(this.commands);\n      this.annyang.debug(this.debug);\n      // Start listening. You can call this here, or attach this call to an event, button, etc.\n      if (this.auto) {\n        this.annyang.start({\n          autoRestart: true,\n          continuous: true\n        });\n      } else if (this.enabled) {\n        this.annyang.start();\n      }\n      // alert alert we are ready\n      const evt = new CustomEvent(\"hal-9000-online\", {\n        bubbles: true,\n        cancelable: false,\n        detail: true\n      });\n      this.dispatchEvent(evt);\n    }\n  }\n  /**\n   * Change the key name that is responded to\n   */\n  _respondsToChanged(newValue, oldValue) {\n    // remove all as our voice changed\n    if (this.annyang) {\n      this.annyang.removeCommands();\n    }\n    var commands = {};\n    for (var i in this.commands) {\n      if (i.replace(oldValue, newValue) !== i) {\n        commands[i.replace(oldValue, newValue)] = this.commands[i];\n      } else {\n        commands[i] = this.commands[i];\n      }\n    }\n    this.set(\"commands\", commands);\n  }\n  /**\n   * Notice auto state changed so we start listening\n   */\n  _autoChanged(newValue) {\n    this.enabled = newValue;\n  }\n  /**\n   * React to enabled state changing\n   */\n  _enabledChanged(newValue) {\n    if (this.annyang) {\n      if (newValue) {\n        if (this.auto) {\n          this.annyang.start({\n            autoRestart: true,\n            continuous: true\n          });\n        } else {\n          this.annyang.start();\n        }\n      } else {\n        this.annyang.abort();\n      }\n    }\n  }\n  /**\n   * debug mode changed\n   */\n  _debugChanged(newValue, oldValue) {\n    if (this.annyang) {\n      this.annyang.debug(newValue);\n    }\n  }\n  /**\n   * life cycle, element is removed from the DOM\n   */\n  //disconnectedCallback() {}\n}\n// ensure we can generate a singleton\nwindow.customElements.define(Hal9000.tag, Hal9000);\nexport { Hal9000 };\nwindow.Hal9000 = window.Hal9000 || {};\n\nwindow.Hal9000.requestAvailability = () => {\n  if (!window.Hal9000.instance) {\n    window.Hal9000.instance = new Hal9000();\n  }\n};\n"],"names":["Hal9000","basePath","pathFromUrl","location","window","addEventListener","_this","_annyangLoaded","bind","ESGlobalBridge","requestAvailability","instance","load","speechSynthesis","synth","voices","getVoices","i","length","default","defaultVoice","name","PolymerElement","html","phrase","__text","commands","object","click","focus","newValue","addCommands","this","annyang","text","utter","SpeechSynthesisUtterance","pitch","rate","lang","language","voice","speak","console","warn","debug","auto","start","autoRestart","continuous","enabled","evt","CustomEvent","bubbles","cancelable","detail","dispatchEvent","oldValue","removeCommands","replace","set","abort","customElements","define","tag"],"mappings":"2qDAmBMA,8NA+GIC,EAAWC,8LACXC,YAAcF,mCACpBG,OAAOC,qCAHM,qBAKXC,EAAKC,eAAeC,eAEtBJ,OAAOK,eAAeC,sBACtBN,OAAOK,eAAeE,SAASC,KARlB,UAQ6BT,GAE1CC,OAAOJ,QAAQW,sBAEuB,IAA3BP,OAAOS,gBAAiC,GAC5CC,MAAQV,OAAOS,kBACfE,OAAST,EAAKQ,MAAME,gBACpB,IAAIC,EAAI,EAAGA,EAAIX,EAAKS,OAAOG,OAAQD,IAClCX,EAAKS,OAAOE,GAAGE,YACZC,aAAed,EAAKS,OAAOE,GAAGI,2PA/HvBC,kEAIXC,qDAiBA,UAIG,MACF,gBACA,eACC,YACG,+BAKA,MACJ,kBACA,eACC,iBACG,4BAKL,MACC,aACA,iBACC,WACG,sBAKN,MACE,YACA,8BACc,WACV,wBAKH,MACD,eACA,8BACc,WACV,yBAKL,MACC,aACA,6BACc,QACb,SAKH,MACE,YACA,6BACc,QACb,aAKC,MACF,gBACA,6BACc,QACb,4CAWF,wJAsCGC,QACLC,OAASD,OACTE,SAASF,GAAQG,OAAOC,aACxBF,SAASF,GAAQG,OAAOE,iDAKdC,QACVC,YAAYD,uCAKPJ,GACNM,KAAKC,cACFA,QAAQF,YAAYL,iCAMvBQ,QACCT,OAASS,EACVF,KAAKlB,YACFqB,MAAQ,IAAIC,yBAAyBJ,KAAKP,aAC1CU,MAAME,MAAQL,KAAKK,WACnBF,MAAMG,KAAON,KAAKM,UAClBH,MAAMI,KAAOP,KAAKQ,cAClBL,MAAMM,MAAQT,KAAKZ,kBAEnBN,MAAM4B,MAAMV,KAAKG,QAEtBQ,QAAQC,KAAK,uEAOVX,QAAU7B,OAAO6B,QAElBD,KAAKC,QAAS,MACXA,QAAQF,YAAYC,KAAKN,eACzBO,QAAQY,MAAMb,KAAKa,OAEpBb,KAAKc,UACFb,QAAQc,MAAM,CACjBC,aAAa,EACbC,YAAY,IAELjB,KAAKkB,cACTjB,QAAQc,YAGTI,EAAM,IAAIC,YAAY,kBAAmB,CAC7CC,SAAS,EACTC,YAAY,EACZC,QAAQ,SAELC,cAAcL,+CAMJrB,EAAU2B,GAEvBzB,KAAKC,cACFA,QAAQyB,qBAEXhC,EAAW,OACV,IAAIT,KAAKe,KAAKN,SACbT,EAAE0C,QAAQF,EAAU3B,KAAcb,EACpCS,EAAST,EAAE0C,QAAQF,EAAU3B,IAAaE,KAAKN,SAAST,GAExDS,EAAST,GAAKe,KAAKN,SAAST,QAG3B2C,IAAI,WAAYlC,wCAKVI,QACNoB,QAAUpB,0CAKDA,GACVE,KAAKC,UACHH,EACEE,KAAKc,UACFb,QAAQc,MAAM,CACjBC,aAAa,EACbC,YAAY,SAGThB,QAAQc,aAGVd,QAAQ4B,+CAOL/B,EAAU2B,GAClBzB,KAAKC,cACFA,QAAQY,MAAMf,YASzB1B,OAAO0D,eAAeC,OAAO/D,EAAQgE,IAAKhE,GAE1CI,OAAOJ,QAAUI,OAAOJ,SAAW,GAEnCI,OAAOJ,QAAQU,oBAAsB,WAC9BN,OAAOJ,QAAQW,WAClBP,OAAOJ,QAAQW,SAAW,IAAIX"}